[12/09 02:55:22] fastreid INFO: Rank of current process: 0. World size: 1
[12/09 02:55:22] fastreid INFO: Environment info:
----------------------  ---------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.6.13 |Anaconda, Inc.| (default, Mar 16 2021, 11:37:27) [MSC v.1916 64 bit (AMD64)]
numpy                   1.19.2
fastreid                0.1.0 @.\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  8.4.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
----------------------  ---------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/09 02:55:22] fastreid INFO: Command line arguments: Namespace(config_file='./configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/09 02:55:22] fastreid INFO: Contents of args.config_file=./configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/09 02:55:22] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/09 02:55:22] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN\logs\Sample\M-resnet\config.yaml
[12/09 02:55:22] fastreid.trainer INFO: Using a generated random seed 2020
[12/09 02:55:24] fastreid.utils.checkpoint INFO: Loading checkpoint from ./logs/Sample/M-resnet\model_0015199.pth
[12/09 02:55:24] fastreid.utils.checkpoint WARNING: 'heads.classifier_fc.weight' has shape (751, 2048) in the checkpoint but (0, 2048) in the model! Skipped.
[12/09 02:55:24] fastreid.utils.checkpoint INFO: Some model parameters are not in the checkpoint:
  [34mheads.classifier_fc.weight[0m
[12/09 02:55:24] fastreid.trainer INFO: load: ./logs/Sample/M-resnet\model_0015199.pth
[12/09 02:55:24] fastreid.engine.defaults INFO: Prepare testing set
[12/09 02:55:41] fastreid INFO: Rank of current process: 0. World size: 1
[12/09 02:55:41] fastreid INFO: Environment info:
----------------------  ---------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.6.13 |Anaconda, Inc.| (default, Mar 16 2021, 11:37:27) [MSC v.1916 64 bit (AMD64)]
numpy                   1.19.2
fastreid                0.1.0 @.\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  8.4.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
----------------------  ---------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/09 02:55:41] fastreid INFO: Command line arguments: Namespace(config_file='./configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/09 02:55:41] fastreid INFO: Contents of args.config_file=./configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/09 02:55:41] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/09 02:55:41] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN\logs\Sample\M-resnet\config.yaml
[12/09 02:55:41] fastreid.trainer INFO: Using a generated random seed 2020
[12/09 02:55:43] fastreid.utils.checkpoint INFO: Loading checkpoint from ./logs/Sample/M-resnet\model_0015199.pth
[12/09 02:55:43] fastreid.utils.checkpoint WARNING: 'heads.classifier_fc.weight' has shape (751, 2048) in the checkpoint but (0, 2048) in the model! Skipped.
[12/09 02:55:43] fastreid.utils.checkpoint INFO: Some model parameters are not in the checkpoint:
  [34mheads.classifier_fc.weight[0m
[12/09 02:55:43] fastreid.trainer INFO: load: ./logs/Sample/M-resnet\model_0015199.pth
[12/09 02:55:43] fastreid.engine.defaults INFO: Prepare testing set
[12/09 02:55:43] fastreid.data.datasets.bases INFO: => Loaded Market1501
[12/09 02:55:43] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/09 02:55:43] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/09 02:55:43] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/09 02:55:43] fastreid.data.datasets.bases INFO:   query    |   750 |     3368 |         6
[12/09 02:55:43] fastreid.data.datasets.bases INFO:   gallery  |   751 |    15913 |         6
[12/09 02:55:43] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/09 02:55:43] fastreid.evaluation.evaluator INFO: Start inference on 19281 images
[12/09 02:55:58] fastreid.evaluation.evaluator INFO: Inference done 11/151. 0.5554 s / batch. ETA=0:01:18
[12/09 02:56:28] fastreid.evaluation.evaluator INFO: Inference done 55/151. 0.6702 s / batch. ETA=0:01:05
[12/09 02:56:58] fastreid.evaluation.evaluator INFO: Inference done 98/151. 0.6814 s / batch. ETA=0:00:36
[12/09 02:57:29] fastreid.evaluation.evaluator INFO: Inference done 141/151. 0.6863 s / batch. ETA=0:00:06
[12/09 02:57:36] fastreid.evaluation.evaluator INFO: Total inference time: 0:01:42.228927 (0.700198 s / batch per device)
[12/09 02:57:36] fastreid.evaluation.evaluator INFO: Total inference pure compute time: 0:01:40 (0.690398 s / batch per device)
[12/09 02:59:50] fastreid.engine.defaults INFO: Prepare testing set
[12/09 02:59:50] fastreid.data.datasets.bases INFO: => Loaded DukeMTMC
[12/09 02:59:50] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/09 02:59:50] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/09 02:59:50] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/09 02:59:50] fastreid.data.datasets.bases INFO:   query    |   702 |     2228 |         8
[12/09 02:59:50] fastreid.data.datasets.bases INFO:   gallery  |  1110 |    17661 |         8
[12/09 02:59:50] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/09 02:59:50] fastreid.evaluation.evaluator INFO: Start inference on 19889 images
[12/09 03:00:38] fastreid.evaluation.evaluator INFO: Inference done 11/156. 0.5499 s / batch. ETA=0:01:20
[12/09 03:01:08] fastreid.evaluation.evaluator INFO: Inference done 55/156. 0.6643 s / batch. ETA=0:01:07
[12/09 03:01:39] fastreid.evaluation.evaluator INFO: Inference done 99/156. 0.6756 s / batch. ETA=0:00:38
[12/09 03:02:09] fastreid.evaluation.evaluator INFO: Inference done 142/156. 0.6842 s / batch. ETA=0:00:09
[12/09 03:02:21] fastreid.evaluation.evaluator INFO: Total inference time: 0:01:47.014644 (0.708706 s / batch per device)
[12/09 03:05:29] fastreid.evaluation.evaluator INFO: Total inference pure compute time: 0:01:43 (0.685469 s / batch per device)
[12/09 03:07:01] fastreid.evaluation.testing INFO: Evaluation results in csv format: 
[36m| Datasets          | Rank-1   | Rank-5   | Rank-10   | mAP    | mINP   | TPR@FPR=0.0001   | TPR@FPR=0.001   | TPR@FPR=0.01   |
|:------------------|:---------|:---------|:----------|:-------|:-------|:-----------------|:----------------|:---------------|
| Market1501        | 89.99%   | 95.93%   | 97.68%    | 71.86% | 34.05% | 2.12%            | 24.71%          | 81.18%         |
| DukeMTMC          | 55.03%   | 68.63%   | 74.28%    | 33.03% | 4.97%  | 0.17%            | 1.68%           | 13.86%         |
| ** all_average ** |          |          |           |        |        |                  |                 |                |[0m
[12/11 00:45:46] fastreid INFO: Rank of current process: 0. World size: 1
[12/11 00:45:48] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-origin\MetaBIN\.\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/11 00:45:48] fastreid INFO: Command line arguments: Namespace(config_file='./configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/11 00:45:48] fastreid INFO: Contents of args.config_file=./configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/11 00:45:48] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/11 00:45:49] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-origin\MetaBIN\logs\Sample\M-resnet\config.yaml
[12/11 00:45:49] fastreid.trainer INFO: Using a generated random seed 2020
[12/11 00:46:20] fastreid INFO: Rank of current process: 0. World size: 1
[12/11 00:46:22] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-origin\MetaBIN\.\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/11 00:46:22] fastreid INFO: Command line arguments: Namespace(config_file='./configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/11 00:46:22] fastreid INFO: Contents of args.config_file=./configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/11 00:46:22] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/11 00:46:23] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-origin\MetaBIN\logs\Sample\M-resnet\config.yaml
[12/11 00:46:23] fastreid.trainer INFO: Using a generated random seed 2020
[12/11 00:47:22] fastreid INFO: Rank of current process: 0. World size: 1
[12/11 00:47:24] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-origin\MetaBIN\.\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/11 00:47:24] fastreid INFO: Command line arguments: Namespace(config_file='./configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/11 00:47:24] fastreid INFO: Contents of args.config_file=./configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/11 00:47:24] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/11 00:47:24] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-origin\MetaBIN\logs\Sample\M-resnet\config.yaml
[12/11 00:47:24] fastreid.trainer INFO: Using a generated random seed 2020
[12/11 00:48:32] fastreid INFO: Rank of current process: 0. World size: 1
[12/11 00:48:34] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-origin\MetaBIN\.\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/11 00:48:34] fastreid INFO: Command line arguments: Namespace(config_file='./configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/11 00:48:34] fastreid INFO: Contents of args.config_file=./configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/11 00:48:34] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/11 00:48:34] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-origin\MetaBIN\logs\Sample\M-resnet\config.yaml
[12/11 00:48:34] fastreid.trainer INFO: Using a generated random seed 2020
[12/11 00:49:03] fastreid INFO: Rank of current process: 0. World size: 1
[12/11 00:49:05] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-origin\MetaBIN\.\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/11 00:49:05] fastreid INFO: Command line arguments: Namespace(config_file='./configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/11 00:49:05] fastreid INFO: Contents of args.config_file=./configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/11 00:49:05] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/11 00:49:05] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-origin\MetaBIN\logs\Sample\M-resnet\config.yaml
[12/11 00:49:05] fastreid.trainer INFO: Using a generated random seed 2020
[12/11 00:49:09] fastreid.utils.checkpoint INFO: Loading checkpoint from ./logs/Sample/M-resnet\model_0015199.pth
[12/11 00:49:10] fastreid.utils.checkpoint WARNING: 'heads.classifier_fc.weight' has shape (751, 2048) in the checkpoint but (0, 2048) in the model! Skipped.
[12/11 00:49:10] fastreid.utils.checkpoint INFO: Some model parameters are not in the checkpoint:
  [34mheads.classifier_fc.weight[0m
[12/11 00:49:10] fastreid.trainer INFO: load: ./logs/Sample/M-resnet\model_0015199.pth
[12/11 00:49:10] fastreid.engine.defaults INFO: Prepare testing set
[12/11 00:49:11] fastreid.data.datasets.bases INFO: => Loaded Market1501
[12/11 00:49:11] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/11 00:49:11] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/11 00:49:11] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/11 00:49:11] fastreid.data.datasets.bases INFO:   query    |   750 |     3368 |         6
[12/11 00:49:11] fastreid.data.datasets.bases INFO:   gallery  |   751 |    15913 |         6
[12/11 00:49:11] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/11 00:49:11] fastreid.evaluation.evaluator INFO: Start inference on 19281 images
[12/11 00:55:30] fastreid INFO: Rank of current process: 0. World size: 1
[12/11 00:55:33] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-origin\MetaBIN\.\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/11 00:55:33] fastreid INFO: Command line arguments: Namespace(config_file='./configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/11 00:55:33] fastreid INFO: Contents of args.config_file=./configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/11 00:55:33] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/11 00:55:33] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-origin\MetaBIN\logs\Sample\M-resnet\config.yaml
[12/11 00:55:33] fastreid.trainer INFO: Using a generated random seed 2020
[12/11 00:56:21] fastreid INFO: Rank of current process: 0. World size: 1
[12/11 00:56:24] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-origin\MetaBIN\.\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/11 00:56:24] fastreid INFO: Command line arguments: Namespace(config_file='./configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/11 00:56:24] fastreid INFO: Contents of args.config_file=./configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/11 00:56:24] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/11 00:56:24] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-origin\MetaBIN\logs\Sample\M-resnet\config.yaml
[12/11 00:56:24] fastreid.trainer INFO: Using a generated random seed 2020
[12/11 00:56:29] fastreid.utils.checkpoint INFO: Loading checkpoint from ./logs/Sample/M-resnet\model_0015199.pth
[12/11 00:56:29] fastreid.utils.checkpoint WARNING: 'heads.classifier_fc.weight' has shape (751, 2048) in the checkpoint but (0, 2048) in the model! Skipped.
[12/11 00:56:29] fastreid.utils.checkpoint INFO: Some model parameters are not in the checkpoint:
  [34mheads.classifier_fc.weight[0m
[12/11 00:56:29] fastreid.trainer INFO: load: ./logs/Sample/M-resnet\model_0015199.pth
[12/11 00:56:29] fastreid.engine.defaults INFO: Prepare testing set
[12/11 00:56:29] fastreid.data.datasets.bases INFO: => Loaded Market1501
[12/11 00:56:29] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/11 00:56:29] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/11 00:56:29] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/11 00:56:29] fastreid.data.datasets.bases INFO:   query    |   750 |     3368 |         6
[12/11 00:56:29] fastreid.data.datasets.bases INFO:   gallery  |   751 |    15913 |         6
[12/11 00:56:29] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/11 00:56:29] fastreid.evaluation.evaluator INFO: Start inference on 19281 images
[12/11 00:56:46] fastreid INFO: Rank of current process: 0. World size: 1
[12/11 00:56:48] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-origin\MetaBIN\.\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/11 00:56:48] fastreid INFO: Command line arguments: Namespace(config_file='./configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/11 00:56:48] fastreid INFO: Contents of args.config_file=./configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/11 00:56:48] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/11 00:56:48] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-origin\MetaBIN\logs\Sample\M-resnet\config.yaml
[12/11 00:56:48] fastreid.trainer INFO: Using a generated random seed 2020
[12/11 00:57:09] fastreid INFO: Rank of current process: 0. World size: 1
[12/11 00:57:12] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-origin\MetaBIN\.\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/11 00:57:12] fastreid INFO: Command line arguments: Namespace(config_file='./configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/11 00:57:12] fastreid INFO: Contents of args.config_file=./configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/11 00:57:12] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/11 00:57:12] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-origin\MetaBIN\logs\Sample\M-resnet\config.yaml
[12/11 00:57:12] fastreid.trainer INFO: Using a generated random seed 2020
[12/11 00:57:14] fastreid.utils.checkpoint INFO: Loading checkpoint from ./logs/Sample/M-resnet\model_0015199.pth
[12/11 00:57:14] fastreid.utils.checkpoint WARNING: 'heads.classifier_fc.weight' has shape (751, 2048) in the checkpoint but (0, 2048) in the model! Skipped.
[12/11 00:57:14] fastreid.utils.checkpoint INFO: Some model parameters are not in the checkpoint:
  [34mheads.classifier_fc.weight[0m
[12/11 00:57:14] fastreid.trainer INFO: load: ./logs/Sample/M-resnet\model_0015199.pth
[12/11 00:57:14] fastreid.engine.defaults INFO: Prepare testing set
[12/11 00:57:15] fastreid.data.datasets.bases INFO: => Loaded Market1501
[12/11 00:57:15] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/11 00:57:15] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/11 00:57:15] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/11 00:57:15] fastreid.data.datasets.bases INFO:   query    |   750 |     3368 |         6
[12/11 00:57:15] fastreid.data.datasets.bases INFO:   gallery  |   751 |    15913 |         6
[12/11 00:57:15] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/11 00:57:15] fastreid.evaluation.evaluator INFO: Start inference on 19281 images
[12/11 14:48:10] fastreid INFO: Rank of current process: 0. World size: 1
[12/11 14:48:14] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-origin\MetaBIN\.\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/11 14:48:14] fastreid INFO: Command line arguments: Namespace(config_file='./configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/11 14:48:14] fastreid INFO: Contents of args.config_file=./configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/11 14:48:14] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/11 14:48:14] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-origin\MetaBIN\logs\Sample\M-resnet\config.yaml
[12/11 14:48:14] fastreid.trainer INFO: Using a generated random seed 2020
[12/11 21:59:02] fastreid INFO: Rank of current process: 0. World size: 1
[12/11 21:59:05] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-origin\MetaBIN\.\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/11 21:59:05] fastreid INFO: Command line arguments: Namespace(config_file='./configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/11 21:59:05] fastreid INFO: Contents of args.config_file=./configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/11 21:59:05] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/11 21:59:05] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-origin\MetaBIN\logs\Sample\M-resnet\config.yaml
[12/11 21:59:05] fastreid.trainer INFO: Using a generated random seed 2020
[12/11 22:04:11] fastreid INFO: Rank of current process: 0. World size: 1
[12/11 22:04:30] fastreid INFO: Rank of current process: 0. World size: 1
[12/11 22:04:33] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-origin\MetaBIN\.\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/11 22:04:33] fastreid INFO: Command line arguments: Namespace(config_file='./configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/11 22:04:33] fastreid INFO: Contents of args.config_file=./configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/11 22:04:33] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/11 22:04:33] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-origin\MetaBIN\logs\Sample\M-resnet\config.yaml
[12/11 22:04:33] fastreid.trainer INFO: Using a generated random seed 2020
[12/12 01:23:03] fastreid INFO: Rank of current process: 0. World size: 1
[12/12 01:23:05] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-origin\MetaBIN\.\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/12 01:23:05] fastreid INFO: Command line arguments: Namespace(config_file='./configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/12 01:23:05] fastreid INFO: Contents of args.config_file=./configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/12 01:23:05] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/12 01:23:05] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-origin\MetaBIN\logs\Sample\M-resnet\config.yaml
[12/12 01:23:05] fastreid.trainer INFO: Using a generated random seed 2020
[12/12 01:23:42] fastreid.utils.checkpoint INFO: Loading checkpoint from ./logs/Sample/M-resnet\model_0015199.pth
[12/12 01:23:43] fastreid.utils.checkpoint WARNING: 'heads.classifier_fc.weight' has shape (751, 2048) in the checkpoint but (0, 2048) in the model! Skipped.
[12/12 01:23:43] fastreid.utils.checkpoint INFO: Some model parameters are not in the checkpoint:
  [34mheads.classifier_fc.weight[0m
[12/12 01:23:43] fastreid.trainer INFO: load: ./logs/Sample/M-resnet\model_0015199.pth
[12/12 01:23:43] fastreid.engine.defaults INFO: Prepare testing set
[12/12 01:23:44] fastreid.data.datasets.bases INFO: => Loaded Market1501
[12/12 01:23:44] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/12 01:23:44] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/12 01:23:44] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/12 01:23:44] fastreid.data.datasets.bases INFO:   query    |   750 |     3368 |         6
[12/12 01:23:44] fastreid.data.datasets.bases INFO:   gallery  |   751 |    15913 |         6
[12/12 01:23:44] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/12 01:23:44] fastreid.evaluation.evaluator INFO: Start inference on 19281 images
[12/12 01:24:30] fastreid INFO: Rank of current process: 0. World size: 1
[12/12 01:24:33] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-origin\MetaBIN\.\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/12 01:24:33] fastreid INFO: Command line arguments: Namespace(config_file='./configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/12 01:24:33] fastreid INFO: Contents of args.config_file=./configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/12 01:24:33] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/12 01:24:33] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-origin\MetaBIN\logs\Sample\M-resnet\config.yaml
[12/12 01:24:33] fastreid.trainer INFO: Using a generated random seed 2020
[12/12 01:24:35] fastreid.utils.checkpoint INFO: Loading checkpoint from ./logs/Sample/M-resnet\model_0015199.pth
[12/12 01:24:35] fastreid.utils.checkpoint WARNING: 'heads.classifier_fc.weight' has shape (751, 2048) in the checkpoint but (0, 2048) in the model! Skipped.
[12/12 01:24:35] fastreid.utils.checkpoint INFO: Some model parameters are not in the checkpoint:
  [34mheads.classifier_fc.weight[0m
[12/12 01:24:35] fastreid.trainer INFO: load: ./logs/Sample/M-resnet\model_0015199.pth
[12/12 02:05:20] fastreid INFO: Rank of current process: 0. World size: 1
[12/12 02:05:23] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/12 02:05:23] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/12 02:05:23] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/12 02:05:23] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/12 02:05:23] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/12 02:05:23] fastreid.trainer INFO: Using a generated random seed 2020
[12/12 02:05:25] fastreid.trainer INFO: load: ./refs/logs/Sample/M-resnet\model_0015199.pth
[12/12 02:07:43] fastreid INFO: Rank of current process: 0. World size: 1
[12/12 02:07:43] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/12 02:07:43] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/12 02:07:43] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/12 02:07:43] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/12 02:07:44] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/12 02:07:44] fastreid.trainer INFO: Using a generated random seed 2020
[12/12 02:07:45] fastreid.trainer INFO: load: ./refs/logs/Sample/M-resnet\model_0015199.pth
[12/12 02:10:44] fastreid INFO: Rank of current process: 0. World size: 1
[12/12 02:10:44] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/12 02:10:44] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/12 02:10:44] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/12 02:10:44] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/12 02:10:44] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/12 02:11:01] fastreid INFO: Rank of current process: 0. World size: 1
[12/12 02:11:02] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/12 02:11:02] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/12 02:11:02] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/12 02:11:02] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/12 02:11:02] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/12 02:11:09] fastreid INFO: Rank of current process: 0. World size: 1
[12/12 02:11:10] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/12 02:11:10] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/12 02:11:10] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/12 02:11:10] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/12 02:11:10] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/12 02:12:24] fastreid INFO: Rank of current process: 0. World size: 1
[12/12 02:12:25] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/12 02:12:25] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/12 02:12:25] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/12 02:12:25] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/12 02:12:25] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/12 02:17:11] fastreid INFO: Rank of current process: 0. World size: 1
[12/12 02:17:12] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/12 02:17:12] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/12 02:17:12] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/12 02:17:12] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/12 02:17:12] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/12 02:27:23] fastreid INFO: Rank of current process: 0. World size: 1
[12/12 02:27:25] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/12 02:27:25] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/12 02:27:25] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/12 02:27:25] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/12 02:27:25] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/12 02:37:58] fastreid INFO: Rank of current process: 0. World size: 1
[12/12 02:37:59] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/12 02:37:59] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/12 02:37:59] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/12 02:37:59] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/12 02:37:59] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/12 02:38:55] fastreid INFO: Rank of current process: 0. World size: 1
[12/12 02:38:56] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/12 02:38:56] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/12 02:38:56] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/12 02:38:56] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/12 02:38:56] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/12 02:40:41] fastreid INFO: Rank of current process: 0. World size: 1
[12/12 02:40:42] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/12 02:40:42] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/12 02:40:42] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/12 02:40:42] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/12 02:40:42] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/12 02:41:31] fastreid INFO: Rank of current process: 0. World size: 1
[12/12 02:41:32] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/12 02:41:32] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/12 02:41:32] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/12 02:41:32] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/12 02:41:32] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/12 02:42:37] fastreid INFO: Rank of current process: 0. World size: 1
[12/12 02:42:38] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/12 02:42:38] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/12 02:42:38] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/12 02:42:38] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/12 02:42:38] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/12 02:44:05] fastreid INFO: Rank of current process: 0. World size: 1
[12/12 02:44:05] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/12 02:44:05] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/12 02:44:05] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/12 02:44:05] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/12 02:44:05] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/12 02:45:07] fastreid INFO: Rank of current process: 0. World size: 1
[12/12 02:45:08] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/12 02:45:08] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/12 02:45:08] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/12 02:45:08] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/12 02:45:08] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/12 02:46:24] fastreid INFO: Rank of current process: 0. World size: 1
[12/12 02:46:25] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/12 02:46:25] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/12 02:46:25] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/12 02:46:25] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/12 02:46:25] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/12 02:47:11] fastreid INFO: Rank of current process: 0. World size: 1
[12/12 02:47:12] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/12 02:47:12] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/12 02:47:12] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/12 02:47:12] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/12 02:47:12] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/12 02:48:35] fastreid INFO: Rank of current process: 0. World size: 1
[12/12 02:48:36] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/12 02:48:36] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/12 02:48:36] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/12 02:48:36] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/12 02:48:36] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/12 02:49:14] fastreid INFO: Rank of current process: 0. World size: 1
[12/12 02:49:15] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/12 02:49:15] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/12 02:49:15] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/12 02:49:15] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/12 02:49:15] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/12 02:50:29] fastreid INFO: Rank of current process: 0. World size: 1
[12/12 02:50:30] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/12 02:50:30] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/12 02:50:30] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/12 02:50:30] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/12 02:50:30] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/12 02:51:51] fastreid INFO: Rank of current process: 0. World size: 1
[12/12 02:51:52] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/12 02:51:52] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/12 02:51:52] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/12 02:51:52] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/12 02:51:52] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/12 02:54:10] fastreid INFO: Rank of current process: 0. World size: 1
[12/12 02:54:11] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/12 02:54:11] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/12 02:54:11] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/12 02:54:11] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/12 02:54:11] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/12 02:56:49] fastreid INFO: Rank of current process: 0. World size: 1
[12/12 02:56:50] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/12 02:56:50] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/12 02:56:50] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/12 02:56:50] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/12 02:56:50] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/12 02:59:07] fastreid INFO: Rank of current process: 0. World size: 1
[12/12 02:59:08] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/12 02:59:08] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/12 02:59:08] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/12 02:59:08] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/12 02:59:08] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/12 03:00:20] fastreid INFO: Rank of current process: 0. World size: 1
[12/12 03:00:21] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/12 03:00:21] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/12 03:00:21] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/12 03:00:21] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/12 03:00:21] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/12 03:04:37] fastreid INFO: Rank of current process: 0. World size: 1
[12/12 03:04:37] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/12 03:04:37] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/12 03:04:37] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/12 03:04:37] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/12 03:04:38] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/12 03:05:02] fastreid INFO: Rank of current process: 0. World size: 1
[12/12 03:05:03] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/12 03:05:03] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/12 03:05:03] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/12 03:05:03] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/12 03:05:03] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/12 03:49:23] fastreid INFO: Rank of current process: 0. World size: 1
[12/12 03:49:23] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/12 03:49:23] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/12 03:49:23] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/12 03:49:23] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/12 03:49:23] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/12 03:50:44] fastreid INFO: Rank of current process: 0. World size: 1
[12/12 03:50:44] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/12 03:50:44] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/12 03:50:44] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/12 03:50:44] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/12 03:50:44] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/12 03:51:31] fastreid INFO: Rank of current process: 0. World size: 1
[12/12 03:51:31] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/12 03:51:31] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/12 03:51:31] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/12 03:51:31] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/12 03:51:31] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/12 03:52:06] fastreid INFO: Rank of current process: 0. World size: 1
[12/12 03:52:06] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/12 03:52:06] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/12 03:52:06] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/12 03:52:06] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/12 03:52:06] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/12 03:52:26] fastreid INFO: Rank of current process: 0. World size: 1
[12/12 03:52:26] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/12 03:52:26] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/12 03:52:26] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/12 03:52:26] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/12 03:52:26] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/12 03:52:43] fastreid INFO: Rank of current process: 0. World size: 1
[12/12 03:52:43] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/12 03:52:43] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/12 03:52:43] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/12 03:52:43] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/12 03:52:44] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/12 03:55:50] fastreid INFO: Rank of current process: 0. World size: 1
[12/12 03:55:51] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/12 03:55:51] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/12 03:55:51] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/12 03:55:51] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/12 03:55:51] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/12 04:10:19] fastreid INFO: Rank of current process: 0. World size: 1
[12/12 04:10:19] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/12 04:10:19] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/12 04:10:19] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/12 04:10:19] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/12 04:10:20] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/12 04:10:43] fastreid INFO: Rank of current process: 0. World size: 1
[12/12 04:10:43] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/12 04:10:43] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/12 04:10:43] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/12 04:10:43] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/12 04:10:43] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/12 04:11:00] fastreid INFO: Rank of current process: 0. World size: 1
[12/12 04:11:01] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/12 04:11:01] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/12 04:11:01] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/12 04:11:01] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/12 04:11:01] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/12 04:12:13] fastreid INFO: Rank of current process: 0. World size: 1
[12/12 04:12:14] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/12 04:12:14] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/12 04:12:14] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/12 04:12:14] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/12 04:12:14] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/12 04:12:39] fastreid INFO: Rank of current process: 0. World size: 1
[12/12 04:12:40] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/12 04:12:40] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/12 04:12:40] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/12 04:12:40] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/12 04:12:40] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/12 04:13:01] fastreid INFO: Rank of current process: 0. World size: 1
[12/12 04:13:01] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/12 04:13:01] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/12 04:13:01] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/12 04:13:01] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/12 04:13:02] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/12 04:13:35] fastreid INFO: Rank of current process: 0. World size: 1
[12/12 04:13:35] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/12 04:13:35] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/12 04:13:35] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/12 04:13:35] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/12 04:13:35] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/12 04:16:01] fastreid INFO: Rank of current process: 0. World size: 1
[12/12 04:16:02] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/12 04:16:02] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/12 04:16:02] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/12 04:16:02] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/12 04:16:02] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/12 04:19:41] fastreid INFO: Rank of current process: 0. World size: 1
[12/12 04:19:41] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/12 04:19:41] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/12 04:19:41] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/12 04:19:41] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/12 04:19:41] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/12 04:22:27] fastreid INFO: Rank of current process: 0. World size: 1
[12/12 04:22:27] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/12 04:22:27] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/12 04:22:27] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/12 04:22:27] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/12 04:22:27] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/12 04:23:06] fastreid INFO: Rank of current process: 0. World size: 1
[12/12 04:23:06] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/12 04:23:06] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/12 04:23:06] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/12 04:23:06] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/12 04:23:06] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/12 04:24:25] fastreid INFO: Rank of current process: 0. World size: 1
[12/12 04:24:25] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/12 04:24:25] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/12 04:24:25] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/12 04:24:25] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/12 04:24:25] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/12 04:45:09] fastreid INFO: Rank of current process: 0. World size: 1
[12/12 04:45:09] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/12 04:45:09] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/12 04:45:09] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/12 04:45:09] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/12 04:45:09] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/12 04:45:58] fastreid INFO: Rank of current process: 0. World size: 1
[12/12 04:45:59] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/12 04:45:59] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/12 04:45:59] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/12 04:45:59] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/12 04:45:59] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/12 15:19:35] fastreid INFO: Rank of current process: 0. World size: 1
[12/12 15:19:37] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/12 15:19:37] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/12 15:19:37] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/12 15:19:37] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/12 15:19:37] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/12 15:30:02] fastreid INFO: Rank of current process: 0. World size: 1
[12/12 15:30:03] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/12 15:30:03] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/12 15:30:03] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/12 15:30:03] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/12 15:30:03] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/12 15:34:30] fastreid INFO: Rank of current process: 0. World size: 1
[12/12 15:34:31] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/12 15:34:31] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/12 15:34:31] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/12 15:34:31] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/12 15:34:31] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/12 16:01:03] fastreid INFO: Rank of current process: 0. World size: 1
[12/12 16:01:03] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/12 16:01:03] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/12 16:01:03] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/12 16:01:03] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/12 16:01:03] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/17 01:21:38] fastreid INFO: Rank of current process: 0. World size: 1
[12/17 01:21:39] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\metabin-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\metabin-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\metabin-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/17 01:21:39] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/17 01:21:39] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/17 01:21:39] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/17 01:21:39] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/17 01:22:52] fastreid INFO: Rank of current process: 0. World size: 1
[12/17 01:22:52] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\metabin-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\metabin-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\metabin-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/17 01:22:52] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/17 01:22:52] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/17 01:22:52] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/17 01:22:52] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/17 01:23:25] fastreid INFO: Rank of current process: 0. World size: 1
[12/17 01:23:25] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\metabin-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\metabin-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\metabin-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/17 01:23:25] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/17 01:23:25] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/17 01:23:25] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/17 01:23:25] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/17 14:53:47] fastreid INFO: Rank of current process: 0. World size: 1
[12/17 14:53:48] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/17 14:53:48] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/17 14:53:48] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/17 14:53:48] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/17 14:53:48] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/17 14:55:22] fastreid INFO: Rank of current process: 0. World size: 1
[12/17 14:55:23] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/17 14:55:23] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/17 14:55:23] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/17 14:55:23] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/17 14:55:23] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/17 21:52:58] fastreid INFO: Rank of current process: 0. World size: 1
[12/17 21:53:00] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/17 21:53:00] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/17 21:53:00] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/17 21:53:00] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/17 21:53:00] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 00:15:30] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 00:15:31] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 00:15:31] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 00:15:31] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 00:15:31] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 00:15:32] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 00:19:03] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 00:19:04] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 00:19:04] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 00:19:04] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 00:19:04] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 00:19:04] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 00:20:27] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 00:20:29] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 00:20:29] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 00:20:29] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 00:20:29] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 00:20:29] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 04:00:08] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 04:00:09] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 04:00:09] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 04:00:09] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 04:00:09] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 04:00:09] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 04:01:24] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 04:01:25] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 04:01:25] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 04:01:25] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 04:01:25] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 04:01:25] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 04:02:06] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 04:02:07] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 04:02:07] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 04:02:07] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 04:02:07] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 04:02:07] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 04:05:52] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 04:05:53] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 04:05:53] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 04:05:53] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 04:05:53] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 04:05:53] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 04:10:09] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 04:10:10] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 04:10:10] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 04:10:10] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 04:10:10] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 04:10:10] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 04:16:07] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 04:16:08] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 04:16:08] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 04:16:08] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 04:16:08] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 04:16:08] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 04:17:21] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 04:17:22] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 04:17:22] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 04:17:22] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 04:17:22] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 04:17:22] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 04:18:50] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 04:18:51] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 04:18:51] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 04:18:51] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 04:18:51] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 04:18:51] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 04:19:20] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 04:19:21] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 04:19:21] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 04:19:21] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 04:19:22] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 04:19:22] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 04:20:52] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 04:20:53] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 04:20:53] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 04:20:53] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 04:20:53] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 04:20:53] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 04:22:29] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 04:22:31] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 04:22:31] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 04:22:31] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 04:22:31] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 04:22:31] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 04:23:12] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 04:23:13] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 04:23:13] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 04:23:13] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 04:23:13] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 04:23:13] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 04:24:03] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 04:24:04] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 04:24:04] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 04:24:04] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 04:24:04] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 04:24:04] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 04:24:44] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 04:24:45] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 04:24:45] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 04:24:45] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 04:24:45] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 04:24:45] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 14:05:08] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 14:05:10] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 14:05:10] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 14:05:10] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 14:05:10] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 14:05:10] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 14:05:24] fastreid.data.datasets.bases INFO: => Loaded Market1501
[12/18 14:05:24] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 14:05:24] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 14:05:24] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 14:05:24] fastreid.data.datasets.bases INFO:   train    |   751 |    12936 |         6
[12/18 14:05:24] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 14:05:24] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 14:05:26] fastreid INFO: ------------------------------
[12/18 14:05:26] fastreid INFO: Meta-learning paramters
[12/18 14:05:26] fastreid INFO: ------------------------------
[12/18 14:05:26] fastreid INFO: [M_param] synth_data: none
[12/18 14:05:26] fastreid INFO: [M_param] synth_method: real
[12/18 14:05:26] fastreid INFO: [M_param] num_domain: 6
[12/18 14:05:26] fastreid INFO: [M_param] whole: True
[12/18 14:05:26] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/18 14:05:26] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/18 14:05:26] fastreid INFO: [M_param] meta_all_params: False
[12/18 14:05:26] fastreid INFO: [M_param] iter_init_inner: 1
[12/18 14:05:26] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/18 14:05:26] fastreid INFO: [M_param] iter_init_outer: 1
[12/18 14:05:26] fastreid INFO: [M_param] update_ratio: 0.0
[12/18 14:05:26] fastreid INFO: [M_param] iters_per_epoch: 145
[12/18 14:05:26] fastreid INFO: [M_param] iter_mtrain: 1
[12/18 14:05:26] fastreid INFO: [M_param] shuffle_domain: True
[12/18 14:05:26] fastreid INFO: [M_param] use_second_order: False
[12/18 14:05:26] fastreid INFO: [M_param] num_mtrain: 3
[12/18 14:05:26] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/18 14:05:26] fastreid INFO: [M_param] allow_unused: False
[12/18 14:05:26] fastreid INFO: [M_param] zero_grad: True
[12/18 14:05:26] fastreid INFO: [M_param] type_running_stats_init: general
[12/18 14:05:26] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/18 14:05:26] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/18 14:05:26] fastreid INFO: [M_param] auto_grad_outside: True
[12/18 14:05:26] fastreid INFO: [M_param] inner_clamp: True
[12/18 14:05:26] fastreid INFO: [M_param] synth_grad: none
[12/18 14:05:26] fastreid INFO: [M_param] constant_grad: 0.01
[12/18 14:05:26] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/18 14:05:26] fastreid INFO: [M_param] print_grad: True
[12/18 14:05:26] fastreid INFO: [M_param] one_loss_for_iter: False
[12/18 14:05:26] fastreid INFO: [M_param] one_loss_order: forward
[12/18 14:05:26] fastreid INFO: [M_param] num_mtest: 3
[12/18 14:05:26] fastreid INFO: [M_param] sync: True
[12/18 14:05:26] fastreid INFO: [M_param] detail_mode: True
[12/18 14:05:26] fastreid INFO: [M_param] stop_gradient: True
[12/18 14:05:26] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/18 14:05:26] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/18 14:05:26] fastreid INFO: [M_param] main_zero_grad: True
[12/18 14:05:26] fastreid INFO: [M_param] norm_zero_grad: True
[12/18 14:05:26] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/18 14:05:26] fastreid INFO: [M_param] write_period_param: 1000
[12/18 14:05:26] fastreid INFO: [M_param] loss_combined: False
[12/18 14:05:26] fastreid INFO: [M_param] loss_weight: 1.0
[12/18 14:05:26] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/18 14:05:26] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/18 14:05:26] fastreid INFO: ------------------------------
[12/18 14:05:26] fastreid.utils.checkpoint INFO: Loading checkpoint from ./refs/logs/Sample/M-resnet\model_0015199.pth
[12/18 14:05:27] fastreid.utils.checkpoint INFO: Loading optimizer_main from ./refs/logs/Sample/M-resnet\model_0015199.pth
[12/18 14:05:27] fastreid.utils.checkpoint INFO: Loading scheduler_main from ./refs/logs/Sample/M-resnet\model_0015199.pth
[12/18 14:05:27] fastreid.utils.checkpoint INFO: Loading optimizer_norm from ./refs/logs/Sample/M-resnet\model_0015199.pth
[12/18 14:05:27] fastreid.utils.checkpoint INFO: Loading scheduler_norm from ./refs/logs/Sample/M-resnet\model_0015199.pth
[12/18 14:12:37] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 14:12:38] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 14:12:38] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 14:12:38] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 14:12:38] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 14:12:39] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 14:12:41] fastreid.data.datasets.bases INFO: => Loaded Market1501
[12/18 14:12:41] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 14:12:41] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 14:12:41] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 14:12:41] fastreid.data.datasets.bases INFO:   train    |   751 |    12936 |         6
[12/18 14:12:41] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 14:12:41] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 14:12:42] fastreid INFO: ------------------------------
[12/18 14:12:42] fastreid INFO: Meta-learning paramters
[12/18 14:12:42] fastreid INFO: ------------------------------
[12/18 14:12:42] fastreid INFO: [M_param] synth_data: none
[12/18 14:12:42] fastreid INFO: [M_param] synth_method: real
[12/18 14:12:42] fastreid INFO: [M_param] num_domain: 6
[12/18 14:12:42] fastreid INFO: [M_param] whole: True
[12/18 14:12:42] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/18 14:12:42] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/18 14:12:42] fastreid INFO: [M_param] meta_all_params: False
[12/18 14:12:42] fastreid INFO: [M_param] iter_init_inner: 1
[12/18 14:12:42] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/18 14:12:42] fastreid INFO: [M_param] iter_init_outer: 1
[12/18 14:12:42] fastreid INFO: [M_param] update_ratio: 0.0
[12/18 14:12:42] fastreid INFO: [M_param] iters_per_epoch: 145
[12/18 14:12:42] fastreid INFO: [M_param] iter_mtrain: 1
[12/18 14:12:42] fastreid INFO: [M_param] shuffle_domain: True
[12/18 14:12:42] fastreid INFO: [M_param] use_second_order: False
[12/18 14:12:42] fastreid INFO: [M_param] num_mtrain: 3
[12/18 14:12:42] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/18 14:12:42] fastreid INFO: [M_param] allow_unused: False
[12/18 14:12:42] fastreid INFO: [M_param] zero_grad: True
[12/18 14:12:42] fastreid INFO: [M_param] type_running_stats_init: general
[12/18 14:12:42] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/18 14:12:42] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/18 14:12:42] fastreid INFO: [M_param] auto_grad_outside: True
[12/18 14:12:42] fastreid INFO: [M_param] inner_clamp: True
[12/18 14:12:42] fastreid INFO: [M_param] synth_grad: none
[12/18 14:12:42] fastreid INFO: [M_param] constant_grad: 0.01
[12/18 14:12:42] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/18 14:12:42] fastreid INFO: [M_param] print_grad: True
[12/18 14:12:42] fastreid INFO: [M_param] one_loss_for_iter: False
[12/18 14:12:42] fastreid INFO: [M_param] one_loss_order: forward
[12/18 14:12:42] fastreid INFO: [M_param] num_mtest: 3
[12/18 14:12:42] fastreid INFO: [M_param] sync: True
[12/18 14:12:42] fastreid INFO: [M_param] detail_mode: True
[12/18 14:12:42] fastreid INFO: [M_param] stop_gradient: True
[12/18 14:12:42] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/18 14:12:42] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/18 14:12:42] fastreid INFO: [M_param] main_zero_grad: True
[12/18 14:12:42] fastreid INFO: [M_param] norm_zero_grad: True
[12/18 14:12:42] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/18 14:12:42] fastreid INFO: [M_param] write_period_param: 1000
[12/18 14:12:42] fastreid INFO: [M_param] loss_combined: False
[12/18 14:12:42] fastreid INFO: [M_param] loss_weight: 1.0
[12/18 14:12:42] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/18 14:12:42] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/18 14:12:42] fastreid INFO: ------------------------------
[12/18 14:12:43] fastreid.utils.checkpoint INFO: Loading checkpoint from ./refs/logs/Sample/M-resnet\model_0015199.pth
[12/18 14:12:43] fastreid.utils.checkpoint INFO: Loading optimizer_main from ./refs/logs/Sample/M-resnet\model_0015199.pth
[12/18 14:12:43] fastreid.utils.checkpoint INFO: Loading scheduler_main from ./refs/logs/Sample/M-resnet\model_0015199.pth
[12/18 14:12:43] fastreid.utils.checkpoint INFO: Loading optimizer_norm from ./refs/logs/Sample/M-resnet\model_0015199.pth
[12/18 14:12:43] fastreid.utils.checkpoint INFO: Loading scheduler_norm from ./refs/logs/Sample/M-resnet\model_0015199.pth
[12/18 14:14:19] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 14:14:20] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 14:14:20] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 14:14:20] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 14:14:20] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 14:14:20] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 14:14:23] fastreid.data.datasets.bases INFO: => Loaded Market1501
[12/18 14:14:23] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 14:14:23] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 14:14:23] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 14:14:23] fastreid.data.datasets.bases INFO:   train    |   751 |    12936 |         6
[12/18 14:14:23] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 14:14:23] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 14:14:24] fastreid INFO: ------------------------------
[12/18 14:14:24] fastreid INFO: Meta-learning paramters
[12/18 14:14:24] fastreid INFO: ------------------------------
[12/18 14:14:24] fastreid INFO: [M_param] synth_data: none
[12/18 14:14:24] fastreid INFO: [M_param] synth_method: real
[12/18 14:14:24] fastreid INFO: [M_param] num_domain: 6
[12/18 14:14:24] fastreid INFO: [M_param] whole: True
[12/18 14:14:24] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/18 14:14:24] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/18 14:14:24] fastreid INFO: [M_param] meta_all_params: False
[12/18 14:14:24] fastreid INFO: [M_param] iter_init_inner: 1
[12/18 14:14:24] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/18 14:14:24] fastreid INFO: [M_param] iter_init_outer: 1
[12/18 14:14:24] fastreid INFO: [M_param] update_ratio: 0.0
[12/18 14:14:24] fastreid INFO: [M_param] iters_per_epoch: 145
[12/18 14:14:24] fastreid INFO: [M_param] iter_mtrain: 1
[12/18 14:14:24] fastreid INFO: [M_param] shuffle_domain: True
[12/18 14:14:24] fastreid INFO: [M_param] use_second_order: False
[12/18 14:14:24] fastreid INFO: [M_param] num_mtrain: 3
[12/18 14:14:24] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/18 14:14:24] fastreid INFO: [M_param] allow_unused: False
[12/18 14:14:24] fastreid INFO: [M_param] zero_grad: True
[12/18 14:14:24] fastreid INFO: [M_param] type_running_stats_init: general
[12/18 14:14:24] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/18 14:14:24] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/18 14:14:24] fastreid INFO: [M_param] auto_grad_outside: True
[12/18 14:14:24] fastreid INFO: [M_param] inner_clamp: True
[12/18 14:14:24] fastreid INFO: [M_param] synth_grad: none
[12/18 14:14:24] fastreid INFO: [M_param] constant_grad: 0.01
[12/18 14:14:24] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/18 14:14:24] fastreid INFO: [M_param] print_grad: True
[12/18 14:14:24] fastreid INFO: [M_param] one_loss_for_iter: False
[12/18 14:14:24] fastreid INFO: [M_param] one_loss_order: forward
[12/18 14:14:24] fastreid INFO: [M_param] num_mtest: 3
[12/18 14:14:24] fastreid INFO: [M_param] sync: True
[12/18 14:14:24] fastreid INFO: [M_param] detail_mode: True
[12/18 14:14:24] fastreid INFO: [M_param] stop_gradient: True
[12/18 14:14:24] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/18 14:14:24] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/18 14:14:24] fastreid INFO: [M_param] main_zero_grad: True
[12/18 14:14:24] fastreid INFO: [M_param] norm_zero_grad: True
[12/18 14:14:24] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/18 14:14:24] fastreid INFO: [M_param] write_period_param: 1000
[12/18 14:14:24] fastreid INFO: [M_param] loss_combined: False
[12/18 14:14:24] fastreid INFO: [M_param] loss_weight: 1.0
[12/18 14:14:24] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/18 14:14:24] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/18 14:14:24] fastreid INFO: ------------------------------
[12/18 14:14:25] fastreid.utils.checkpoint INFO: Loading checkpoint from ./refs/logs/Sample/M-resnet\model_0015199.pth
[12/18 14:14:25] fastreid.utils.checkpoint INFO: Loading optimizer_main from ./refs/logs/Sample/M-resnet\model_0015199.pth
[12/18 14:14:25] fastreid.utils.checkpoint INFO: Loading scheduler_main from ./refs/logs/Sample/M-resnet\model_0015199.pth
[12/18 14:14:25] fastreid.utils.checkpoint INFO: Loading optimizer_norm from ./refs/logs/Sample/M-resnet\model_0015199.pth
[12/18 14:14:25] fastreid.utils.checkpoint INFO: Loading scheduler_norm from ./refs/logs/Sample/M-resnet\model_0015199.pth
[12/18 14:15:22] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 14:15:23] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 14:15:23] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 14:15:23] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 14:15:23] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 14:15:23] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 14:15:25] fastreid.data.datasets.bases INFO: => Loaded Market1501
[12/18 14:15:25] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 14:15:25] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 14:15:25] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 14:15:25] fastreid.data.datasets.bases INFO:   train    |   751 |    12936 |         6
[12/18 14:15:25] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 14:15:25] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 14:15:27] fastreid INFO: ------------------------------
[12/18 14:15:27] fastreid INFO: Meta-learning paramters
[12/18 14:15:27] fastreid INFO: ------------------------------
[12/18 14:15:27] fastreid INFO: [M_param] synth_data: none
[12/18 14:15:27] fastreid INFO: [M_param] synth_method: real
[12/18 14:15:27] fastreid INFO: [M_param] num_domain: 6
[12/18 14:15:27] fastreid INFO: [M_param] whole: True
[12/18 14:15:27] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/18 14:15:27] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/18 14:15:27] fastreid INFO: [M_param] meta_all_params: False
[12/18 14:15:27] fastreid INFO: [M_param] iter_init_inner: 1
[12/18 14:15:27] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/18 14:15:27] fastreid INFO: [M_param] iter_init_outer: 1
[12/18 14:15:27] fastreid INFO: [M_param] update_ratio: 0.0
[12/18 14:15:27] fastreid INFO: [M_param] iters_per_epoch: 145
[12/18 14:15:27] fastreid INFO: [M_param] iter_mtrain: 1
[12/18 14:15:27] fastreid INFO: [M_param] shuffle_domain: True
[12/18 14:15:27] fastreid INFO: [M_param] use_second_order: False
[12/18 14:15:27] fastreid INFO: [M_param] num_mtrain: 3
[12/18 14:15:27] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/18 14:15:27] fastreid INFO: [M_param] allow_unused: False
[12/18 14:15:27] fastreid INFO: [M_param] zero_grad: True
[12/18 14:15:27] fastreid INFO: [M_param] type_running_stats_init: general
[12/18 14:15:27] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/18 14:15:27] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/18 14:15:27] fastreid INFO: [M_param] auto_grad_outside: True
[12/18 14:15:27] fastreid INFO: [M_param] inner_clamp: True
[12/18 14:15:27] fastreid INFO: [M_param] synth_grad: none
[12/18 14:15:27] fastreid INFO: [M_param] constant_grad: 0.01
[12/18 14:15:27] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/18 14:15:27] fastreid INFO: [M_param] print_grad: True
[12/18 14:15:27] fastreid INFO: [M_param] one_loss_for_iter: False
[12/18 14:15:27] fastreid INFO: [M_param] one_loss_order: forward
[12/18 14:15:27] fastreid INFO: [M_param] num_mtest: 3
[12/18 14:15:27] fastreid INFO: [M_param] sync: True
[12/18 14:15:27] fastreid INFO: [M_param] detail_mode: True
[12/18 14:15:27] fastreid INFO: [M_param] stop_gradient: True
[12/18 14:15:27] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/18 14:15:27] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/18 14:15:27] fastreid INFO: [M_param] main_zero_grad: True
[12/18 14:15:27] fastreid INFO: [M_param] norm_zero_grad: True
[12/18 14:15:27] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/18 14:15:27] fastreid INFO: [M_param] write_period_param: 1000
[12/18 14:15:27] fastreid INFO: [M_param] loss_combined: False
[12/18 14:15:27] fastreid INFO: [M_param] loss_weight: 1.0
[12/18 14:15:27] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/18 14:15:27] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/18 14:15:27] fastreid INFO: ------------------------------
[12/18 14:15:27] fastreid.utils.checkpoint INFO: Loading checkpoint from ./refs/logs/Sample/M-resnet\model_0015199.pth
[12/18 14:15:27] fastreid.utils.checkpoint INFO: Loading optimizer_main from ./refs/logs/Sample/M-resnet\model_0015199.pth
[12/18 14:15:27] fastreid.utils.checkpoint INFO: Loading scheduler_main from ./refs/logs/Sample/M-resnet\model_0015199.pth
[12/18 14:15:27] fastreid.utils.checkpoint INFO: Loading optimizer_norm from ./refs/logs/Sample/M-resnet\model_0015199.pth
[12/18 14:15:27] fastreid.utils.checkpoint INFO: Loading scheduler_norm from ./refs/logs/Sample/M-resnet\model_0015199.pth
[12/18 14:31:39] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 14:31:40] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 14:31:40] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 14:31:40] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 14:31:40] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 14:31:40] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 14:32:32] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 14:32:34] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 14:32:34] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 14:32:34] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 14:32:34] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 14:32:34] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 14:33:34] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 14:33:35] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 14:33:35] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 14:33:35] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 14:33:35] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 14:33:35] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 14:34:23] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 14:34:25] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 14:34:25] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 14:34:25] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 14:34:25] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 14:34:25] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 14:35:13] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 14:35:14] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 14:35:14] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 14:35:14] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 14:35:14] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 14:35:14] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 14:36:00] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 14:36:01] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 14:36:01] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 14:36:01] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 14:36:01] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 14:36:01] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 14:36:01] fastreid.data.datasets.bases INFO: => Loaded LiteData
[12/18 14:36:01] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 14:36:01] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 14:36:01] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 14:36:01] fastreid.data.datasets.bases INFO:   train    |     4 |       16 |         6
[12/18 14:36:01] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 14:36:02] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 14:36:04] fastreid INFO: ------------------------------
[12/18 14:36:04] fastreid INFO: Meta-learning paramters
[12/18 14:36:04] fastreid INFO: ------------------------------
[12/18 14:36:04] fastreid INFO: [M_param] synth_data: none
[12/18 14:36:04] fastreid INFO: [M_param] synth_method: real
[12/18 14:36:04] fastreid INFO: [M_param] num_domain: 6
[12/18 14:36:04] fastreid INFO: [M_param] whole: True
[12/18 14:36:04] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/18 14:36:04] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/18 14:36:04] fastreid INFO: [M_param] meta_all_params: False
[12/18 14:36:04] fastreid INFO: [M_param] iter_init_inner: 1
[12/18 14:36:04] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/18 14:36:04] fastreid INFO: [M_param] iter_init_outer: 1
[12/18 14:36:04] fastreid INFO: [M_param] update_ratio: 0.0
[12/18 14:36:04] fastreid INFO: [M_param] iters_per_epoch: -1
[12/18 14:36:04] fastreid INFO: [M_param] iter_mtrain: 1
[12/18 14:36:04] fastreid INFO: [M_param] shuffle_domain: True
[12/18 14:36:04] fastreid INFO: [M_param] use_second_order: False
[12/18 14:36:04] fastreid INFO: [M_param] num_mtrain: 3
[12/18 14:36:04] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/18 14:36:04] fastreid INFO: [M_param] allow_unused: False
[12/18 14:36:04] fastreid INFO: [M_param] zero_grad: True
[12/18 14:36:04] fastreid INFO: [M_param] type_running_stats_init: general
[12/18 14:36:04] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/18 14:36:04] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/18 14:36:04] fastreid INFO: [M_param] auto_grad_outside: True
[12/18 14:36:04] fastreid INFO: [M_param] inner_clamp: True
[12/18 14:36:04] fastreid INFO: [M_param] synth_grad: none
[12/18 14:36:04] fastreid INFO: [M_param] constant_grad: 0.01
[12/18 14:36:04] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/18 14:36:04] fastreid INFO: [M_param] print_grad: True
[12/18 14:36:04] fastreid INFO: [M_param] one_loss_for_iter: False
[12/18 14:36:04] fastreid INFO: [M_param] one_loss_order: forward
[12/18 14:36:04] fastreid INFO: [M_param] num_mtest: 3
[12/18 14:36:04] fastreid INFO: [M_param] sync: True
[12/18 14:36:04] fastreid INFO: [M_param] detail_mode: True
[12/18 14:36:04] fastreid INFO: [M_param] stop_gradient: True
[12/18 14:36:04] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/18 14:36:04] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/18 14:36:04] fastreid INFO: [M_param] main_zero_grad: True
[12/18 14:36:04] fastreid INFO: [M_param] norm_zero_grad: True
[12/18 14:36:04] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/18 14:36:04] fastreid INFO: [M_param] write_period_param: 1000
[12/18 14:36:04] fastreid INFO: [M_param] loss_combined: False
[12/18 14:36:04] fastreid INFO: [M_param] loss_weight: 1.0
[12/18 14:36:04] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/18 14:36:04] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/18 14:36:04] fastreid INFO: ------------------------------
[12/18 14:48:18] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 14:48:20] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 14:48:20] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 14:48:20] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 14:48:20] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 14:48:20] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 14:48:20] fastreid.data.datasets.bases INFO: => Loaded LiteData
[12/18 14:48:20] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 14:48:20] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 14:48:20] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 14:48:20] fastreid.data.datasets.bases INFO:   train    |     4 |       16 |         6
[12/18 14:48:20] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 14:48:20] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 14:48:22] fastreid INFO: ------------------------------
[12/18 14:48:22] fastreid INFO: Meta-learning paramters
[12/18 14:48:22] fastreid INFO: ------------------------------
[12/18 14:48:22] fastreid INFO: [M_param] synth_data: none
[12/18 14:48:22] fastreid INFO: [M_param] synth_method: real
[12/18 14:48:22] fastreid INFO: [M_param] num_domain: 6
[12/18 14:48:22] fastreid INFO: [M_param] whole: True
[12/18 14:48:22] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/18 14:48:22] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/18 14:48:22] fastreid INFO: [M_param] meta_all_params: False
[12/18 14:48:22] fastreid INFO: [M_param] iter_init_inner: 1
[12/18 14:48:22] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/18 14:48:22] fastreid INFO: [M_param] iter_init_outer: 1
[12/18 14:48:22] fastreid INFO: [M_param] update_ratio: 0.0
[12/18 14:48:22] fastreid INFO: [M_param] iters_per_epoch: -1
[12/18 14:48:22] fastreid INFO: [M_param] iter_mtrain: 1
[12/18 14:48:22] fastreid INFO: [M_param] shuffle_domain: True
[12/18 14:48:22] fastreid INFO: [M_param] use_second_order: False
[12/18 14:48:22] fastreid INFO: [M_param] num_mtrain: 3
[12/18 14:48:22] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/18 14:48:22] fastreid INFO: [M_param] allow_unused: False
[12/18 14:48:22] fastreid INFO: [M_param] zero_grad: True
[12/18 14:48:22] fastreid INFO: [M_param] type_running_stats_init: general
[12/18 14:48:22] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/18 14:48:22] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/18 14:48:22] fastreid INFO: [M_param] auto_grad_outside: True
[12/18 14:48:22] fastreid INFO: [M_param] inner_clamp: True
[12/18 14:48:22] fastreid INFO: [M_param] synth_grad: none
[12/18 14:48:22] fastreid INFO: [M_param] constant_grad: 0.01
[12/18 14:48:22] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/18 14:48:22] fastreid INFO: [M_param] print_grad: True
[12/18 14:48:22] fastreid INFO: [M_param] one_loss_for_iter: False
[12/18 14:48:22] fastreid INFO: [M_param] one_loss_order: forward
[12/18 14:48:22] fastreid INFO: [M_param] num_mtest: 3
[12/18 14:48:22] fastreid INFO: [M_param] sync: True
[12/18 14:48:22] fastreid INFO: [M_param] detail_mode: True
[12/18 14:48:22] fastreid INFO: [M_param] stop_gradient: True
[12/18 14:48:22] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/18 14:48:22] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/18 14:48:22] fastreid INFO: [M_param] main_zero_grad: True
[12/18 14:48:22] fastreid INFO: [M_param] norm_zero_grad: True
[12/18 14:48:22] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/18 14:48:22] fastreid INFO: [M_param] write_period_param: 1000
[12/18 14:48:22] fastreid INFO: [M_param] loss_combined: False
[12/18 14:48:22] fastreid INFO: [M_param] loss_weight: 1.0
[12/18 14:48:22] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/18 14:48:22] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/18 14:48:22] fastreid INFO: ------------------------------
[12/18 14:49:48] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 14:49:49] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 14:49:49] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 14:49:49] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 14:49:49] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 14:49:49] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 14:49:49] fastreid.data.datasets.bases INFO: => Loaded LiteData
[12/18 14:49:49] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 14:49:49] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 14:49:49] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 14:49:49] fastreid.data.datasets.bases INFO:   train    |     4 |       16 |         6
[12/18 14:49:49] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 14:49:49] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 14:50:11] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 14:50:12] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 14:50:12] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 14:50:12] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 14:50:12] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 14:50:12] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 14:50:12] fastreid.data.datasets.bases INFO: => Loaded LiteData
[12/18 14:50:12] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 14:50:12] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 14:50:12] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 14:50:12] fastreid.data.datasets.bases INFO:   train    |     4 |       16 |         6
[12/18 14:50:12] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 14:50:12] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 14:51:52] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 14:51:53] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 14:51:53] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 14:51:53] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 14:51:53] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 14:51:53] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 14:51:53] fastreid.data.datasets.bases INFO: => Loaded LiteData
[12/18 14:51:53] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 14:51:53] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 14:51:53] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 14:51:53] fastreid.data.datasets.bases INFO:   train    |     4 |       16 |         6
[12/18 14:51:53] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 14:51:53] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 14:53:30] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 14:53:31] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 14:53:31] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 14:53:31] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 14:53:31] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 14:53:31] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 14:53:31] fastreid.data.datasets.bases INFO: => Loaded LiteData
[12/18 14:53:31] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 14:53:31] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 14:53:31] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 14:53:31] fastreid.data.datasets.bases INFO:   train    |     4 |       16 |         6
[12/18 14:53:31] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 14:53:31] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 14:53:53] fastreid INFO: ------------------------------
[12/18 14:53:53] fastreid INFO: Meta-learning paramters
[12/18 14:53:53] fastreid INFO: ------------------------------
[12/18 14:53:53] fastreid INFO: [M_param] synth_data: none
[12/18 14:53:53] fastreid INFO: [M_param] synth_method: real
[12/18 14:53:53] fastreid INFO: [M_param] num_domain: 6
[12/18 14:53:53] fastreid INFO: [M_param] whole: True
[12/18 14:53:53] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/18 14:53:53] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/18 14:53:53] fastreid INFO: [M_param] meta_all_params: False
[12/18 14:53:53] fastreid INFO: [M_param] iter_init_inner: 1
[12/18 14:53:53] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/18 14:53:53] fastreid INFO: [M_param] iter_init_outer: 1
[12/18 14:53:53] fastreid INFO: [M_param] update_ratio: 0.0
[12/18 14:53:53] fastreid INFO: [M_param] iters_per_epoch: 1
[12/18 14:53:53] fastreid INFO: [M_param] iter_mtrain: 1
[12/18 14:53:53] fastreid INFO: [M_param] shuffle_domain: True
[12/18 14:53:53] fastreid INFO: [M_param] use_second_order: False
[12/18 14:53:53] fastreid INFO: [M_param] num_mtrain: 3
[12/18 14:53:53] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/18 14:53:53] fastreid INFO: [M_param] allow_unused: False
[12/18 14:53:53] fastreid INFO: [M_param] zero_grad: True
[12/18 14:53:53] fastreid INFO: [M_param] type_running_stats_init: general
[12/18 14:53:53] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/18 14:53:53] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/18 14:53:53] fastreid INFO: [M_param] auto_grad_outside: True
[12/18 14:53:53] fastreid INFO: [M_param] inner_clamp: True
[12/18 14:53:53] fastreid INFO: [M_param] synth_grad: none
[12/18 14:53:53] fastreid INFO: [M_param] constant_grad: 0.01
[12/18 14:53:53] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/18 14:53:53] fastreid INFO: [M_param] print_grad: True
[12/18 14:53:53] fastreid INFO: [M_param] one_loss_for_iter: False
[12/18 14:53:53] fastreid INFO: [M_param] one_loss_order: forward
[12/18 14:53:53] fastreid INFO: [M_param] num_mtest: 3
[12/18 14:53:53] fastreid INFO: [M_param] sync: True
[12/18 14:53:53] fastreid INFO: [M_param] detail_mode: True
[12/18 14:53:53] fastreid INFO: [M_param] stop_gradient: True
[12/18 14:53:53] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/18 14:53:53] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/18 14:53:53] fastreid INFO: [M_param] main_zero_grad: True
[12/18 14:53:53] fastreid INFO: [M_param] norm_zero_grad: True
[12/18 14:53:53] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/18 14:53:53] fastreid INFO: [M_param] write_period_param: 1000
[12/18 14:53:53] fastreid INFO: [M_param] loss_combined: False
[12/18 14:53:53] fastreid INFO: [M_param] loss_weight: 1.0
[12/18 14:53:53] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/18 14:53:53] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/18 14:53:53] fastreid INFO: ------------------------------
[12/18 17:37:04] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 17:37:06] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 17:37:06] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 17:37:06] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 17:37:06] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 17:37:06] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 17:37:06] fastreid.data.datasets.bases INFO: => Loaded LiteData
[12/18 17:37:06] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 17:37:06] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 17:37:06] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 17:37:06] fastreid.data.datasets.bases INFO:   train    |     4 |       16 |         6
[12/18 17:37:06] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 17:37:06] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 17:37:18] fastreid INFO: ------------------------------
[12/18 17:37:18] fastreid INFO: Meta-learning paramters
[12/18 17:37:18] fastreid INFO: ------------------------------
[12/18 17:37:18] fastreid INFO: [M_param] synth_data: none
[12/18 17:37:18] fastreid INFO: [M_param] synth_method: real
[12/18 17:37:18] fastreid INFO: [M_param] num_domain: 6
[12/18 17:37:18] fastreid INFO: [M_param] whole: True
[12/18 17:37:18] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/18 17:37:18] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/18 17:37:18] fastreid INFO: [M_param] meta_all_params: False
[12/18 17:37:18] fastreid INFO: [M_param] iter_init_inner: 1
[12/18 17:37:18] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/18 17:37:18] fastreid INFO: [M_param] iter_init_outer: 1
[12/18 17:37:18] fastreid INFO: [M_param] update_ratio: 0.0
[12/18 17:37:18] fastreid INFO: [M_param] iters_per_epoch: 0
[12/18 17:37:18] fastreid INFO: [M_param] iter_mtrain: 1
[12/18 17:37:18] fastreid INFO: [M_param] shuffle_domain: True
[12/18 17:37:18] fastreid INFO: [M_param] use_second_order: False
[12/18 17:37:18] fastreid INFO: [M_param] num_mtrain: 3
[12/18 17:37:18] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/18 17:37:18] fastreid INFO: [M_param] allow_unused: False
[12/18 17:37:18] fastreid INFO: [M_param] zero_grad: True
[12/18 17:37:18] fastreid INFO: [M_param] type_running_stats_init: general
[12/18 17:37:18] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/18 17:37:18] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/18 17:37:18] fastreid INFO: [M_param] auto_grad_outside: True
[12/18 17:37:18] fastreid INFO: [M_param] inner_clamp: True
[12/18 17:37:18] fastreid INFO: [M_param] synth_grad: none
[12/18 17:37:18] fastreid INFO: [M_param] constant_grad: 0.01
[12/18 17:37:18] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/18 17:37:18] fastreid INFO: [M_param] print_grad: True
[12/18 17:37:18] fastreid INFO: [M_param] one_loss_for_iter: False
[12/18 17:37:18] fastreid INFO: [M_param] one_loss_order: forward
[12/18 17:37:18] fastreid INFO: [M_param] num_mtest: 3
[12/18 17:37:18] fastreid INFO: [M_param] sync: True
[12/18 17:37:18] fastreid INFO: [M_param] detail_mode: True
[12/18 17:37:18] fastreid INFO: [M_param] stop_gradient: True
[12/18 17:37:18] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/18 17:37:18] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/18 17:37:18] fastreid INFO: [M_param] main_zero_grad: True
[12/18 17:37:18] fastreid INFO: [M_param] norm_zero_grad: True
[12/18 17:37:18] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/18 17:37:18] fastreid INFO: [M_param] write_period_param: 1000
[12/18 17:37:18] fastreid INFO: [M_param] loss_combined: False
[12/18 17:37:18] fastreid INFO: [M_param] loss_weight: 1.0
[12/18 17:37:18] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/18 17:37:18] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/18 17:37:18] fastreid INFO: ------------------------------
[12/18 17:38:03] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 17:38:04] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 17:38:04] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 17:38:04] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 17:38:04] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 17:38:04] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 17:38:05] fastreid.data.datasets.bases INFO: => Loaded Market1501
[12/18 17:38:05] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 17:38:05] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 17:38:05] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 17:38:05] fastreid.data.datasets.bases INFO:   train    |   751 |    12936 |         6
[12/18 17:38:05] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 17:38:05] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 17:38:07] fastreid INFO: ------------------------------
[12/18 17:38:07] fastreid INFO: Meta-learning paramters
[12/18 17:38:07] fastreid INFO: ------------------------------
[12/18 17:38:07] fastreid INFO: [M_param] synth_data: none
[12/18 17:38:07] fastreid INFO: [M_param] synth_method: real
[12/18 17:38:07] fastreid INFO: [M_param] num_domain: 6
[12/18 17:38:07] fastreid INFO: [M_param] whole: True
[12/18 17:38:07] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/18 17:38:07] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/18 17:38:07] fastreid INFO: [M_param] meta_all_params: False
[12/18 17:38:07] fastreid INFO: [M_param] iter_init_inner: 1
[12/18 17:38:07] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/18 17:38:07] fastreid INFO: [M_param] iter_init_outer: 1
[12/18 17:38:07] fastreid INFO: [M_param] update_ratio: 0.0
[12/18 17:38:07] fastreid INFO: [M_param] iters_per_epoch: 145
[12/18 17:38:07] fastreid INFO: [M_param] iter_mtrain: 1
[12/18 17:38:07] fastreid INFO: [M_param] shuffle_domain: True
[12/18 17:38:07] fastreid INFO: [M_param] use_second_order: False
[12/18 17:38:07] fastreid INFO: [M_param] num_mtrain: 3
[12/18 17:38:07] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/18 17:38:07] fastreid INFO: [M_param] allow_unused: False
[12/18 17:38:07] fastreid INFO: [M_param] zero_grad: True
[12/18 17:38:07] fastreid INFO: [M_param] type_running_stats_init: general
[12/18 17:38:07] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/18 17:38:07] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/18 17:38:07] fastreid INFO: [M_param] auto_grad_outside: True
[12/18 17:38:07] fastreid INFO: [M_param] inner_clamp: True
[12/18 17:38:07] fastreid INFO: [M_param] synth_grad: none
[12/18 17:38:07] fastreid INFO: [M_param] constant_grad: 0.01
[12/18 17:38:07] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/18 17:38:07] fastreid INFO: [M_param] print_grad: True
[12/18 17:38:07] fastreid INFO: [M_param] one_loss_for_iter: False
[12/18 17:38:07] fastreid INFO: [M_param] one_loss_order: forward
[12/18 17:38:07] fastreid INFO: [M_param] num_mtest: 3
[12/18 17:38:07] fastreid INFO: [M_param] sync: True
[12/18 17:38:07] fastreid INFO: [M_param] detail_mode: True
[12/18 17:38:07] fastreid INFO: [M_param] stop_gradient: True
[12/18 17:38:07] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/18 17:38:07] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/18 17:38:07] fastreid INFO: [M_param] main_zero_grad: True
[12/18 17:38:07] fastreid INFO: [M_param] norm_zero_grad: True
[12/18 17:38:07] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/18 17:38:07] fastreid INFO: [M_param] write_period_param: 1000
[12/18 17:38:07] fastreid INFO: [M_param] loss_combined: False
[12/18 17:38:07] fastreid INFO: [M_param] loss_weight: 1.0
[12/18 17:38:07] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/18 17:38:07] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/18 17:38:07] fastreid INFO: ------------------------------
[12/18 17:39:22] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 17:39:23] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 17:39:23] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 17:39:23] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 17:39:23] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 17:39:23] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 17:39:24] fastreid.data.datasets.bases INFO: => Loaded Market1501
[12/18 17:39:24] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 17:39:24] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 17:39:24] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 17:39:24] fastreid.data.datasets.bases INFO:   train    |   751 |    12936 |         6
[12/18 17:39:24] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 17:39:24] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 17:39:26] fastreid INFO: ------------------------------
[12/18 17:39:26] fastreid INFO: Meta-learning paramters
[12/18 17:39:26] fastreid INFO: ------------------------------
[12/18 17:39:26] fastreid INFO: [M_param] synth_data: none
[12/18 17:39:26] fastreid INFO: [M_param] synth_method: real
[12/18 17:39:26] fastreid INFO: [M_param] num_domain: 6
[12/18 17:39:26] fastreid INFO: [M_param] whole: True
[12/18 17:39:26] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/18 17:39:26] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/18 17:39:26] fastreid INFO: [M_param] meta_all_params: False
[12/18 17:39:26] fastreid INFO: [M_param] iter_init_inner: 1
[12/18 17:39:26] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/18 17:39:26] fastreid INFO: [M_param] iter_init_outer: 1
[12/18 17:39:26] fastreid INFO: [M_param] update_ratio: 0.0
[12/18 17:39:26] fastreid INFO: [M_param] iters_per_epoch: 145
[12/18 17:39:26] fastreid INFO: [M_param] iter_mtrain: 1
[12/18 17:39:26] fastreid INFO: [M_param] shuffle_domain: True
[12/18 17:39:26] fastreid INFO: [M_param] use_second_order: False
[12/18 17:39:26] fastreid INFO: [M_param] num_mtrain: 3
[12/18 17:39:26] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/18 17:39:26] fastreid INFO: [M_param] allow_unused: False
[12/18 17:39:26] fastreid INFO: [M_param] zero_grad: True
[12/18 17:39:26] fastreid INFO: [M_param] type_running_stats_init: general
[12/18 17:39:26] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/18 17:39:26] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/18 17:39:26] fastreid INFO: [M_param] auto_grad_outside: True
[12/18 17:39:26] fastreid INFO: [M_param] inner_clamp: True
[12/18 17:39:26] fastreid INFO: [M_param] synth_grad: none
[12/18 17:39:26] fastreid INFO: [M_param] constant_grad: 0.01
[12/18 17:39:26] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/18 17:39:26] fastreid INFO: [M_param] print_grad: True
[12/18 17:39:26] fastreid INFO: [M_param] one_loss_for_iter: False
[12/18 17:39:26] fastreid INFO: [M_param] one_loss_order: forward
[12/18 17:39:26] fastreid INFO: [M_param] num_mtest: 3
[12/18 17:39:26] fastreid INFO: [M_param] sync: True
[12/18 17:39:26] fastreid INFO: [M_param] detail_mode: True
[12/18 17:39:26] fastreid INFO: [M_param] stop_gradient: True
[12/18 17:39:26] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/18 17:39:26] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/18 17:39:26] fastreid INFO: [M_param] main_zero_grad: True
[12/18 17:39:26] fastreid INFO: [M_param] norm_zero_grad: True
[12/18 17:39:26] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/18 17:39:26] fastreid INFO: [M_param] write_period_param: 1000
[12/18 17:39:26] fastreid INFO: [M_param] loss_combined: False
[12/18 17:39:26] fastreid INFO: [M_param] loss_weight: 1.0
[12/18 17:39:26] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/18 17:39:26] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/18 17:39:26] fastreid INFO: ------------------------------
[12/18 17:40:48] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 17:40:50] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 17:40:50] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 17:40:50] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 17:40:50] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 17:40:50] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 17:40:50] fastreid.data.datasets.bases INFO: => Loaded LiteData
[12/18 17:40:50] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 17:40:50] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 17:40:50] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 17:40:50] fastreid.data.datasets.bases INFO:   train    |     4 |       16 |         6
[12/18 17:40:50] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 17:40:50] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 17:40:52] fastreid INFO: ------------------------------
[12/18 17:40:52] fastreid INFO: Meta-learning paramters
[12/18 17:40:52] fastreid INFO: ------------------------------
[12/18 17:40:52] fastreid INFO: [M_param] synth_data: none
[12/18 17:40:52] fastreid INFO: [M_param] synth_method: real
[12/18 17:40:52] fastreid INFO: [M_param] num_domain: 6
[12/18 17:40:52] fastreid INFO: [M_param] whole: True
[12/18 17:40:52] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/18 17:40:52] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/18 17:40:52] fastreid INFO: [M_param] meta_all_params: False
[12/18 17:40:52] fastreid INFO: [M_param] iter_init_inner: 1
[12/18 17:40:52] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/18 17:40:52] fastreid INFO: [M_param] iter_init_outer: 1
[12/18 17:40:52] fastreid INFO: [M_param] update_ratio: 0.0
[12/18 17:40:52] fastreid INFO: [M_param] iters_per_epoch: 0
[12/18 17:40:52] fastreid INFO: [M_param] iter_mtrain: 1
[12/18 17:40:52] fastreid INFO: [M_param] shuffle_domain: True
[12/18 17:40:52] fastreid INFO: [M_param] use_second_order: False
[12/18 17:40:52] fastreid INFO: [M_param] num_mtrain: 3
[12/18 17:40:52] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/18 17:40:52] fastreid INFO: [M_param] allow_unused: False
[12/18 17:40:52] fastreid INFO: [M_param] zero_grad: True
[12/18 17:40:52] fastreid INFO: [M_param] type_running_stats_init: general
[12/18 17:40:52] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/18 17:40:52] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/18 17:40:52] fastreid INFO: [M_param] auto_grad_outside: True
[12/18 17:40:52] fastreid INFO: [M_param] inner_clamp: True
[12/18 17:40:52] fastreid INFO: [M_param] synth_grad: none
[12/18 17:40:52] fastreid INFO: [M_param] constant_grad: 0.01
[12/18 17:40:52] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/18 17:40:52] fastreid INFO: [M_param] print_grad: True
[12/18 17:40:52] fastreid INFO: [M_param] one_loss_for_iter: False
[12/18 17:40:52] fastreid INFO: [M_param] one_loss_order: forward
[12/18 17:40:52] fastreid INFO: [M_param] num_mtest: 3
[12/18 17:40:52] fastreid INFO: [M_param] sync: True
[12/18 17:40:52] fastreid INFO: [M_param] detail_mode: True
[12/18 17:40:52] fastreid INFO: [M_param] stop_gradient: True
[12/18 17:40:52] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/18 17:40:52] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/18 17:40:52] fastreid INFO: [M_param] main_zero_grad: True
[12/18 17:40:52] fastreid INFO: [M_param] norm_zero_grad: True
[12/18 17:40:52] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/18 17:40:52] fastreid INFO: [M_param] write_period_param: 1000
[12/18 17:40:52] fastreid INFO: [M_param] loss_combined: False
[12/18 17:40:52] fastreid INFO: [M_param] loss_weight: 1.0
[12/18 17:40:52] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/18 17:40:52] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/18 17:40:52] fastreid INFO: ------------------------------
[12/18 17:41:48] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 17:41:49] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 17:41:49] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 17:41:49] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 17:41:49] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 17:41:49] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 17:41:49] fastreid.data.datasets.bases INFO: => Loaded LiteData
[12/18 17:41:49] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 17:41:49] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 17:41:49] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 17:41:49] fastreid.data.datasets.bases INFO:   train    |     4 |       16 |         6
[12/18 17:41:49] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 17:41:49] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 17:41:51] fastreid INFO: ------------------------------
[12/18 17:41:51] fastreid INFO: Meta-learning paramters
[12/18 17:41:51] fastreid INFO: ------------------------------
[12/18 17:41:51] fastreid INFO: [M_param] synth_data: none
[12/18 17:41:51] fastreid INFO: [M_param] synth_method: real
[12/18 17:41:51] fastreid INFO: [M_param] num_domain: 6
[12/18 17:41:51] fastreid INFO: [M_param] whole: True
[12/18 17:41:51] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/18 17:41:51] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/18 17:41:51] fastreid INFO: [M_param] meta_all_params: False
[12/18 17:41:51] fastreid INFO: [M_param] iter_init_inner: 1
[12/18 17:41:51] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/18 17:41:51] fastreid INFO: [M_param] iter_init_outer: 1
[12/18 17:41:51] fastreid INFO: [M_param] update_ratio: 0.0
[12/18 17:41:51] fastreid INFO: [M_param] iters_per_epoch: 1
[12/18 17:41:51] fastreid INFO: [M_param] iter_mtrain: 1
[12/18 17:41:51] fastreid INFO: [M_param] shuffle_domain: True
[12/18 17:41:51] fastreid INFO: [M_param] use_second_order: False
[12/18 17:41:51] fastreid INFO: [M_param] num_mtrain: 3
[12/18 17:41:51] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/18 17:41:51] fastreid INFO: [M_param] allow_unused: False
[12/18 17:41:51] fastreid INFO: [M_param] zero_grad: True
[12/18 17:41:51] fastreid INFO: [M_param] type_running_stats_init: general
[12/18 17:41:51] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/18 17:41:51] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/18 17:41:51] fastreid INFO: [M_param] auto_grad_outside: True
[12/18 17:41:51] fastreid INFO: [M_param] inner_clamp: True
[12/18 17:41:51] fastreid INFO: [M_param] synth_grad: none
[12/18 17:41:51] fastreid INFO: [M_param] constant_grad: 0.01
[12/18 17:41:51] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/18 17:41:51] fastreid INFO: [M_param] print_grad: True
[12/18 17:41:51] fastreid INFO: [M_param] one_loss_for_iter: False
[12/18 17:41:51] fastreid INFO: [M_param] one_loss_order: forward
[12/18 17:41:51] fastreid INFO: [M_param] num_mtest: 3
[12/18 17:41:51] fastreid INFO: [M_param] sync: True
[12/18 17:41:51] fastreid INFO: [M_param] detail_mode: True
[12/18 17:41:51] fastreid INFO: [M_param] stop_gradient: True
[12/18 17:41:51] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/18 17:41:51] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/18 17:41:51] fastreid INFO: [M_param] main_zero_grad: True
[12/18 17:41:51] fastreid INFO: [M_param] norm_zero_grad: True
[12/18 17:41:51] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/18 17:41:51] fastreid INFO: [M_param] write_period_param: 1000
[12/18 17:41:51] fastreid INFO: [M_param] loss_combined: False
[12/18 17:41:51] fastreid INFO: [M_param] loss_weight: 1.0
[12/18 17:41:51] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/18 17:41:51] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/18 17:41:51] fastreid INFO: ------------------------------
[12/18 17:43:16] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 17:43:17] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 17:43:17] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 17:43:17] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 17:43:17] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 17:43:17] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 17:43:17] fastreid.data.datasets.bases INFO: => Loaded LiteData
[12/18 17:43:17] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 17:43:17] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 17:43:17] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 17:43:17] fastreid.data.datasets.bases INFO:   train    |     4 |       16 |         6
[12/18 17:43:17] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 17:43:17] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 17:43:19] fastreid INFO: ------------------------------
[12/18 17:43:19] fastreid INFO: Meta-learning paramters
[12/18 17:43:19] fastreid INFO: ------------------------------
[12/18 17:43:19] fastreid INFO: [M_param] synth_data: none
[12/18 17:43:19] fastreid INFO: [M_param] synth_method: real
[12/18 17:43:19] fastreid INFO: [M_param] num_domain: 6
[12/18 17:43:19] fastreid INFO: [M_param] whole: True
[12/18 17:43:19] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/18 17:43:19] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/18 17:43:19] fastreid INFO: [M_param] meta_all_params: False
[12/18 17:43:19] fastreid INFO: [M_param] iter_init_inner: 1
[12/18 17:43:19] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/18 17:43:19] fastreid INFO: [M_param] iter_init_outer: 1
[12/18 17:43:19] fastreid INFO: [M_param] update_ratio: 0.0
[12/18 17:43:19] fastreid INFO: [M_param] iters_per_epoch: 1
[12/18 17:43:19] fastreid INFO: [M_param] iter_mtrain: 1
[12/18 17:43:19] fastreid INFO: [M_param] shuffle_domain: True
[12/18 17:43:19] fastreid INFO: [M_param] use_second_order: False
[12/18 17:43:19] fastreid INFO: [M_param] num_mtrain: 3
[12/18 17:43:19] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/18 17:43:19] fastreid INFO: [M_param] allow_unused: False
[12/18 17:43:19] fastreid INFO: [M_param] zero_grad: True
[12/18 17:43:19] fastreid INFO: [M_param] type_running_stats_init: general
[12/18 17:43:19] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/18 17:43:19] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/18 17:43:19] fastreid INFO: [M_param] auto_grad_outside: True
[12/18 17:43:19] fastreid INFO: [M_param] inner_clamp: True
[12/18 17:43:19] fastreid INFO: [M_param] synth_grad: none
[12/18 17:43:19] fastreid INFO: [M_param] constant_grad: 0.01
[12/18 17:43:19] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/18 17:43:19] fastreid INFO: [M_param] print_grad: True
[12/18 17:43:19] fastreid INFO: [M_param] one_loss_for_iter: False
[12/18 17:43:19] fastreid INFO: [M_param] one_loss_order: forward
[12/18 17:43:19] fastreid INFO: [M_param] num_mtest: 3
[12/18 17:43:19] fastreid INFO: [M_param] sync: True
[12/18 17:43:19] fastreid INFO: [M_param] detail_mode: True
[12/18 17:43:19] fastreid INFO: [M_param] stop_gradient: True
[12/18 17:43:19] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/18 17:43:19] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/18 17:43:19] fastreid INFO: [M_param] main_zero_grad: True
[12/18 17:43:19] fastreid INFO: [M_param] norm_zero_grad: True
[12/18 17:43:19] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/18 17:43:19] fastreid INFO: [M_param] write_period_param: 1000
[12/18 17:43:19] fastreid INFO: [M_param] loss_combined: False
[12/18 17:43:19] fastreid INFO: [M_param] loss_weight: 1.0
[12/18 17:43:19] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/18 17:43:19] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/18 17:43:19] fastreid INFO: ------------------------------
[12/18 17:44:53] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 17:44:54] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 17:44:54] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 17:44:54] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 17:44:54] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 17:44:54] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 17:44:54] fastreid.data.datasets.bases INFO: => Loaded LiteData
[12/18 17:44:54] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 17:44:54] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 17:44:54] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 17:44:54] fastreid.data.datasets.bases INFO:   train    |     4 |       16 |         6
[12/18 17:44:54] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 17:44:54] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 17:44:56] fastreid INFO: ------------------------------
[12/18 17:44:56] fastreid INFO: Meta-learning paramters
[12/18 17:44:56] fastreid INFO: ------------------------------
[12/18 17:44:56] fastreid INFO: [M_param] synth_data: none
[12/18 17:44:56] fastreid INFO: [M_param] synth_method: real
[12/18 17:44:56] fastreid INFO: [M_param] num_domain: 6
[12/18 17:44:56] fastreid INFO: [M_param] whole: True
[12/18 17:44:56] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/18 17:44:56] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/18 17:44:56] fastreid INFO: [M_param] meta_all_params: False
[12/18 17:44:56] fastreid INFO: [M_param] iter_init_inner: 1
[12/18 17:44:56] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/18 17:44:56] fastreid INFO: [M_param] iter_init_outer: 1
[12/18 17:44:56] fastreid INFO: [M_param] update_ratio: 0.0
[12/18 17:44:56] fastreid INFO: [M_param] iters_per_epoch: 1
[12/18 17:44:56] fastreid INFO: [M_param] iter_mtrain: 1
[12/18 17:44:56] fastreid INFO: [M_param] shuffle_domain: True
[12/18 17:44:56] fastreid INFO: [M_param] use_second_order: False
[12/18 17:44:56] fastreid INFO: [M_param] num_mtrain: 3
[12/18 17:44:56] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/18 17:44:56] fastreid INFO: [M_param] allow_unused: False
[12/18 17:44:56] fastreid INFO: [M_param] zero_grad: True
[12/18 17:44:56] fastreid INFO: [M_param] type_running_stats_init: general
[12/18 17:44:56] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/18 17:44:56] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/18 17:44:56] fastreid INFO: [M_param] auto_grad_outside: True
[12/18 17:44:56] fastreid INFO: [M_param] inner_clamp: True
[12/18 17:44:56] fastreid INFO: [M_param] synth_grad: none
[12/18 17:44:56] fastreid INFO: [M_param] constant_grad: 0.01
[12/18 17:44:56] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/18 17:44:56] fastreid INFO: [M_param] print_grad: True
[12/18 17:44:56] fastreid INFO: [M_param] one_loss_for_iter: False
[12/18 17:44:56] fastreid INFO: [M_param] one_loss_order: forward
[12/18 17:44:56] fastreid INFO: [M_param] num_mtest: 3
[12/18 17:44:56] fastreid INFO: [M_param] sync: True
[12/18 17:44:56] fastreid INFO: [M_param] detail_mode: True
[12/18 17:44:56] fastreid INFO: [M_param] stop_gradient: True
[12/18 17:44:56] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/18 17:44:56] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/18 17:44:56] fastreid INFO: [M_param] main_zero_grad: True
[12/18 17:44:56] fastreid INFO: [M_param] norm_zero_grad: True
[12/18 17:44:56] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/18 17:44:56] fastreid INFO: [M_param] write_period_param: 1000
[12/18 17:44:56] fastreid INFO: [M_param] loss_combined: False
[12/18 17:44:56] fastreid INFO: [M_param] loss_weight: 1.0
[12/18 17:44:56] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/18 17:44:56] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/18 17:44:56] fastreid INFO: ------------------------------
[12/18 18:07:32] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 18:07:33] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 18:07:33] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 18:07:33] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 18:07:33] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 18:07:33] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 18:07:33] fastreid.data.datasets.bases INFO: => Loaded LiteData
[12/18 18:07:33] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 18:07:33] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 18:07:33] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 18:07:33] fastreid.data.datasets.bases INFO:   train    |     4 |       16 |         6
[12/18 18:07:33] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 18:07:33] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 18:07:35] fastreid INFO: ------------------------------
[12/18 18:07:35] fastreid INFO: Meta-learning paramters
[12/18 18:07:35] fastreid INFO: ------------------------------
[12/18 18:07:35] fastreid INFO: [M_param] synth_data: none
[12/18 18:07:35] fastreid INFO: [M_param] synth_method: real
[12/18 18:07:35] fastreid INFO: [M_param] num_domain: 6
[12/18 18:07:35] fastreid INFO: [M_param] whole: True
[12/18 18:07:35] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/18 18:07:35] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/18 18:07:35] fastreid INFO: [M_param] meta_all_params: False
[12/18 18:07:35] fastreid INFO: [M_param] iter_init_inner: 1
[12/18 18:07:35] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/18 18:07:35] fastreid INFO: [M_param] iter_init_outer: 1
[12/18 18:07:35] fastreid INFO: [M_param] update_ratio: 0.0
[12/18 18:07:35] fastreid INFO: [M_param] iters_per_epoch: 1
[12/18 18:07:35] fastreid INFO: [M_param] iter_mtrain: 1
[12/18 18:07:35] fastreid INFO: [M_param] shuffle_domain: True
[12/18 18:07:35] fastreid INFO: [M_param] use_second_order: False
[12/18 18:07:35] fastreid INFO: [M_param] num_mtrain: 3
[12/18 18:07:35] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/18 18:07:35] fastreid INFO: [M_param] allow_unused: False
[12/18 18:07:35] fastreid INFO: [M_param] zero_grad: True
[12/18 18:07:35] fastreid INFO: [M_param] type_running_stats_init: general
[12/18 18:07:35] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/18 18:07:35] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/18 18:07:35] fastreid INFO: [M_param] auto_grad_outside: True
[12/18 18:07:35] fastreid INFO: [M_param] inner_clamp: True
[12/18 18:07:35] fastreid INFO: [M_param] synth_grad: none
[12/18 18:07:35] fastreid INFO: [M_param] constant_grad: 0.01
[12/18 18:07:35] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/18 18:07:35] fastreid INFO: [M_param] print_grad: True
[12/18 18:07:35] fastreid INFO: [M_param] one_loss_for_iter: False
[12/18 18:07:35] fastreid INFO: [M_param] one_loss_order: forward
[12/18 18:07:35] fastreid INFO: [M_param] num_mtest: 3
[12/18 18:07:35] fastreid INFO: [M_param] sync: True
[12/18 18:07:35] fastreid INFO: [M_param] detail_mode: True
[12/18 18:07:35] fastreid INFO: [M_param] stop_gradient: True
[12/18 18:07:35] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/18 18:07:35] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/18 18:07:35] fastreid INFO: [M_param] main_zero_grad: True
[12/18 18:07:35] fastreid INFO: [M_param] norm_zero_grad: True
[12/18 18:07:35] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/18 18:07:35] fastreid INFO: [M_param] write_period_param: 1000
[12/18 18:07:35] fastreid INFO: [M_param] loss_combined: False
[12/18 18:07:35] fastreid INFO: [M_param] loss_weight: 1.0
[12/18 18:07:35] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/18 18:07:35] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/18 18:07:35] fastreid INFO: ------------------------------
[12/18 18:08:36] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 18:08:37] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 18:08:37] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 18:08:37] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 18:08:37] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 18:08:37] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 18:08:37] fastreid.data.datasets.bases INFO: => Loaded LiteData
[12/18 18:08:37] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 18:08:37] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 18:08:37] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 18:08:37] fastreid.data.datasets.bases INFO:   train    |     4 |       16 |         6
[12/18 18:08:37] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 18:08:37] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 18:08:39] fastreid INFO: ------------------------------
[12/18 18:08:39] fastreid INFO: Meta-learning paramters
[12/18 18:08:39] fastreid INFO: ------------------------------
[12/18 18:08:39] fastreid INFO: [M_param] synth_data: none
[12/18 18:08:39] fastreid INFO: [M_param] synth_method: real
[12/18 18:08:39] fastreid INFO: [M_param] num_domain: 6
[12/18 18:08:39] fastreid INFO: [M_param] whole: True
[12/18 18:08:39] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/18 18:08:39] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/18 18:08:39] fastreid INFO: [M_param] meta_all_params: False
[12/18 18:08:39] fastreid INFO: [M_param] iter_init_inner: 1
[12/18 18:08:39] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/18 18:08:39] fastreid INFO: [M_param] iter_init_outer: 1
[12/18 18:08:39] fastreid INFO: [M_param] update_ratio: 0.0
[12/18 18:08:39] fastreid INFO: [M_param] iters_per_epoch: 1
[12/18 18:08:39] fastreid INFO: [M_param] iter_mtrain: 1
[12/18 18:08:39] fastreid INFO: [M_param] shuffle_domain: True
[12/18 18:08:39] fastreid INFO: [M_param] use_second_order: False
[12/18 18:08:39] fastreid INFO: [M_param] num_mtrain: 3
[12/18 18:08:39] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/18 18:08:39] fastreid INFO: [M_param] allow_unused: False
[12/18 18:08:39] fastreid INFO: [M_param] zero_grad: True
[12/18 18:08:39] fastreid INFO: [M_param] type_running_stats_init: general
[12/18 18:08:39] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/18 18:08:39] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/18 18:08:39] fastreid INFO: [M_param] auto_grad_outside: True
[12/18 18:08:39] fastreid INFO: [M_param] inner_clamp: True
[12/18 18:08:39] fastreid INFO: [M_param] synth_grad: none
[12/18 18:08:39] fastreid INFO: [M_param] constant_grad: 0.01
[12/18 18:08:39] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/18 18:08:39] fastreid INFO: [M_param] print_grad: True
[12/18 18:08:39] fastreid INFO: [M_param] one_loss_for_iter: False
[12/18 18:08:39] fastreid INFO: [M_param] one_loss_order: forward
[12/18 18:08:39] fastreid INFO: [M_param] num_mtest: 3
[12/18 18:08:39] fastreid INFO: [M_param] sync: True
[12/18 18:08:39] fastreid INFO: [M_param] detail_mode: True
[12/18 18:08:39] fastreid INFO: [M_param] stop_gradient: True
[12/18 18:08:39] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/18 18:08:39] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/18 18:08:39] fastreid INFO: [M_param] main_zero_grad: True
[12/18 18:08:39] fastreid INFO: [M_param] norm_zero_grad: True
[12/18 18:08:39] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/18 18:08:39] fastreid INFO: [M_param] write_period_param: 1000
[12/18 18:08:39] fastreid INFO: [M_param] loss_combined: False
[12/18 18:08:39] fastreid INFO: [M_param] loss_weight: 1.0
[12/18 18:08:39] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/18 18:08:39] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/18 18:08:39] fastreid INFO: ------------------------------
[12/18 18:09:08] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 18:09:10] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 18:09:10] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 18:09:10] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 18:09:10] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 18:09:10] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 18:09:10] fastreid.data.datasets.bases INFO: => Loaded LiteData
[12/18 18:09:10] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 18:09:10] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 18:09:10] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 18:09:10] fastreid.data.datasets.bases INFO:   train    |     4 |       16 |         6
[12/18 18:09:10] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 18:09:10] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 18:09:12] fastreid INFO: ------------------------------
[12/18 18:09:12] fastreid INFO: Meta-learning paramters
[12/18 18:09:12] fastreid INFO: ------------------------------
[12/18 18:09:12] fastreid INFO: [M_param] synth_data: none
[12/18 18:09:12] fastreid INFO: [M_param] synth_method: real
[12/18 18:09:12] fastreid INFO: [M_param] num_domain: 6
[12/18 18:09:12] fastreid INFO: [M_param] whole: True
[12/18 18:09:12] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/18 18:09:12] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/18 18:09:12] fastreid INFO: [M_param] meta_all_params: False
[12/18 18:09:12] fastreid INFO: [M_param] iter_init_inner: 1
[12/18 18:09:12] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/18 18:09:12] fastreid INFO: [M_param] iter_init_outer: 1
[12/18 18:09:12] fastreid INFO: [M_param] update_ratio: 0.0
[12/18 18:09:12] fastreid INFO: [M_param] iters_per_epoch: 1
[12/18 18:09:12] fastreid INFO: [M_param] iter_mtrain: 1
[12/18 18:09:12] fastreid INFO: [M_param] shuffle_domain: True
[12/18 18:09:12] fastreid INFO: [M_param] use_second_order: False
[12/18 18:09:12] fastreid INFO: [M_param] num_mtrain: 3
[12/18 18:09:12] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/18 18:09:12] fastreid INFO: [M_param] allow_unused: False
[12/18 18:09:12] fastreid INFO: [M_param] zero_grad: True
[12/18 18:09:12] fastreid INFO: [M_param] type_running_stats_init: general
[12/18 18:09:12] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/18 18:09:12] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/18 18:09:12] fastreid INFO: [M_param] auto_grad_outside: True
[12/18 18:09:12] fastreid INFO: [M_param] inner_clamp: True
[12/18 18:09:12] fastreid INFO: [M_param] synth_grad: none
[12/18 18:09:12] fastreid INFO: [M_param] constant_grad: 0.01
[12/18 18:09:12] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/18 18:09:12] fastreid INFO: [M_param] print_grad: True
[12/18 18:09:12] fastreid INFO: [M_param] one_loss_for_iter: False
[12/18 18:09:12] fastreid INFO: [M_param] one_loss_order: forward
[12/18 18:09:12] fastreid INFO: [M_param] num_mtest: 3
[12/18 18:09:12] fastreid INFO: [M_param] sync: True
[12/18 18:09:12] fastreid INFO: [M_param] detail_mode: True
[12/18 18:09:12] fastreid INFO: [M_param] stop_gradient: True
[12/18 18:09:12] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/18 18:09:12] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/18 18:09:12] fastreid INFO: [M_param] main_zero_grad: True
[12/18 18:09:12] fastreid INFO: [M_param] norm_zero_grad: True
[12/18 18:09:12] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/18 18:09:12] fastreid INFO: [M_param] write_period_param: 1000
[12/18 18:09:12] fastreid INFO: [M_param] loss_combined: False
[12/18 18:09:12] fastreid INFO: [M_param] loss_weight: 1.0
[12/18 18:09:12] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/18 18:09:12] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/18 18:09:12] fastreid INFO: ------------------------------
[12/18 18:16:32] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 18:16:33] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 18:16:33] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 18:16:33] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 18:16:33] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 18:16:33] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 18:16:33] fastreid.data.datasets.bases INFO: => Loaded LiteData
[12/18 18:16:33] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 18:16:33] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 18:16:33] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 18:16:33] fastreid.data.datasets.bases INFO:   train    |     4 |       16 |         6
[12/18 18:16:33] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 18:16:33] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 18:16:35] fastreid INFO: ------------------------------
[12/18 18:16:35] fastreid INFO: Meta-learning paramters
[12/18 18:16:35] fastreid INFO: ------------------------------
[12/18 18:16:35] fastreid INFO: [M_param] synth_data: none
[12/18 18:16:35] fastreid INFO: [M_param] synth_method: real
[12/18 18:16:35] fastreid INFO: [M_param] num_domain: 6
[12/18 18:16:35] fastreid INFO: [M_param] whole: True
[12/18 18:16:35] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/18 18:16:35] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/18 18:16:35] fastreid INFO: [M_param] meta_all_params: False
[12/18 18:16:35] fastreid INFO: [M_param] iter_init_inner: 1
[12/18 18:16:35] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/18 18:16:35] fastreid INFO: [M_param] iter_init_outer: 1
[12/18 18:16:35] fastreid INFO: [M_param] update_ratio: 0.0
[12/18 18:16:35] fastreid INFO: [M_param] iters_per_epoch: 1
[12/18 18:16:35] fastreid INFO: [M_param] iter_mtrain: 1
[12/18 18:16:35] fastreid INFO: [M_param] shuffle_domain: True
[12/18 18:16:35] fastreid INFO: [M_param] use_second_order: False
[12/18 18:16:35] fastreid INFO: [M_param] num_mtrain: 3
[12/18 18:16:35] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/18 18:16:35] fastreid INFO: [M_param] allow_unused: False
[12/18 18:16:35] fastreid INFO: [M_param] zero_grad: True
[12/18 18:16:35] fastreid INFO: [M_param] type_running_stats_init: general
[12/18 18:16:35] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/18 18:16:35] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/18 18:16:35] fastreid INFO: [M_param] auto_grad_outside: True
[12/18 18:16:35] fastreid INFO: [M_param] inner_clamp: True
[12/18 18:16:35] fastreid INFO: [M_param] synth_grad: none
[12/18 18:16:35] fastreid INFO: [M_param] constant_grad: 0.01
[12/18 18:16:35] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/18 18:16:35] fastreid INFO: [M_param] print_grad: True
[12/18 18:16:35] fastreid INFO: [M_param] one_loss_for_iter: False
[12/18 18:16:35] fastreid INFO: [M_param] one_loss_order: forward
[12/18 18:16:35] fastreid INFO: [M_param] num_mtest: 3
[12/18 18:16:35] fastreid INFO: [M_param] sync: True
[12/18 18:16:35] fastreid INFO: [M_param] detail_mode: True
[12/18 18:16:35] fastreid INFO: [M_param] stop_gradient: True
[12/18 18:16:35] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/18 18:16:35] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/18 18:16:36] fastreid INFO: [M_param] main_zero_grad: True
[12/18 18:16:36] fastreid INFO: [M_param] norm_zero_grad: True
[12/18 18:16:36] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/18 18:16:36] fastreid INFO: [M_param] write_period_param: 1000
[12/18 18:16:36] fastreid INFO: [M_param] loss_combined: False
[12/18 18:16:36] fastreid INFO: [M_param] loss_weight: 1.0
[12/18 18:16:36] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/18 18:16:36] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/18 18:16:36] fastreid INFO: ------------------------------
[12/18 18:37:51] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 18:37:53] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 18:37:53] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 18:37:53] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 18:37:53] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 18:37:53] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 18:37:53] fastreid.data.datasets.bases INFO: => Loaded LiteData
[12/18 18:37:53] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 18:37:53] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 18:37:53] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 18:37:53] fastreid.data.datasets.bases INFO:   train    |     4 |       16 |         6
[12/18 18:37:53] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 18:37:53] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 18:37:55] fastreid INFO: ------------------------------
[12/18 18:37:55] fastreid INFO: Meta-learning paramters
[12/18 18:37:55] fastreid INFO: ------------------------------
[12/18 18:37:55] fastreid INFO: [M_param] synth_data: none
[12/18 18:37:55] fastreid INFO: [M_param] synth_method: real
[12/18 18:37:55] fastreid INFO: [M_param] num_domain: 6
[12/18 18:37:55] fastreid INFO: [M_param] whole: True
[12/18 18:37:55] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/18 18:37:55] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/18 18:37:55] fastreid INFO: [M_param] meta_all_params: False
[12/18 18:37:55] fastreid INFO: [M_param] iter_init_inner: 1
[12/18 18:37:55] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/18 18:37:55] fastreid INFO: [M_param] iter_init_outer: 1
[12/18 18:37:55] fastreid INFO: [M_param] update_ratio: 0.0
[12/18 18:37:55] fastreid INFO: [M_param] iters_per_epoch: 1
[12/18 18:37:55] fastreid INFO: [M_param] iter_mtrain: 1
[12/18 18:37:55] fastreid INFO: [M_param] shuffle_domain: True
[12/18 18:37:55] fastreid INFO: [M_param] use_second_order: False
[12/18 18:37:55] fastreid INFO: [M_param] num_mtrain: 3
[12/18 18:37:55] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/18 18:37:55] fastreid INFO: [M_param] allow_unused: False
[12/18 18:37:55] fastreid INFO: [M_param] zero_grad: True
[12/18 18:37:55] fastreid INFO: [M_param] type_running_stats_init: general
[12/18 18:37:55] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/18 18:37:55] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/18 18:37:55] fastreid INFO: [M_param] auto_grad_outside: True
[12/18 18:37:55] fastreid INFO: [M_param] inner_clamp: True
[12/18 18:37:55] fastreid INFO: [M_param] synth_grad: none
[12/18 18:37:55] fastreid INFO: [M_param] constant_grad: 0.01
[12/18 18:37:55] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/18 18:37:55] fastreid INFO: [M_param] print_grad: True
[12/18 18:37:55] fastreid INFO: [M_param] one_loss_for_iter: False
[12/18 18:37:55] fastreid INFO: [M_param] one_loss_order: forward
[12/18 18:37:55] fastreid INFO: [M_param] num_mtest: 3
[12/18 18:37:55] fastreid INFO: [M_param] sync: True
[12/18 18:37:55] fastreid INFO: [M_param] detail_mode: True
[12/18 18:37:55] fastreid INFO: [M_param] stop_gradient: True
[12/18 18:37:55] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/18 18:37:55] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/18 18:37:55] fastreid INFO: [M_param] main_zero_grad: True
[12/18 18:37:55] fastreid INFO: [M_param] norm_zero_grad: True
[12/18 18:37:55] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/18 18:37:55] fastreid INFO: [M_param] write_period_param: 1000
[12/18 18:37:55] fastreid INFO: [M_param] loss_combined: False
[12/18 18:37:55] fastreid INFO: [M_param] loss_weight: 1.0
[12/18 18:37:55] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/18 18:37:55] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/18 18:37:55] fastreid INFO: ------------------------------
[12/18 18:38:22] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 18:38:23] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 18:38:23] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 18:38:23] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 18:38:23] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 18:38:23] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 18:38:23] fastreid.data.datasets.bases INFO: => Loaded LiteData
[12/18 18:38:23] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 18:38:23] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 18:38:23] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 18:38:23] fastreid.data.datasets.bases INFO:   train    |     4 |       16 |         6
[12/18 18:38:23] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 18:38:23] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 18:38:25] fastreid INFO: ------------------------------
[12/18 18:38:25] fastreid INFO: Meta-learning paramters
[12/18 18:38:25] fastreid INFO: ------------------------------
[12/18 18:38:25] fastreid INFO: [M_param] synth_data: none
[12/18 18:38:25] fastreid INFO: [M_param] synth_method: real
[12/18 18:38:25] fastreid INFO: [M_param] num_domain: 6
[12/18 18:38:25] fastreid INFO: [M_param] whole: True
[12/18 18:38:25] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/18 18:38:25] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/18 18:38:25] fastreid INFO: [M_param] meta_all_params: False
[12/18 18:38:25] fastreid INFO: [M_param] iter_init_inner: 1
[12/18 18:38:25] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/18 18:38:25] fastreid INFO: [M_param] iter_init_outer: 1
[12/18 18:38:25] fastreid INFO: [M_param] update_ratio: 0.0
[12/18 18:38:25] fastreid INFO: [M_param] iters_per_epoch: 1
[12/18 18:38:25] fastreid INFO: [M_param] iter_mtrain: 1
[12/18 18:38:25] fastreid INFO: [M_param] shuffle_domain: True
[12/18 18:38:25] fastreid INFO: [M_param] use_second_order: False
[12/18 18:38:25] fastreid INFO: [M_param] num_mtrain: 3
[12/18 18:38:25] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/18 18:38:25] fastreid INFO: [M_param] allow_unused: False
[12/18 18:38:25] fastreid INFO: [M_param] zero_grad: True
[12/18 18:38:25] fastreid INFO: [M_param] type_running_stats_init: general
[12/18 18:38:25] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/18 18:38:25] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/18 18:38:25] fastreid INFO: [M_param] auto_grad_outside: True
[12/18 18:38:25] fastreid INFO: [M_param] inner_clamp: True
[12/18 18:38:25] fastreid INFO: [M_param] synth_grad: none
[12/18 18:38:25] fastreid INFO: [M_param] constant_grad: 0.01
[12/18 18:38:25] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/18 18:38:25] fastreid INFO: [M_param] print_grad: True
[12/18 18:38:25] fastreid INFO: [M_param] one_loss_for_iter: False
[12/18 18:38:25] fastreid INFO: [M_param] one_loss_order: forward
[12/18 18:38:25] fastreid INFO: [M_param] num_mtest: 3
[12/18 18:38:25] fastreid INFO: [M_param] sync: True
[12/18 18:38:25] fastreid INFO: [M_param] detail_mode: True
[12/18 18:38:25] fastreid INFO: [M_param] stop_gradient: True
[12/18 18:38:25] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/18 18:38:25] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/18 18:38:25] fastreid INFO: [M_param] main_zero_grad: True
[12/18 18:38:25] fastreid INFO: [M_param] norm_zero_grad: True
[12/18 18:38:25] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/18 18:38:25] fastreid INFO: [M_param] write_period_param: 1000
[12/18 18:38:25] fastreid INFO: [M_param] loss_combined: False
[12/18 18:38:25] fastreid INFO: [M_param] loss_weight: 1.0
[12/18 18:38:25] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/18 18:38:25] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/18 18:38:25] fastreid INFO: ------------------------------
[12/18 18:52:29] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 18:52:31] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 18:52:31] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 18:52:31] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 18:52:31] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 18:52:31] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 18:52:31] fastreid.data.datasets.bases INFO: => Loaded LiteData
[12/18 18:52:31] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 18:52:31] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 18:52:31] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 18:52:31] fastreid.data.datasets.bases INFO:   train    |     4 |       16 |         6
[12/18 18:52:31] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 18:52:31] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 18:52:33] fastreid INFO: ------------------------------
[12/18 18:52:33] fastreid INFO: Meta-learning paramters
[12/18 18:52:33] fastreid INFO: ------------------------------
[12/18 18:52:33] fastreid INFO: [M_param] synth_data: none
[12/18 18:52:33] fastreid INFO: [M_param] synth_method: real
[12/18 18:52:33] fastreid INFO: [M_param] num_domain: 6
[12/18 18:52:33] fastreid INFO: [M_param] whole: True
[12/18 18:52:33] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/18 18:52:33] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/18 18:52:33] fastreid INFO: [M_param] meta_all_params: False
[12/18 18:52:33] fastreid INFO: [M_param] iter_init_inner: 1
[12/18 18:52:33] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/18 18:52:33] fastreid INFO: [M_param] iter_init_outer: 1
[12/18 18:52:33] fastreid INFO: [M_param] update_ratio: 0.0
[12/18 18:52:33] fastreid INFO: [M_param] iters_per_epoch: 1
[12/18 18:52:33] fastreid INFO: [M_param] iter_mtrain: 1
[12/18 18:52:33] fastreid INFO: [M_param] shuffle_domain: True
[12/18 18:52:33] fastreid INFO: [M_param] use_second_order: False
[12/18 18:52:33] fastreid INFO: [M_param] num_mtrain: 3
[12/18 18:52:33] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/18 18:52:33] fastreid INFO: [M_param] allow_unused: False
[12/18 18:52:33] fastreid INFO: [M_param] zero_grad: True
[12/18 18:52:33] fastreid INFO: [M_param] type_running_stats_init: general
[12/18 18:52:33] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/18 18:52:33] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/18 18:52:33] fastreid INFO: [M_param] auto_grad_outside: True
[12/18 18:52:33] fastreid INFO: [M_param] inner_clamp: True
[12/18 18:52:33] fastreid INFO: [M_param] synth_grad: none
[12/18 18:52:33] fastreid INFO: [M_param] constant_grad: 0.01
[12/18 18:52:33] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/18 18:52:33] fastreid INFO: [M_param] print_grad: True
[12/18 18:52:33] fastreid INFO: [M_param] one_loss_for_iter: False
[12/18 18:52:33] fastreid INFO: [M_param] one_loss_order: forward
[12/18 18:52:33] fastreid INFO: [M_param] num_mtest: 3
[12/18 18:52:33] fastreid INFO: [M_param] sync: True
[12/18 18:52:33] fastreid INFO: [M_param] detail_mode: True
[12/18 18:52:33] fastreid INFO: [M_param] stop_gradient: True
[12/18 18:52:33] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/18 18:52:33] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/18 18:52:33] fastreid INFO: [M_param] main_zero_grad: True
[12/18 18:52:33] fastreid INFO: [M_param] norm_zero_grad: True
[12/18 18:52:33] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/18 18:52:33] fastreid INFO: [M_param] write_period_param: 1000
[12/18 18:52:33] fastreid INFO: [M_param] loss_combined: False
[12/18 18:52:33] fastreid INFO: [M_param] loss_weight: 1.0
[12/18 18:52:33] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/18 18:52:33] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/18 18:52:33] fastreid INFO: ------------------------------
[12/18 18:55:00] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 18:55:02] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 18:55:02] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 18:55:02] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 18:55:02] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 18:55:02] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 18:55:02] fastreid.data.datasets.bases INFO: => Loaded LiteData
[12/18 18:55:02] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 18:55:02] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 18:55:02] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 18:55:02] fastreid.data.datasets.bases INFO:   train    |     4 |       16 |         6
[12/18 18:55:02] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 18:55:02] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 18:55:04] fastreid INFO: ------------------------------
[12/18 18:55:04] fastreid INFO: Meta-learning paramters
[12/18 18:55:04] fastreid INFO: ------------------------------
[12/18 18:55:04] fastreid INFO: [M_param] synth_data: none
[12/18 18:55:04] fastreid INFO: [M_param] synth_method: real
[12/18 18:55:04] fastreid INFO: [M_param] num_domain: 6
[12/18 18:55:04] fastreid INFO: [M_param] whole: True
[12/18 18:55:04] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/18 18:55:04] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/18 18:55:04] fastreid INFO: [M_param] meta_all_params: False
[12/18 18:55:04] fastreid INFO: [M_param] iter_init_inner: 1
[12/18 18:55:04] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/18 18:55:04] fastreid INFO: [M_param] iter_init_outer: 1
[12/18 18:55:04] fastreid INFO: [M_param] update_ratio: 0.0
[12/18 18:55:04] fastreid INFO: [M_param] iters_per_epoch: 1
[12/18 18:55:04] fastreid INFO: [M_param] iter_mtrain: 1
[12/18 18:55:04] fastreid INFO: [M_param] shuffle_domain: True
[12/18 18:55:04] fastreid INFO: [M_param] use_second_order: False
[12/18 18:55:04] fastreid INFO: [M_param] num_mtrain: 3
[12/18 18:55:04] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/18 18:55:04] fastreid INFO: [M_param] allow_unused: False
[12/18 18:55:04] fastreid INFO: [M_param] zero_grad: True
[12/18 18:55:04] fastreid INFO: [M_param] type_running_stats_init: general
[12/18 18:55:04] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/18 18:55:04] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/18 18:55:04] fastreid INFO: [M_param] auto_grad_outside: True
[12/18 18:55:04] fastreid INFO: [M_param] inner_clamp: True
[12/18 18:55:04] fastreid INFO: [M_param] synth_grad: none
[12/18 18:55:04] fastreid INFO: [M_param] constant_grad: 0.01
[12/18 18:55:04] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/18 18:55:04] fastreid INFO: [M_param] print_grad: True
[12/18 18:55:04] fastreid INFO: [M_param] one_loss_for_iter: False
[12/18 18:55:04] fastreid INFO: [M_param] one_loss_order: forward
[12/18 18:55:04] fastreid INFO: [M_param] num_mtest: 3
[12/18 18:55:04] fastreid INFO: [M_param] sync: True
[12/18 18:55:04] fastreid INFO: [M_param] detail_mode: True
[12/18 18:55:04] fastreid INFO: [M_param] stop_gradient: True
[12/18 18:55:04] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/18 18:55:04] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/18 18:55:04] fastreid INFO: [M_param] main_zero_grad: True
[12/18 18:55:04] fastreid INFO: [M_param] norm_zero_grad: True
[12/18 18:55:04] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/18 18:55:04] fastreid INFO: [M_param] write_period_param: 1000
[12/18 18:55:04] fastreid INFO: [M_param] loss_combined: False
[12/18 18:55:04] fastreid INFO: [M_param] loss_weight: 1.0
[12/18 18:55:04] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/18 18:55:04] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/18 18:55:04] fastreid INFO: ------------------------------
[12/18 18:56:20] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 18:56:22] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 18:56:22] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 18:56:22] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 18:56:22] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 18:56:22] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 18:56:22] fastreid.data.datasets.bases INFO: => Loaded LiteData
[12/18 18:56:22] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 18:56:22] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 18:56:22] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 18:56:22] fastreid.data.datasets.bases INFO:   train    |     4 |       16 |         6
[12/18 18:56:22] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 18:56:22] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 18:56:24] fastreid INFO: ------------------------------
[12/18 18:56:24] fastreid INFO: Meta-learning paramters
[12/18 18:56:24] fastreid INFO: ------------------------------
[12/18 18:56:24] fastreid INFO: [M_param] synth_data: none
[12/18 18:56:24] fastreid INFO: [M_param] synth_method: real
[12/18 18:56:24] fastreid INFO: [M_param] num_domain: 6
[12/18 18:56:24] fastreid INFO: [M_param] whole: True
[12/18 18:56:24] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/18 18:56:24] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/18 18:56:24] fastreid INFO: [M_param] meta_all_params: False
[12/18 18:56:24] fastreid INFO: [M_param] iter_init_inner: 1
[12/18 18:56:24] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/18 18:56:24] fastreid INFO: [M_param] iter_init_outer: 1
[12/18 18:56:24] fastreid INFO: [M_param] update_ratio: 0.0
[12/18 18:56:24] fastreid INFO: [M_param] iters_per_epoch: 1
[12/18 18:56:24] fastreid INFO: [M_param] iter_mtrain: 1
[12/18 18:56:24] fastreid INFO: [M_param] shuffle_domain: True
[12/18 18:56:24] fastreid INFO: [M_param] use_second_order: False
[12/18 18:56:24] fastreid INFO: [M_param] num_mtrain: 3
[12/18 18:56:24] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/18 18:56:24] fastreid INFO: [M_param] allow_unused: False
[12/18 18:56:24] fastreid INFO: [M_param] zero_grad: True
[12/18 18:56:24] fastreid INFO: [M_param] type_running_stats_init: general
[12/18 18:56:24] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/18 18:56:24] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/18 18:56:24] fastreid INFO: [M_param] auto_grad_outside: True
[12/18 18:56:24] fastreid INFO: [M_param] inner_clamp: True
[12/18 18:56:24] fastreid INFO: [M_param] synth_grad: none
[12/18 18:56:24] fastreid INFO: [M_param] constant_grad: 0.01
[12/18 18:56:24] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/18 18:56:24] fastreid INFO: [M_param] print_grad: True
[12/18 18:56:24] fastreid INFO: [M_param] one_loss_for_iter: False
[12/18 18:56:24] fastreid INFO: [M_param] one_loss_order: forward
[12/18 18:56:24] fastreid INFO: [M_param] num_mtest: 3
[12/18 18:56:24] fastreid INFO: [M_param] sync: True
[12/18 18:56:24] fastreid INFO: [M_param] detail_mode: True
[12/18 18:56:24] fastreid INFO: [M_param] stop_gradient: True
[12/18 18:56:24] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/18 18:56:24] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/18 18:56:24] fastreid INFO: [M_param] main_zero_grad: True
[12/18 18:56:24] fastreid INFO: [M_param] norm_zero_grad: True
[12/18 18:56:24] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/18 18:56:24] fastreid INFO: [M_param] write_period_param: 1000
[12/18 18:56:24] fastreid INFO: [M_param] loss_combined: False
[12/18 18:56:24] fastreid INFO: [M_param] loss_weight: 1.0
[12/18 18:56:24] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/18 18:56:24] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/18 18:56:24] fastreid INFO: ------------------------------
[12/18 18:56:59] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 18:57:00] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 18:57:00] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 18:57:00] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 18:57:00] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 18:57:00] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 18:57:00] fastreid.data.datasets.bases INFO: => Loaded LiteData
[12/18 18:57:00] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 18:57:00] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 18:57:00] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 18:57:00] fastreid.data.datasets.bases INFO:   train    |     4 |       16 |         6
[12/18 18:57:00] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 18:57:00] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 18:57:03] fastreid INFO: ------------------------------
[12/18 18:57:03] fastreid INFO: Meta-learning paramters
[12/18 18:57:03] fastreid INFO: ------------------------------
[12/18 18:57:03] fastreid INFO: [M_param] synth_data: none
[12/18 18:57:03] fastreid INFO: [M_param] synth_method: real
[12/18 18:57:03] fastreid INFO: [M_param] num_domain: 6
[12/18 18:57:03] fastreid INFO: [M_param] whole: True
[12/18 18:57:03] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/18 18:57:03] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/18 18:57:03] fastreid INFO: [M_param] meta_all_params: False
[12/18 18:57:03] fastreid INFO: [M_param] iter_init_inner: 1
[12/18 18:57:03] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/18 18:57:03] fastreid INFO: [M_param] iter_init_outer: 1
[12/18 18:57:03] fastreid INFO: [M_param] update_ratio: 0.0
[12/18 18:57:03] fastreid INFO: [M_param] iters_per_epoch: 1
[12/18 18:57:03] fastreid INFO: [M_param] iter_mtrain: 1
[12/18 18:57:03] fastreid INFO: [M_param] shuffle_domain: True
[12/18 18:57:03] fastreid INFO: [M_param] use_second_order: False
[12/18 18:57:03] fastreid INFO: [M_param] num_mtrain: 3
[12/18 18:57:03] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/18 18:57:03] fastreid INFO: [M_param] allow_unused: False
[12/18 18:57:03] fastreid INFO: [M_param] zero_grad: True
[12/18 18:57:03] fastreid INFO: [M_param] type_running_stats_init: general
[12/18 18:57:03] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/18 18:57:03] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/18 18:57:03] fastreid INFO: [M_param] auto_grad_outside: True
[12/18 18:57:03] fastreid INFO: [M_param] inner_clamp: True
[12/18 18:57:03] fastreid INFO: [M_param] synth_grad: none
[12/18 18:57:03] fastreid INFO: [M_param] constant_grad: 0.01
[12/18 18:57:03] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/18 18:57:03] fastreid INFO: [M_param] print_grad: True
[12/18 18:57:03] fastreid INFO: [M_param] one_loss_for_iter: False
[12/18 18:57:03] fastreid INFO: [M_param] one_loss_order: forward
[12/18 18:57:03] fastreid INFO: [M_param] num_mtest: 3
[12/18 18:57:03] fastreid INFO: [M_param] sync: True
[12/18 18:57:03] fastreid INFO: [M_param] detail_mode: True
[12/18 18:57:03] fastreid INFO: [M_param] stop_gradient: True
[12/18 18:57:03] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/18 18:57:03] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/18 18:57:03] fastreid INFO: [M_param] main_zero_grad: True
[12/18 18:57:03] fastreid INFO: [M_param] norm_zero_grad: True
[12/18 18:57:03] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/18 18:57:03] fastreid INFO: [M_param] write_period_param: 1000
[12/18 18:57:03] fastreid INFO: [M_param] loss_combined: False
[12/18 18:57:03] fastreid INFO: [M_param] loss_weight: 1.0
[12/18 18:57:03] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/18 18:57:03] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/18 18:57:03] fastreid INFO: ------------------------------
[12/18 18:59:06] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 18:59:07] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 18:59:07] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 18:59:07] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 18:59:07] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 18:59:08] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 18:59:08] fastreid.data.datasets.bases INFO: => Loaded LiteData
[12/18 18:59:08] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 18:59:08] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 18:59:08] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 18:59:08] fastreid.data.datasets.bases INFO:   train    |     4 |       16 |         6
[12/18 18:59:08] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 18:59:08] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 18:59:10] fastreid INFO: ------------------------------
[12/18 18:59:10] fastreid INFO: Meta-learning paramters
[12/18 18:59:10] fastreid INFO: ------------------------------
[12/18 18:59:10] fastreid INFO: [M_param] synth_data: none
[12/18 18:59:10] fastreid INFO: [M_param] synth_method: real
[12/18 18:59:10] fastreid INFO: [M_param] num_domain: 6
[12/18 18:59:10] fastreid INFO: [M_param] whole: True
[12/18 18:59:10] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/18 18:59:10] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/18 18:59:10] fastreid INFO: [M_param] meta_all_params: False
[12/18 18:59:10] fastreid INFO: [M_param] iter_init_inner: 1
[12/18 18:59:10] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/18 18:59:10] fastreid INFO: [M_param] iter_init_outer: 1
[12/18 18:59:10] fastreid INFO: [M_param] update_ratio: 0.0
[12/18 18:59:10] fastreid INFO: [M_param] iters_per_epoch: 1
[12/18 18:59:10] fastreid INFO: [M_param] iter_mtrain: 1
[12/18 18:59:10] fastreid INFO: [M_param] shuffle_domain: True
[12/18 18:59:10] fastreid INFO: [M_param] use_second_order: False
[12/18 18:59:10] fastreid INFO: [M_param] num_mtrain: 3
[12/18 18:59:10] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/18 18:59:10] fastreid INFO: [M_param] allow_unused: False
[12/18 18:59:10] fastreid INFO: [M_param] zero_grad: True
[12/18 18:59:10] fastreid INFO: [M_param] type_running_stats_init: general
[12/18 18:59:10] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/18 18:59:10] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/18 18:59:10] fastreid INFO: [M_param] auto_grad_outside: True
[12/18 18:59:10] fastreid INFO: [M_param] inner_clamp: True
[12/18 18:59:10] fastreid INFO: [M_param] synth_grad: none
[12/18 18:59:10] fastreid INFO: [M_param] constant_grad: 0.01
[12/18 18:59:10] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/18 18:59:10] fastreid INFO: [M_param] print_grad: True
[12/18 18:59:10] fastreid INFO: [M_param] one_loss_for_iter: False
[12/18 18:59:10] fastreid INFO: [M_param] one_loss_order: forward
[12/18 18:59:10] fastreid INFO: [M_param] num_mtest: 3
[12/18 18:59:10] fastreid INFO: [M_param] sync: True
[12/18 18:59:10] fastreid INFO: [M_param] detail_mode: True
[12/18 18:59:10] fastreid INFO: [M_param] stop_gradient: True
[12/18 18:59:10] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/18 18:59:10] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/18 18:59:10] fastreid INFO: [M_param] main_zero_grad: True
[12/18 18:59:10] fastreid INFO: [M_param] norm_zero_grad: True
[12/18 18:59:10] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/18 18:59:10] fastreid INFO: [M_param] write_period_param: 1000
[12/18 18:59:10] fastreid INFO: [M_param] loss_combined: False
[12/18 18:59:10] fastreid INFO: [M_param] loss_weight: 1.0
[12/18 18:59:10] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/18 18:59:10] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/18 18:59:10] fastreid INFO: ------------------------------
[12/18 19:01:11] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 19:01:12] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 19:01:12] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 19:01:12] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 19:01:12] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 19:01:12] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 19:01:12] fastreid.data.datasets.bases INFO: => Loaded LiteData
[12/18 19:01:12] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:01:12] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 19:01:12] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:01:12] fastreid.data.datasets.bases INFO:   train    |     4 |       16 |         6
[12/18 19:01:12] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:01:12] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 19:01:14] fastreid INFO: ------------------------------
[12/18 19:01:14] fastreid INFO: Meta-learning paramters
[12/18 19:01:14] fastreid INFO: ------------------------------
[12/18 19:01:14] fastreid INFO: [M_param] synth_data: none
[12/18 19:01:14] fastreid INFO: [M_param] synth_method: real
[12/18 19:01:14] fastreid INFO: [M_param] num_domain: 6
[12/18 19:01:14] fastreid INFO: [M_param] whole: True
[12/18 19:01:14] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/18 19:01:14] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/18 19:01:14] fastreid INFO: [M_param] meta_all_params: False
[12/18 19:01:14] fastreid INFO: [M_param] iter_init_inner: 1
[12/18 19:01:14] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/18 19:01:14] fastreid INFO: [M_param] iter_init_outer: 1
[12/18 19:01:14] fastreid INFO: [M_param] update_ratio: 0.0
[12/18 19:01:14] fastreid INFO: [M_param] iters_per_epoch: 1
[12/18 19:01:14] fastreid INFO: [M_param] iter_mtrain: 1
[12/18 19:01:14] fastreid INFO: [M_param] shuffle_domain: True
[12/18 19:01:14] fastreid INFO: [M_param] use_second_order: False
[12/18 19:01:14] fastreid INFO: [M_param] num_mtrain: 3
[12/18 19:01:14] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/18 19:01:14] fastreid INFO: [M_param] allow_unused: False
[12/18 19:01:14] fastreid INFO: [M_param] zero_grad: True
[12/18 19:01:14] fastreid INFO: [M_param] type_running_stats_init: general
[12/18 19:01:14] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/18 19:01:14] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/18 19:01:14] fastreid INFO: [M_param] auto_grad_outside: True
[12/18 19:01:14] fastreid INFO: [M_param] inner_clamp: True
[12/18 19:01:14] fastreid INFO: [M_param] synth_grad: none
[12/18 19:01:14] fastreid INFO: [M_param] constant_grad: 0.01
[12/18 19:01:14] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/18 19:01:14] fastreid INFO: [M_param] print_grad: True
[12/18 19:01:14] fastreid INFO: [M_param] one_loss_for_iter: False
[12/18 19:01:14] fastreid INFO: [M_param] one_loss_order: forward
[12/18 19:01:14] fastreid INFO: [M_param] num_mtest: 3
[12/18 19:01:14] fastreid INFO: [M_param] sync: True
[12/18 19:01:14] fastreid INFO: [M_param] detail_mode: True
[12/18 19:01:14] fastreid INFO: [M_param] stop_gradient: True
[12/18 19:01:14] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/18 19:01:14] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/18 19:01:14] fastreid INFO: [M_param] main_zero_grad: True
[12/18 19:01:14] fastreid INFO: [M_param] norm_zero_grad: True
[12/18 19:01:14] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/18 19:01:14] fastreid INFO: [M_param] write_period_param: 1000
[12/18 19:01:14] fastreid INFO: [M_param] loss_combined: False
[12/18 19:01:14] fastreid INFO: [M_param] loss_weight: 1.0
[12/18 19:01:14] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/18 19:01:14] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/18 19:01:14] fastreid INFO: ------------------------------
[12/18 19:02:10] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 19:02:11] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 19:02:11] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 19:02:11] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 19:02:11] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 19:02:11] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 19:02:11] fastreid.data.datasets.bases INFO: => Loaded LiteData
[12/18 19:02:11] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:02:11] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 19:02:11] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:02:11] fastreid.data.datasets.bases INFO:   train    |     4 |       16 |         6
[12/18 19:02:11] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:02:11] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 19:02:13] fastreid INFO: ------------------------------
[12/18 19:02:13] fastreid INFO: Meta-learning paramters
[12/18 19:02:13] fastreid INFO: ------------------------------
[12/18 19:02:13] fastreid INFO: [M_param] synth_data: none
[12/18 19:02:13] fastreid INFO: [M_param] synth_method: real
[12/18 19:02:13] fastreid INFO: [M_param] num_domain: 6
[12/18 19:02:13] fastreid INFO: [M_param] whole: True
[12/18 19:02:13] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/18 19:02:13] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/18 19:02:13] fastreid INFO: [M_param] meta_all_params: False
[12/18 19:02:13] fastreid INFO: [M_param] iter_init_inner: 1
[12/18 19:02:13] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/18 19:02:13] fastreid INFO: [M_param] iter_init_outer: 1
[12/18 19:02:13] fastreid INFO: [M_param] update_ratio: 0.0
[12/18 19:02:13] fastreid INFO: [M_param] iters_per_epoch: 1
[12/18 19:02:13] fastreid INFO: [M_param] iter_mtrain: 1
[12/18 19:02:13] fastreid INFO: [M_param] shuffle_domain: True
[12/18 19:02:13] fastreid INFO: [M_param] use_second_order: False
[12/18 19:02:13] fastreid INFO: [M_param] num_mtrain: 3
[12/18 19:02:13] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/18 19:02:13] fastreid INFO: [M_param] allow_unused: False
[12/18 19:02:13] fastreid INFO: [M_param] zero_grad: True
[12/18 19:02:13] fastreid INFO: [M_param] type_running_stats_init: general
[12/18 19:02:13] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/18 19:02:13] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/18 19:02:13] fastreid INFO: [M_param] auto_grad_outside: True
[12/18 19:02:13] fastreid INFO: [M_param] inner_clamp: True
[12/18 19:02:13] fastreid INFO: [M_param] synth_grad: none
[12/18 19:02:13] fastreid INFO: [M_param] constant_grad: 0.01
[12/18 19:02:13] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/18 19:02:13] fastreid INFO: [M_param] print_grad: True
[12/18 19:02:13] fastreid INFO: [M_param] one_loss_for_iter: False
[12/18 19:02:13] fastreid INFO: [M_param] one_loss_order: forward
[12/18 19:02:13] fastreid INFO: [M_param] num_mtest: 3
[12/18 19:02:13] fastreid INFO: [M_param] sync: True
[12/18 19:02:13] fastreid INFO: [M_param] detail_mode: True
[12/18 19:02:13] fastreid INFO: [M_param] stop_gradient: True
[12/18 19:02:13] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/18 19:02:13] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/18 19:02:13] fastreid INFO: [M_param] main_zero_grad: True
[12/18 19:02:13] fastreid INFO: [M_param] norm_zero_grad: True
[12/18 19:02:13] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/18 19:02:13] fastreid INFO: [M_param] write_period_param: 1000
[12/18 19:02:13] fastreid INFO: [M_param] loss_combined: False
[12/18 19:02:13] fastreid INFO: [M_param] loss_weight: 1.0
[12/18 19:02:13] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/18 19:02:13] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/18 19:02:13] fastreid INFO: ------------------------------
[12/18 19:03:25] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 19:03:26] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 19:03:26] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 19:03:26] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 19:03:26] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 19:03:26] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 19:03:26] fastreid.data.datasets.bases INFO: => Loaded LiteData
[12/18 19:03:26] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:03:26] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 19:03:26] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:03:26] fastreid.data.datasets.bases INFO:   train    |     4 |       16 |         6
[12/18 19:03:26] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:03:26] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 19:03:29] fastreid INFO: ------------------------------
[12/18 19:03:29] fastreid INFO: Meta-learning paramters
[12/18 19:03:29] fastreid INFO: ------------------------------
[12/18 19:03:29] fastreid INFO: [M_param] synth_data: none
[12/18 19:03:29] fastreid INFO: [M_param] synth_method: real
[12/18 19:03:29] fastreid INFO: [M_param] num_domain: 6
[12/18 19:03:29] fastreid INFO: [M_param] whole: True
[12/18 19:03:29] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/18 19:03:29] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/18 19:03:29] fastreid INFO: [M_param] meta_all_params: False
[12/18 19:03:29] fastreid INFO: [M_param] iter_init_inner: 1
[12/18 19:03:29] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/18 19:03:29] fastreid INFO: [M_param] iter_init_outer: 1
[12/18 19:03:29] fastreid INFO: [M_param] update_ratio: 0.0
[12/18 19:03:29] fastreid INFO: [M_param] iters_per_epoch: 1
[12/18 19:03:29] fastreid INFO: [M_param] iter_mtrain: 1
[12/18 19:03:29] fastreid INFO: [M_param] shuffle_domain: True
[12/18 19:03:29] fastreid INFO: [M_param] use_second_order: False
[12/18 19:03:29] fastreid INFO: [M_param] num_mtrain: 3
[12/18 19:03:29] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/18 19:03:29] fastreid INFO: [M_param] allow_unused: False
[12/18 19:03:29] fastreid INFO: [M_param] zero_grad: True
[12/18 19:03:29] fastreid INFO: [M_param] type_running_stats_init: general
[12/18 19:03:29] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/18 19:03:29] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/18 19:03:29] fastreid INFO: [M_param] auto_grad_outside: True
[12/18 19:03:29] fastreid INFO: [M_param] inner_clamp: True
[12/18 19:03:29] fastreid INFO: [M_param] synth_grad: none
[12/18 19:03:29] fastreid INFO: [M_param] constant_grad: 0.01
[12/18 19:03:29] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/18 19:03:29] fastreid INFO: [M_param] print_grad: True
[12/18 19:03:29] fastreid INFO: [M_param] one_loss_for_iter: False
[12/18 19:03:29] fastreid INFO: [M_param] one_loss_order: forward
[12/18 19:03:29] fastreid INFO: [M_param] num_mtest: 3
[12/18 19:03:29] fastreid INFO: [M_param] sync: True
[12/18 19:03:29] fastreid INFO: [M_param] detail_mode: True
[12/18 19:03:29] fastreid INFO: [M_param] stop_gradient: True
[12/18 19:03:29] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/18 19:03:29] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/18 19:03:29] fastreid INFO: [M_param] main_zero_grad: True
[12/18 19:03:29] fastreid INFO: [M_param] norm_zero_grad: True
[12/18 19:03:29] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/18 19:03:29] fastreid INFO: [M_param] write_period_param: 1000
[12/18 19:03:29] fastreid INFO: [M_param] loss_combined: False
[12/18 19:03:29] fastreid INFO: [M_param] loss_weight: 1.0
[12/18 19:03:29] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/18 19:03:29] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/18 19:03:29] fastreid INFO: ------------------------------
[12/18 19:04:54] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 19:04:55] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 19:04:55] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 19:04:55] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 19:04:55] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 19:04:56] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 19:04:56] fastreid.data.datasets.bases INFO: => Loaded LiteData
[12/18 19:04:56] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:04:56] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 19:04:56] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:04:56] fastreid.data.datasets.bases INFO:   train    |     4 |       16 |         6
[12/18 19:04:56] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:04:56] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 19:04:58] fastreid INFO: ------------------------------
[12/18 19:04:58] fastreid INFO: Meta-learning paramters
[12/18 19:04:58] fastreid INFO: ------------------------------
[12/18 19:04:58] fastreid INFO: [M_param] synth_data: none
[12/18 19:04:58] fastreid INFO: [M_param] synth_method: real
[12/18 19:04:58] fastreid INFO: [M_param] num_domain: 6
[12/18 19:04:58] fastreid INFO: [M_param] whole: True
[12/18 19:04:58] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/18 19:04:58] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/18 19:04:58] fastreid INFO: [M_param] meta_all_params: False
[12/18 19:04:58] fastreid INFO: [M_param] iter_init_inner: 1
[12/18 19:04:58] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/18 19:04:58] fastreid INFO: [M_param] iter_init_outer: 1
[12/18 19:04:58] fastreid INFO: [M_param] update_ratio: 0.0
[12/18 19:04:58] fastreid INFO: [M_param] iters_per_epoch: 1
[12/18 19:04:58] fastreid INFO: [M_param] iter_mtrain: 1
[12/18 19:04:58] fastreid INFO: [M_param] shuffle_domain: True
[12/18 19:04:58] fastreid INFO: [M_param] use_second_order: False
[12/18 19:04:58] fastreid INFO: [M_param] num_mtrain: 3
[12/18 19:04:58] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/18 19:04:58] fastreid INFO: [M_param] allow_unused: False
[12/18 19:04:58] fastreid INFO: [M_param] zero_grad: True
[12/18 19:04:58] fastreid INFO: [M_param] type_running_stats_init: general
[12/18 19:04:58] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/18 19:04:58] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/18 19:04:58] fastreid INFO: [M_param] auto_grad_outside: True
[12/18 19:04:58] fastreid INFO: [M_param] inner_clamp: True
[12/18 19:04:58] fastreid INFO: [M_param] synth_grad: none
[12/18 19:04:58] fastreid INFO: [M_param] constant_grad: 0.01
[12/18 19:04:58] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/18 19:04:58] fastreid INFO: [M_param] print_grad: True
[12/18 19:04:58] fastreid INFO: [M_param] one_loss_for_iter: False
[12/18 19:04:58] fastreid INFO: [M_param] one_loss_order: forward
[12/18 19:04:58] fastreid INFO: [M_param] num_mtest: 3
[12/18 19:04:58] fastreid INFO: [M_param] sync: True
[12/18 19:04:58] fastreid INFO: [M_param] detail_mode: True
[12/18 19:04:58] fastreid INFO: [M_param] stop_gradient: True
[12/18 19:04:58] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/18 19:04:58] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/18 19:04:58] fastreid INFO: [M_param] main_zero_grad: True
[12/18 19:04:58] fastreid INFO: [M_param] norm_zero_grad: True
[12/18 19:04:58] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/18 19:04:58] fastreid INFO: [M_param] write_period_param: 1000
[12/18 19:04:58] fastreid INFO: [M_param] loss_combined: False
[12/18 19:04:58] fastreid INFO: [M_param] loss_weight: 1.0
[12/18 19:04:58] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/18 19:04:58] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/18 19:04:58] fastreid INFO: ------------------------------
[12/18 19:05:43] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 19:05:44] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 19:05:44] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 19:05:44] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 19:05:44] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 19:05:45] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 19:05:45] fastreid.data.datasets.bases INFO: => Loaded LiteData
[12/18 19:05:45] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:05:45] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 19:05:45] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:05:45] fastreid.data.datasets.bases INFO:   train    |     4 |       16 |         6
[12/18 19:05:45] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:05:45] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 19:05:47] fastreid INFO: ------------------------------
[12/18 19:05:47] fastreid INFO: Meta-learning paramters
[12/18 19:05:47] fastreid INFO: ------------------------------
[12/18 19:05:47] fastreid INFO: [M_param] synth_data: none
[12/18 19:05:47] fastreid INFO: [M_param] synth_method: real
[12/18 19:05:47] fastreid INFO: [M_param] num_domain: 6
[12/18 19:05:47] fastreid INFO: [M_param] whole: True
[12/18 19:05:47] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/18 19:05:47] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/18 19:05:47] fastreid INFO: [M_param] meta_all_params: False
[12/18 19:05:47] fastreid INFO: [M_param] iter_init_inner: 1
[12/18 19:05:47] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/18 19:05:47] fastreid INFO: [M_param] iter_init_outer: 1
[12/18 19:05:47] fastreid INFO: [M_param] update_ratio: 0.0
[12/18 19:05:47] fastreid INFO: [M_param] iters_per_epoch: 1
[12/18 19:05:47] fastreid INFO: [M_param] iter_mtrain: 1
[12/18 19:05:47] fastreid INFO: [M_param] shuffle_domain: True
[12/18 19:05:47] fastreid INFO: [M_param] use_second_order: False
[12/18 19:05:47] fastreid INFO: [M_param] num_mtrain: 3
[12/18 19:05:47] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/18 19:05:47] fastreid INFO: [M_param] allow_unused: False
[12/18 19:05:47] fastreid INFO: [M_param] zero_grad: True
[12/18 19:05:47] fastreid INFO: [M_param] type_running_stats_init: general
[12/18 19:05:47] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/18 19:05:47] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/18 19:05:47] fastreid INFO: [M_param] auto_grad_outside: True
[12/18 19:05:47] fastreid INFO: [M_param] inner_clamp: True
[12/18 19:05:47] fastreid INFO: [M_param] synth_grad: none
[12/18 19:05:47] fastreid INFO: [M_param] constant_grad: 0.01
[12/18 19:05:47] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/18 19:05:47] fastreid INFO: [M_param] print_grad: True
[12/18 19:05:47] fastreid INFO: [M_param] one_loss_for_iter: False
[12/18 19:05:47] fastreid INFO: [M_param] one_loss_order: forward
[12/18 19:05:47] fastreid INFO: [M_param] num_mtest: 3
[12/18 19:05:47] fastreid INFO: [M_param] sync: True
[12/18 19:05:47] fastreid INFO: [M_param] detail_mode: True
[12/18 19:05:47] fastreid INFO: [M_param] stop_gradient: True
[12/18 19:05:47] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/18 19:05:47] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/18 19:05:47] fastreid INFO: [M_param] main_zero_grad: True
[12/18 19:05:47] fastreid INFO: [M_param] norm_zero_grad: True
[12/18 19:05:47] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/18 19:05:47] fastreid INFO: [M_param] write_period_param: 1000
[12/18 19:05:47] fastreid INFO: [M_param] loss_combined: False
[12/18 19:05:47] fastreid INFO: [M_param] loss_weight: 1.0
[12/18 19:05:47] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/18 19:05:47] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/18 19:05:47] fastreid INFO: ------------------------------
[12/18 19:06:39] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 19:06:40] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 19:06:40] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 19:06:40] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 19:06:40] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 19:06:40] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 19:06:40] fastreid.data.datasets.bases INFO: => Loaded LiteData
[12/18 19:06:40] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:06:40] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 19:06:40] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:06:40] fastreid.data.datasets.bases INFO:   train    |     4 |       16 |         6
[12/18 19:06:40] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:06:40] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 19:06:42] fastreid INFO: ------------------------------
[12/18 19:06:42] fastreid INFO: Meta-learning paramters
[12/18 19:06:42] fastreid INFO: ------------------------------
[12/18 19:06:42] fastreid INFO: [M_param] synth_data: none
[12/18 19:06:42] fastreid INFO: [M_param] synth_method: real
[12/18 19:06:42] fastreid INFO: [M_param] num_domain: 6
[12/18 19:06:42] fastreid INFO: [M_param] whole: True
[12/18 19:06:42] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/18 19:06:42] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/18 19:06:42] fastreid INFO: [M_param] meta_all_params: False
[12/18 19:06:42] fastreid INFO: [M_param] iter_init_inner: 1
[12/18 19:06:42] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/18 19:06:42] fastreid INFO: [M_param] iter_init_outer: 1
[12/18 19:06:42] fastreid INFO: [M_param] update_ratio: 0.0
[12/18 19:06:42] fastreid INFO: [M_param] iters_per_epoch: 1
[12/18 19:06:42] fastreid INFO: [M_param] iter_mtrain: 1
[12/18 19:06:42] fastreid INFO: [M_param] shuffle_domain: True
[12/18 19:06:42] fastreid INFO: [M_param] use_second_order: False
[12/18 19:06:42] fastreid INFO: [M_param] num_mtrain: 3
[12/18 19:06:42] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/18 19:06:42] fastreid INFO: [M_param] allow_unused: False
[12/18 19:06:42] fastreid INFO: [M_param] zero_grad: True
[12/18 19:06:42] fastreid INFO: [M_param] type_running_stats_init: general
[12/18 19:06:42] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/18 19:06:42] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/18 19:06:42] fastreid INFO: [M_param] auto_grad_outside: True
[12/18 19:06:42] fastreid INFO: [M_param] inner_clamp: True
[12/18 19:06:42] fastreid INFO: [M_param] synth_grad: none
[12/18 19:06:42] fastreid INFO: [M_param] constant_grad: 0.01
[12/18 19:06:42] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/18 19:06:42] fastreid INFO: [M_param] print_grad: True
[12/18 19:06:42] fastreid INFO: [M_param] one_loss_for_iter: False
[12/18 19:06:42] fastreid INFO: [M_param] one_loss_order: forward
[12/18 19:06:42] fastreid INFO: [M_param] num_mtest: 3
[12/18 19:06:42] fastreid INFO: [M_param] sync: True
[12/18 19:06:42] fastreid INFO: [M_param] detail_mode: True
[12/18 19:06:42] fastreid INFO: [M_param] stop_gradient: True
[12/18 19:06:42] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/18 19:06:42] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/18 19:06:42] fastreid INFO: [M_param] main_zero_grad: True
[12/18 19:06:42] fastreid INFO: [M_param] norm_zero_grad: True
[12/18 19:06:42] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/18 19:06:42] fastreid INFO: [M_param] write_period_param: 1000
[12/18 19:06:42] fastreid INFO: [M_param] loss_combined: False
[12/18 19:06:42] fastreid INFO: [M_param] loss_weight: 1.0
[12/18 19:06:42] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/18 19:06:42] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/18 19:06:42] fastreid INFO: ------------------------------
[12/18 19:08:42] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 19:08:43] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 19:08:43] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 19:08:43] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 19:08:43] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 19:08:43] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 19:08:43] fastreid.data.datasets.bases INFO: => Loaded LiteData
[12/18 19:08:43] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:08:43] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 19:08:43] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:08:43] fastreid.data.datasets.bases INFO:   train    |     4 |       16 |         6
[12/18 19:08:43] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:08:43] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 19:08:45] fastreid INFO: ------------------------------
[12/18 19:08:45] fastreid INFO: Meta-learning paramters
[12/18 19:08:45] fastreid INFO: ------------------------------
[12/18 19:08:45] fastreid INFO: [M_param] synth_data: none
[12/18 19:08:45] fastreid INFO: [M_param] synth_method: real
[12/18 19:08:45] fastreid INFO: [M_param] num_domain: 6
[12/18 19:08:45] fastreid INFO: [M_param] whole: True
[12/18 19:08:45] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/18 19:08:45] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/18 19:08:45] fastreid INFO: [M_param] meta_all_params: False
[12/18 19:08:45] fastreid INFO: [M_param] iter_init_inner: 1
[12/18 19:08:45] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/18 19:08:45] fastreid INFO: [M_param] iter_init_outer: 1
[12/18 19:08:45] fastreid INFO: [M_param] update_ratio: 0.0
[12/18 19:08:45] fastreid INFO: [M_param] iters_per_epoch: 1
[12/18 19:08:45] fastreid INFO: [M_param] iter_mtrain: 1
[12/18 19:08:45] fastreid INFO: [M_param] shuffle_domain: True
[12/18 19:08:45] fastreid INFO: [M_param] use_second_order: False
[12/18 19:08:45] fastreid INFO: [M_param] num_mtrain: 3
[12/18 19:08:45] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/18 19:08:45] fastreid INFO: [M_param] allow_unused: False
[12/18 19:08:45] fastreid INFO: [M_param] zero_grad: True
[12/18 19:08:45] fastreid INFO: [M_param] type_running_stats_init: general
[12/18 19:08:45] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/18 19:08:45] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/18 19:08:45] fastreid INFO: [M_param] auto_grad_outside: True
[12/18 19:08:45] fastreid INFO: [M_param] inner_clamp: True
[12/18 19:08:45] fastreid INFO: [M_param] synth_grad: none
[12/18 19:08:45] fastreid INFO: [M_param] constant_grad: 0.01
[12/18 19:08:45] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/18 19:08:45] fastreid INFO: [M_param] print_grad: True
[12/18 19:08:45] fastreid INFO: [M_param] one_loss_for_iter: False
[12/18 19:08:45] fastreid INFO: [M_param] one_loss_order: forward
[12/18 19:08:45] fastreid INFO: [M_param] num_mtest: 3
[12/18 19:08:45] fastreid INFO: [M_param] sync: True
[12/18 19:08:45] fastreid INFO: [M_param] detail_mode: True
[12/18 19:08:45] fastreid INFO: [M_param] stop_gradient: True
[12/18 19:08:45] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/18 19:08:45] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/18 19:08:45] fastreid INFO: [M_param] main_zero_grad: True
[12/18 19:08:45] fastreid INFO: [M_param] norm_zero_grad: True
[12/18 19:08:45] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/18 19:08:45] fastreid INFO: [M_param] write_period_param: 1000
[12/18 19:08:45] fastreid INFO: [M_param] loss_combined: False
[12/18 19:08:45] fastreid INFO: [M_param] loss_weight: 1.0
[12/18 19:08:45] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/18 19:08:45] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/18 19:08:45] fastreid INFO: ------------------------------
[12/18 19:09:33] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 19:09:34] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 19:09:34] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 19:09:34] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 19:09:34] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 19:09:34] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 19:09:34] fastreid.data.datasets.bases INFO: => Loaded LiteData
[12/18 19:09:34] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:09:34] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 19:09:34] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:09:34] fastreid.data.datasets.bases INFO:   train    |     4 |       16 |         6
[12/18 19:09:34] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:09:34] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 19:09:36] fastreid INFO: ------------------------------
[12/18 19:09:36] fastreid INFO: Meta-learning paramters
[12/18 19:09:36] fastreid INFO: ------------------------------
[12/18 19:09:36] fastreid INFO: [M_param] synth_data: none
[12/18 19:09:36] fastreid INFO: [M_param] synth_method: real
[12/18 19:09:36] fastreid INFO: [M_param] num_domain: 6
[12/18 19:09:36] fastreid INFO: [M_param] whole: True
[12/18 19:09:36] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/18 19:09:36] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/18 19:09:36] fastreid INFO: [M_param] meta_all_params: False
[12/18 19:09:36] fastreid INFO: [M_param] iter_init_inner: 1
[12/18 19:09:36] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/18 19:09:36] fastreid INFO: [M_param] iter_init_outer: 1
[12/18 19:09:36] fastreid INFO: [M_param] update_ratio: 0.0
[12/18 19:09:36] fastreid INFO: [M_param] iters_per_epoch: 1
[12/18 19:09:36] fastreid INFO: [M_param] iter_mtrain: 1
[12/18 19:09:36] fastreid INFO: [M_param] shuffle_domain: True
[12/18 19:09:36] fastreid INFO: [M_param] use_second_order: False
[12/18 19:09:36] fastreid INFO: [M_param] num_mtrain: 3
[12/18 19:09:36] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/18 19:09:36] fastreid INFO: [M_param] allow_unused: False
[12/18 19:09:36] fastreid INFO: [M_param] zero_grad: True
[12/18 19:09:36] fastreid INFO: [M_param] type_running_stats_init: general
[12/18 19:09:36] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/18 19:09:36] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/18 19:09:36] fastreid INFO: [M_param] auto_grad_outside: True
[12/18 19:09:36] fastreid INFO: [M_param] inner_clamp: True
[12/18 19:09:36] fastreid INFO: [M_param] synth_grad: none
[12/18 19:09:36] fastreid INFO: [M_param] constant_grad: 0.01
[12/18 19:09:36] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/18 19:09:36] fastreid INFO: [M_param] print_grad: True
[12/18 19:09:36] fastreid INFO: [M_param] one_loss_for_iter: False
[12/18 19:09:36] fastreid INFO: [M_param] one_loss_order: forward
[12/18 19:09:36] fastreid INFO: [M_param] num_mtest: 3
[12/18 19:09:36] fastreid INFO: [M_param] sync: True
[12/18 19:09:36] fastreid INFO: [M_param] detail_mode: True
[12/18 19:09:36] fastreid INFO: [M_param] stop_gradient: True
[12/18 19:09:36] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/18 19:09:36] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/18 19:09:36] fastreid INFO: [M_param] main_zero_grad: True
[12/18 19:09:36] fastreid INFO: [M_param] norm_zero_grad: True
[12/18 19:09:36] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/18 19:09:36] fastreid INFO: [M_param] write_period_param: 1000
[12/18 19:09:36] fastreid INFO: [M_param] loss_combined: False
[12/18 19:09:36] fastreid INFO: [M_param] loss_weight: 1.0
[12/18 19:09:36] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/18 19:09:36] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/18 19:09:36] fastreid INFO: ------------------------------
[12/18 19:10:52] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 19:10:53] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 19:10:53] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 19:10:53] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 19:10:53] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 19:10:53] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 19:10:53] fastreid.data.datasets.bases INFO: => Loaded LiteData
[12/18 19:10:53] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:10:53] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 19:10:53] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:10:53] fastreid.data.datasets.bases INFO:   train    |     4 |       16 |         6
[12/18 19:10:53] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:10:53] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 19:10:55] fastreid INFO: ------------------------------
[12/18 19:10:55] fastreid INFO: Meta-learning paramters
[12/18 19:10:55] fastreid INFO: ------------------------------
[12/18 19:10:55] fastreid INFO: [M_param] synth_data: none
[12/18 19:10:55] fastreid INFO: [M_param] synth_method: real
[12/18 19:10:55] fastreid INFO: [M_param] num_domain: 6
[12/18 19:10:55] fastreid INFO: [M_param] whole: True
[12/18 19:10:55] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/18 19:10:55] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/18 19:10:55] fastreid INFO: [M_param] meta_all_params: False
[12/18 19:10:55] fastreid INFO: [M_param] iter_init_inner: 1
[12/18 19:10:55] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/18 19:10:55] fastreid INFO: [M_param] iter_init_outer: 1
[12/18 19:10:55] fastreid INFO: [M_param] update_ratio: 0.0
[12/18 19:10:55] fastreid INFO: [M_param] iters_per_epoch: 1
[12/18 19:10:55] fastreid INFO: [M_param] iter_mtrain: 1
[12/18 19:10:55] fastreid INFO: [M_param] shuffle_domain: True
[12/18 19:10:55] fastreid INFO: [M_param] use_second_order: False
[12/18 19:10:55] fastreid INFO: [M_param] num_mtrain: 3
[12/18 19:10:55] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/18 19:10:55] fastreid INFO: [M_param] allow_unused: False
[12/18 19:10:55] fastreid INFO: [M_param] zero_grad: True
[12/18 19:10:55] fastreid INFO: [M_param] type_running_stats_init: general
[12/18 19:10:55] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/18 19:10:55] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/18 19:10:55] fastreid INFO: [M_param] auto_grad_outside: True
[12/18 19:10:55] fastreid INFO: [M_param] inner_clamp: True
[12/18 19:10:55] fastreid INFO: [M_param] synth_grad: none
[12/18 19:10:55] fastreid INFO: [M_param] constant_grad: 0.01
[12/18 19:10:55] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/18 19:10:55] fastreid INFO: [M_param] print_grad: True
[12/18 19:10:55] fastreid INFO: [M_param] one_loss_for_iter: False
[12/18 19:10:55] fastreid INFO: [M_param] one_loss_order: forward
[12/18 19:10:55] fastreid INFO: [M_param] num_mtest: 3
[12/18 19:10:55] fastreid INFO: [M_param] sync: True
[12/18 19:10:55] fastreid INFO: [M_param] detail_mode: True
[12/18 19:10:55] fastreid INFO: [M_param] stop_gradient: True
[12/18 19:10:55] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/18 19:10:55] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/18 19:10:55] fastreid INFO: [M_param] main_zero_grad: True
[12/18 19:10:55] fastreid INFO: [M_param] norm_zero_grad: True
[12/18 19:10:55] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/18 19:10:55] fastreid INFO: [M_param] write_period_param: 1000
[12/18 19:10:55] fastreid INFO: [M_param] loss_combined: False
[12/18 19:10:55] fastreid INFO: [M_param] loss_weight: 1.0
[12/18 19:10:55] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/18 19:10:55] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/18 19:10:55] fastreid INFO: ------------------------------
[12/18 19:14:41] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 19:14:42] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 19:14:42] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 19:14:42] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 19:14:42] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 19:14:42] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 19:14:42] fastreid.data.datasets.bases INFO: => Loaded LiteData
[12/18 19:14:42] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:14:42] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 19:14:42] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:14:42] fastreid.data.datasets.bases INFO:   train    |     4 |       16 |         6
[12/18 19:14:42] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:14:42] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 19:17:33] fastreid INFO: ------------------------------
[12/18 19:17:33] fastreid INFO: Meta-learning paramters
[12/18 19:17:33] fastreid INFO: ------------------------------
[12/18 19:17:33] fastreid INFO: [M_param] synth_data: none
[12/18 19:17:33] fastreid INFO: [M_param] synth_method: real
[12/18 19:17:33] fastreid INFO: [M_param] num_domain: 6
[12/18 19:17:33] fastreid INFO: [M_param] whole: True
[12/18 19:17:33] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/18 19:17:33] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/18 19:17:33] fastreid INFO: [M_param] meta_all_params: False
[12/18 19:17:33] fastreid INFO: [M_param] iter_init_inner: 1
[12/18 19:17:33] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/18 19:17:33] fastreid INFO: [M_param] iter_init_outer: 1
[12/18 19:17:33] fastreid INFO: [M_param] update_ratio: 0.0
[12/18 19:17:33] fastreid INFO: [M_param] iters_per_epoch: 1
[12/18 19:17:33] fastreid INFO: [M_param] iter_mtrain: 1
[12/18 19:17:33] fastreid INFO: [M_param] shuffle_domain: True
[12/18 19:17:33] fastreid INFO: [M_param] use_second_order: False
[12/18 19:17:33] fastreid INFO: [M_param] num_mtrain: 3
[12/18 19:17:33] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/18 19:17:33] fastreid INFO: [M_param] allow_unused: False
[12/18 19:17:33] fastreid INFO: [M_param] zero_grad: True
[12/18 19:17:33] fastreid INFO: [M_param] type_running_stats_init: general
[12/18 19:17:33] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/18 19:17:33] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/18 19:17:33] fastreid INFO: [M_param] auto_grad_outside: True
[12/18 19:17:33] fastreid INFO: [M_param] inner_clamp: True
[12/18 19:17:33] fastreid INFO: [M_param] synth_grad: none
[12/18 19:17:33] fastreid INFO: [M_param] constant_grad: 0.01
[12/18 19:17:33] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/18 19:17:33] fastreid INFO: [M_param] print_grad: True
[12/18 19:17:33] fastreid INFO: [M_param] one_loss_for_iter: False
[12/18 19:17:33] fastreid INFO: [M_param] one_loss_order: forward
[12/18 19:17:33] fastreid INFO: [M_param] num_mtest: 3
[12/18 19:17:33] fastreid INFO: [M_param] sync: True
[12/18 19:17:33] fastreid INFO: [M_param] detail_mode: True
[12/18 19:17:33] fastreid INFO: [M_param] stop_gradient: True
[12/18 19:17:33] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/18 19:17:33] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/18 19:17:33] fastreid INFO: [M_param] main_zero_grad: True
[12/18 19:17:33] fastreid INFO: [M_param] norm_zero_grad: True
[12/18 19:17:33] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/18 19:17:33] fastreid INFO: [M_param] write_period_param: 1000
[12/18 19:17:33] fastreid INFO: [M_param] loss_combined: False
[12/18 19:17:33] fastreid INFO: [M_param] loss_weight: 1.0
[12/18 19:17:33] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/18 19:17:33] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/18 19:17:33] fastreid INFO: ------------------------------
[12/18 19:17:51] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 19:17:52] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 19:17:52] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 19:17:52] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 19:17:52] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 19:17:52] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 19:17:52] fastreid.data.datasets.bases INFO: => Loaded LiteData
[12/18 19:17:52] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:17:52] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 19:17:52] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:17:52] fastreid.data.datasets.bases INFO:   train    |     4 |       16 |         6
[12/18 19:17:52] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:17:52] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 19:20:16] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 19:20:17] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 19:20:17] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 19:20:17] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 19:20:17] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 19:20:18] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 19:20:18] fastreid.data.datasets.bases INFO: => Loaded LiteData
[12/18 19:20:18] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:20:18] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 19:20:18] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:20:18] fastreid.data.datasets.bases INFO:   train    |     4 |       16 |         6
[12/18 19:20:18] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:20:18] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 19:20:24] fastreid INFO: ------------------------------
[12/18 19:20:24] fastreid INFO: Meta-learning paramters
[12/18 19:20:24] fastreid INFO: ------------------------------
[12/18 19:20:24] fastreid INFO: [M_param] synth_data: none
[12/18 19:20:24] fastreid INFO: [M_param] synth_method: real
[12/18 19:20:24] fastreid INFO: [M_param] num_domain: 6
[12/18 19:20:24] fastreid INFO: [M_param] whole: True
[12/18 19:20:24] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/18 19:20:24] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/18 19:20:24] fastreid INFO: [M_param] meta_all_params: False
[12/18 19:20:24] fastreid INFO: [M_param] iter_init_inner: 1
[12/18 19:20:24] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/18 19:20:24] fastreid INFO: [M_param] iter_init_outer: 1
[12/18 19:20:24] fastreid INFO: [M_param] update_ratio: 0.0
[12/18 19:20:24] fastreid INFO: [M_param] iters_per_epoch: 1
[12/18 19:20:24] fastreid INFO: [M_param] iter_mtrain: 1
[12/18 19:20:24] fastreid INFO: [M_param] shuffle_domain: True
[12/18 19:20:24] fastreid INFO: [M_param] use_second_order: False
[12/18 19:20:24] fastreid INFO: [M_param] num_mtrain: 3
[12/18 19:20:24] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/18 19:20:24] fastreid INFO: [M_param] allow_unused: False
[12/18 19:20:24] fastreid INFO: [M_param] zero_grad: True
[12/18 19:20:24] fastreid INFO: [M_param] type_running_stats_init: general
[12/18 19:20:24] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/18 19:20:24] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/18 19:20:24] fastreid INFO: [M_param] auto_grad_outside: True
[12/18 19:20:24] fastreid INFO: [M_param] inner_clamp: True
[12/18 19:20:24] fastreid INFO: [M_param] synth_grad: none
[12/18 19:20:24] fastreid INFO: [M_param] constant_grad: 0.01
[12/18 19:20:24] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/18 19:20:24] fastreid INFO: [M_param] print_grad: True
[12/18 19:20:24] fastreid INFO: [M_param] one_loss_for_iter: False
[12/18 19:20:24] fastreid INFO: [M_param] one_loss_order: forward
[12/18 19:20:24] fastreid INFO: [M_param] num_mtest: 3
[12/18 19:20:24] fastreid INFO: [M_param] sync: True
[12/18 19:20:24] fastreid INFO: [M_param] detail_mode: True
[12/18 19:20:24] fastreid INFO: [M_param] stop_gradient: True
[12/18 19:20:24] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/18 19:20:24] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/18 19:20:24] fastreid INFO: [M_param] main_zero_grad: True
[12/18 19:20:24] fastreid INFO: [M_param] norm_zero_grad: True
[12/18 19:20:24] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/18 19:20:24] fastreid INFO: [M_param] write_period_param: 1000
[12/18 19:20:24] fastreid INFO: [M_param] loss_combined: False
[12/18 19:20:24] fastreid INFO: [M_param] loss_weight: 1.0
[12/18 19:20:24] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/18 19:20:24] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/18 19:20:24] fastreid INFO: ------------------------------
[12/18 19:20:51] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 19:20:52] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 19:20:52] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 19:20:52] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 19:20:52] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 19:20:52] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 19:20:52] fastreid.data.datasets.bases INFO: => Loaded LiteData
[12/18 19:20:52] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:20:52] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 19:20:52] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:20:52] fastreid.data.datasets.bases INFO:   train    |     4 |       16 |         6
[12/18 19:20:52] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:20:52] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 19:20:54] fastreid INFO: ------------------------------
[12/18 19:20:54] fastreid INFO: Meta-learning paramters
[12/18 19:20:54] fastreid INFO: ------------------------------
[12/18 19:20:54] fastreid INFO: [M_param] synth_data: none
[12/18 19:20:54] fastreid INFO: [M_param] synth_method: real
[12/18 19:20:54] fastreid INFO: [M_param] num_domain: 6
[12/18 19:20:54] fastreid INFO: [M_param] whole: True
[12/18 19:20:54] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/18 19:20:54] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/18 19:20:54] fastreid INFO: [M_param] meta_all_params: False
[12/18 19:20:54] fastreid INFO: [M_param] iter_init_inner: 1
[12/18 19:20:54] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/18 19:20:54] fastreid INFO: [M_param] iter_init_outer: 1
[12/18 19:20:54] fastreid INFO: [M_param] update_ratio: 0.0
[12/18 19:20:54] fastreid INFO: [M_param] iters_per_epoch: 1
[12/18 19:20:54] fastreid INFO: [M_param] iter_mtrain: 1
[12/18 19:20:54] fastreid INFO: [M_param] shuffle_domain: True
[12/18 19:20:54] fastreid INFO: [M_param] use_second_order: False
[12/18 19:20:54] fastreid INFO: [M_param] num_mtrain: 3
[12/18 19:20:54] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/18 19:20:54] fastreid INFO: [M_param] allow_unused: False
[12/18 19:20:54] fastreid INFO: [M_param] zero_grad: True
[12/18 19:20:54] fastreid INFO: [M_param] type_running_stats_init: general
[12/18 19:20:54] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/18 19:20:54] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/18 19:20:54] fastreid INFO: [M_param] auto_grad_outside: True
[12/18 19:20:54] fastreid INFO: [M_param] inner_clamp: True
[12/18 19:20:54] fastreid INFO: [M_param] synth_grad: none
[12/18 19:20:54] fastreid INFO: [M_param] constant_grad: 0.01
[12/18 19:20:54] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/18 19:20:54] fastreid INFO: [M_param] print_grad: True
[12/18 19:20:54] fastreid INFO: [M_param] one_loss_for_iter: False
[12/18 19:20:54] fastreid INFO: [M_param] one_loss_order: forward
[12/18 19:20:54] fastreid INFO: [M_param] num_mtest: 3
[12/18 19:20:54] fastreid INFO: [M_param] sync: True
[12/18 19:20:54] fastreid INFO: [M_param] detail_mode: True
[12/18 19:20:54] fastreid INFO: [M_param] stop_gradient: True
[12/18 19:20:54] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/18 19:20:54] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/18 19:20:54] fastreid INFO: [M_param] main_zero_grad: True
[12/18 19:20:54] fastreid INFO: [M_param] norm_zero_grad: True
[12/18 19:20:54] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/18 19:20:54] fastreid INFO: [M_param] write_period_param: 1000
[12/18 19:20:54] fastreid INFO: [M_param] loss_combined: False
[12/18 19:20:54] fastreid INFO: [M_param] loss_weight: 1.0
[12/18 19:20:54] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/18 19:20:54] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/18 19:20:54] fastreid INFO: ------------------------------
[12/18 19:24:07] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 19:24:08] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 19:24:08] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 19:24:08] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 19:24:08] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 19:24:08] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 19:24:08] fastreid.data.datasets.bases INFO: => Loaded LiteData
[12/18 19:24:08] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:24:08] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 19:24:08] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:24:08] fastreid.data.datasets.bases INFO:   train    |     4 |       16 |         6
[12/18 19:24:08] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:24:08] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 19:24:10] fastreid INFO: ------------------------------
[12/18 19:24:10] fastreid INFO: Meta-learning paramters
[12/18 19:24:10] fastreid INFO: ------------------------------
[12/18 19:24:10] fastreid INFO: [M_param] synth_data: none
[12/18 19:24:10] fastreid INFO: [M_param] synth_method: real
[12/18 19:24:10] fastreid INFO: [M_param] num_domain: 6
[12/18 19:24:10] fastreid INFO: [M_param] whole: True
[12/18 19:24:10] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/18 19:24:10] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/18 19:24:10] fastreid INFO: [M_param] meta_all_params: False
[12/18 19:24:10] fastreid INFO: [M_param] iter_init_inner: 1
[12/18 19:24:10] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/18 19:24:10] fastreid INFO: [M_param] iter_init_outer: 1
[12/18 19:24:10] fastreid INFO: [M_param] update_ratio: 0.0
[12/18 19:24:10] fastreid INFO: [M_param] iters_per_epoch: 1
[12/18 19:24:10] fastreid INFO: [M_param] iter_mtrain: 1
[12/18 19:24:10] fastreid INFO: [M_param] shuffle_domain: True
[12/18 19:24:10] fastreid INFO: [M_param] use_second_order: False
[12/18 19:24:10] fastreid INFO: [M_param] num_mtrain: 3
[12/18 19:24:10] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/18 19:24:10] fastreid INFO: [M_param] allow_unused: False
[12/18 19:24:10] fastreid INFO: [M_param] zero_grad: True
[12/18 19:24:10] fastreid INFO: [M_param] type_running_stats_init: general
[12/18 19:24:10] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/18 19:24:10] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/18 19:24:10] fastreid INFO: [M_param] auto_grad_outside: True
[12/18 19:24:10] fastreid INFO: [M_param] inner_clamp: True
[12/18 19:24:10] fastreid INFO: [M_param] synth_grad: none
[12/18 19:24:10] fastreid INFO: [M_param] constant_grad: 0.01
[12/18 19:24:10] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/18 19:24:10] fastreid INFO: [M_param] print_grad: True
[12/18 19:24:10] fastreid INFO: [M_param] one_loss_for_iter: False
[12/18 19:24:10] fastreid INFO: [M_param] one_loss_order: forward
[12/18 19:24:10] fastreid INFO: [M_param] num_mtest: 3
[12/18 19:24:10] fastreid INFO: [M_param] sync: True
[12/18 19:24:10] fastreid INFO: [M_param] detail_mode: True
[12/18 19:24:10] fastreid INFO: [M_param] stop_gradient: True
[12/18 19:24:10] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/18 19:24:10] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/18 19:24:10] fastreid INFO: [M_param] main_zero_grad: True
[12/18 19:24:10] fastreid INFO: [M_param] norm_zero_grad: True
[12/18 19:24:10] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/18 19:24:10] fastreid INFO: [M_param] write_period_param: 1000
[12/18 19:24:10] fastreid INFO: [M_param] loss_combined: False
[12/18 19:24:10] fastreid INFO: [M_param] loss_weight: 1.0
[12/18 19:24:10] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/18 19:24:10] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/18 19:24:10] fastreid INFO: ------------------------------
[12/18 19:26:27] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 19:26:28] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 19:26:28] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 19:26:28] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 19:26:28] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 19:26:28] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 19:26:28] fastreid.data.datasets.bases INFO: => Loaded LiteData
[12/18 19:26:28] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:26:28] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 19:26:28] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:26:28] fastreid.data.datasets.bases INFO:   train    |     4 |       16 |         6
[12/18 19:26:28] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:26:28] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 19:26:30] fastreid INFO: ------------------------------
[12/18 19:26:30] fastreid INFO: Meta-learning paramters
[12/18 19:26:30] fastreid INFO: ------------------------------
[12/18 19:26:30] fastreid INFO: [M_param] synth_data: none
[12/18 19:26:30] fastreid INFO: [M_param] synth_method: real
[12/18 19:26:30] fastreid INFO: [M_param] num_domain: 6
[12/18 19:26:30] fastreid INFO: [M_param] whole: True
[12/18 19:26:30] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/18 19:26:30] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/18 19:26:30] fastreid INFO: [M_param] meta_all_params: False
[12/18 19:26:30] fastreid INFO: [M_param] iter_init_inner: 1
[12/18 19:26:30] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/18 19:26:30] fastreid INFO: [M_param] iter_init_outer: 1
[12/18 19:26:30] fastreid INFO: [M_param] update_ratio: 0.0
[12/18 19:26:30] fastreid INFO: [M_param] iters_per_epoch: 1
[12/18 19:26:30] fastreid INFO: [M_param] iter_mtrain: 1
[12/18 19:26:30] fastreid INFO: [M_param] shuffle_domain: True
[12/18 19:26:30] fastreid INFO: [M_param] use_second_order: False
[12/18 19:26:30] fastreid INFO: [M_param] num_mtrain: 3
[12/18 19:26:30] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/18 19:26:30] fastreid INFO: [M_param] allow_unused: False
[12/18 19:26:30] fastreid INFO: [M_param] zero_grad: True
[12/18 19:26:30] fastreid INFO: [M_param] type_running_stats_init: general
[12/18 19:26:30] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/18 19:26:30] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/18 19:26:30] fastreid INFO: [M_param] auto_grad_outside: True
[12/18 19:26:30] fastreid INFO: [M_param] inner_clamp: True
[12/18 19:26:30] fastreid INFO: [M_param] synth_grad: none
[12/18 19:26:30] fastreid INFO: [M_param] constant_grad: 0.01
[12/18 19:26:30] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/18 19:26:30] fastreid INFO: [M_param] print_grad: True
[12/18 19:26:30] fastreid INFO: [M_param] one_loss_for_iter: False
[12/18 19:26:30] fastreid INFO: [M_param] one_loss_order: forward
[12/18 19:26:30] fastreid INFO: [M_param] num_mtest: 3
[12/18 19:26:30] fastreid INFO: [M_param] sync: True
[12/18 19:26:30] fastreid INFO: [M_param] detail_mode: True
[12/18 19:26:30] fastreid INFO: [M_param] stop_gradient: True
[12/18 19:26:30] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/18 19:26:30] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/18 19:26:30] fastreid INFO: [M_param] main_zero_grad: True
[12/18 19:26:30] fastreid INFO: [M_param] norm_zero_grad: True
[12/18 19:26:30] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/18 19:26:30] fastreid INFO: [M_param] write_period_param: 1000
[12/18 19:26:30] fastreid INFO: [M_param] loss_combined: False
[12/18 19:26:30] fastreid INFO: [M_param] loss_weight: 1.0
[12/18 19:26:30] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/18 19:26:30] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/18 19:26:30] fastreid INFO: ------------------------------
[12/18 19:27:05] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 19:27:06] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 19:27:06] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 19:27:06] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 19:27:06] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 19:27:06] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 19:27:06] fastreid.data.datasets.bases INFO: => Loaded LiteData
[12/18 19:27:06] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:27:06] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 19:27:06] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:27:06] fastreid.data.datasets.bases INFO:   train    |     4 |       16 |         6
[12/18 19:27:06] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:27:06] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 19:27:08] fastreid INFO: ------------------------------
[12/18 19:27:08] fastreid INFO: Meta-learning paramters
[12/18 19:27:08] fastreid INFO: ------------------------------
[12/18 19:27:08] fastreid INFO: [M_param] synth_data: none
[12/18 19:27:08] fastreid INFO: [M_param] synth_method: real
[12/18 19:27:08] fastreid INFO: [M_param] num_domain: 6
[12/18 19:27:08] fastreid INFO: [M_param] whole: True
[12/18 19:27:08] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/18 19:27:08] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/18 19:27:08] fastreid INFO: [M_param] meta_all_params: False
[12/18 19:27:08] fastreid INFO: [M_param] iter_init_inner: 1
[12/18 19:27:08] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/18 19:27:08] fastreid INFO: [M_param] iter_init_outer: 1
[12/18 19:27:08] fastreid INFO: [M_param] update_ratio: 0.0
[12/18 19:27:08] fastreid INFO: [M_param] iters_per_epoch: 1
[12/18 19:27:08] fastreid INFO: [M_param] iter_mtrain: 1
[12/18 19:27:08] fastreid INFO: [M_param] shuffle_domain: True
[12/18 19:27:08] fastreid INFO: [M_param] use_second_order: False
[12/18 19:27:08] fastreid INFO: [M_param] num_mtrain: 3
[12/18 19:27:08] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/18 19:27:08] fastreid INFO: [M_param] allow_unused: False
[12/18 19:27:08] fastreid INFO: [M_param] zero_grad: True
[12/18 19:27:08] fastreid INFO: [M_param] type_running_stats_init: general
[12/18 19:27:08] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/18 19:27:08] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/18 19:27:08] fastreid INFO: [M_param] auto_grad_outside: True
[12/18 19:27:08] fastreid INFO: [M_param] inner_clamp: True
[12/18 19:27:08] fastreid INFO: [M_param] synth_grad: none
[12/18 19:27:08] fastreid INFO: [M_param] constant_grad: 0.01
[12/18 19:27:08] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/18 19:27:08] fastreid INFO: [M_param] print_grad: True
[12/18 19:27:08] fastreid INFO: [M_param] one_loss_for_iter: False
[12/18 19:27:08] fastreid INFO: [M_param] one_loss_order: forward
[12/18 19:27:08] fastreid INFO: [M_param] num_mtest: 3
[12/18 19:27:08] fastreid INFO: [M_param] sync: True
[12/18 19:27:08] fastreid INFO: [M_param] detail_mode: True
[12/18 19:27:08] fastreid INFO: [M_param] stop_gradient: True
[12/18 19:27:08] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/18 19:27:08] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/18 19:27:08] fastreid INFO: [M_param] main_zero_grad: True
[12/18 19:27:08] fastreid INFO: [M_param] norm_zero_grad: True
[12/18 19:27:08] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/18 19:27:08] fastreid INFO: [M_param] write_period_param: 1000
[12/18 19:27:08] fastreid INFO: [M_param] loss_combined: False
[12/18 19:27:08] fastreid INFO: [M_param] loss_weight: 1.0
[12/18 19:27:08] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/18 19:27:08] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/18 19:27:08] fastreid INFO: ------------------------------
[12/18 19:27:34] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 19:27:35] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 19:27:35] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 19:27:35] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 19:27:35] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 19:27:35] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 19:27:35] fastreid.data.datasets.bases INFO: => Loaded LiteData
[12/18 19:27:35] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:27:35] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 19:27:35] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:27:35] fastreid.data.datasets.bases INFO:   train    |     4 |       16 |         6
[12/18 19:27:35] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:27:35] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 19:27:37] fastreid INFO: ------------------------------
[12/18 19:27:37] fastreid INFO: Meta-learning paramters
[12/18 19:27:37] fastreid INFO: ------------------------------
[12/18 19:27:37] fastreid INFO: [M_param] synth_data: none
[12/18 19:27:37] fastreid INFO: [M_param] synth_method: real
[12/18 19:27:37] fastreid INFO: [M_param] num_domain: 6
[12/18 19:27:37] fastreid INFO: [M_param] whole: True
[12/18 19:27:37] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/18 19:27:37] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/18 19:27:37] fastreid INFO: [M_param] meta_all_params: False
[12/18 19:27:37] fastreid INFO: [M_param] iter_init_inner: 1
[12/18 19:27:37] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/18 19:27:37] fastreid INFO: [M_param] iter_init_outer: 1
[12/18 19:27:37] fastreid INFO: [M_param] update_ratio: 0.0
[12/18 19:27:37] fastreid INFO: [M_param] iters_per_epoch: 1
[12/18 19:27:37] fastreid INFO: [M_param] iter_mtrain: 1
[12/18 19:27:37] fastreid INFO: [M_param] shuffle_domain: True
[12/18 19:27:37] fastreid INFO: [M_param] use_second_order: False
[12/18 19:27:37] fastreid INFO: [M_param] num_mtrain: 3
[12/18 19:27:37] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/18 19:27:37] fastreid INFO: [M_param] allow_unused: False
[12/18 19:27:37] fastreid INFO: [M_param] zero_grad: True
[12/18 19:27:37] fastreid INFO: [M_param] type_running_stats_init: general
[12/18 19:27:37] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/18 19:27:37] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/18 19:27:37] fastreid INFO: [M_param] auto_grad_outside: True
[12/18 19:27:37] fastreid INFO: [M_param] inner_clamp: True
[12/18 19:27:37] fastreid INFO: [M_param] synth_grad: none
[12/18 19:27:37] fastreid INFO: [M_param] constant_grad: 0.01
[12/18 19:27:37] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/18 19:27:37] fastreid INFO: [M_param] print_grad: True
[12/18 19:27:37] fastreid INFO: [M_param] one_loss_for_iter: False
[12/18 19:27:37] fastreid INFO: [M_param] one_loss_order: forward
[12/18 19:27:37] fastreid INFO: [M_param] num_mtest: 3
[12/18 19:27:37] fastreid INFO: [M_param] sync: True
[12/18 19:27:37] fastreid INFO: [M_param] detail_mode: True
[12/18 19:27:37] fastreid INFO: [M_param] stop_gradient: True
[12/18 19:27:37] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/18 19:27:37] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/18 19:27:37] fastreid INFO: [M_param] main_zero_grad: True
[12/18 19:27:37] fastreid INFO: [M_param] norm_zero_grad: True
[12/18 19:27:37] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/18 19:27:37] fastreid INFO: [M_param] write_period_param: 1000
[12/18 19:27:37] fastreid INFO: [M_param] loss_combined: False
[12/18 19:27:37] fastreid INFO: [M_param] loss_weight: 1.0
[12/18 19:27:37] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/18 19:27:37] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/18 19:27:37] fastreid INFO: ------------------------------
[12/18 19:29:03] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 19:29:04] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 19:29:04] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 19:29:04] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 19:29:04] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 19:29:04] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 19:29:04] fastreid.data.datasets.bases INFO: => Loaded LiteData
[12/18 19:29:04] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:29:04] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 19:29:04] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:29:04] fastreid.data.datasets.bases INFO:   train    |     4 |       16 |         6
[12/18 19:29:04] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:29:04] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 19:29:06] fastreid INFO: ------------------------------
[12/18 19:29:06] fastreid INFO: Meta-learning paramters
[12/18 19:29:06] fastreid INFO: ------------------------------
[12/18 19:29:06] fastreid INFO: [M_param] synth_data: none
[12/18 19:29:06] fastreid INFO: [M_param] synth_method: real
[12/18 19:29:06] fastreid INFO: [M_param] num_domain: 6
[12/18 19:29:06] fastreid INFO: [M_param] whole: True
[12/18 19:29:06] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/18 19:29:06] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/18 19:29:06] fastreid INFO: [M_param] meta_all_params: False
[12/18 19:29:06] fastreid INFO: [M_param] iter_init_inner: 1
[12/18 19:29:06] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/18 19:29:06] fastreid INFO: [M_param] iter_init_outer: 1
[12/18 19:29:06] fastreid INFO: [M_param] update_ratio: 0.0
[12/18 19:29:06] fastreid INFO: [M_param] iters_per_epoch: 1
[12/18 19:29:06] fastreid INFO: [M_param] iter_mtrain: 1
[12/18 19:29:06] fastreid INFO: [M_param] shuffle_domain: True
[12/18 19:29:06] fastreid INFO: [M_param] use_second_order: False
[12/18 19:29:06] fastreid INFO: [M_param] num_mtrain: 3
[12/18 19:29:06] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/18 19:29:06] fastreid INFO: [M_param] allow_unused: False
[12/18 19:29:06] fastreid INFO: [M_param] zero_grad: True
[12/18 19:29:06] fastreid INFO: [M_param] type_running_stats_init: general
[12/18 19:29:06] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/18 19:29:06] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/18 19:29:06] fastreid INFO: [M_param] auto_grad_outside: True
[12/18 19:29:06] fastreid INFO: [M_param] inner_clamp: True
[12/18 19:29:06] fastreid INFO: [M_param] synth_grad: none
[12/18 19:29:06] fastreid INFO: [M_param] constant_grad: 0.01
[12/18 19:29:06] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/18 19:29:06] fastreid INFO: [M_param] print_grad: True
[12/18 19:29:06] fastreid INFO: [M_param] one_loss_for_iter: False
[12/18 19:29:06] fastreid INFO: [M_param] one_loss_order: forward
[12/18 19:29:06] fastreid INFO: [M_param] num_mtest: 3
[12/18 19:29:06] fastreid INFO: [M_param] sync: True
[12/18 19:29:06] fastreid INFO: [M_param] detail_mode: True
[12/18 19:29:06] fastreid INFO: [M_param] stop_gradient: True
[12/18 19:29:06] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/18 19:29:06] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/18 19:29:06] fastreid INFO: [M_param] main_zero_grad: True
[12/18 19:29:06] fastreid INFO: [M_param] norm_zero_grad: True
[12/18 19:29:06] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/18 19:29:06] fastreid INFO: [M_param] write_period_param: 1000
[12/18 19:29:06] fastreid INFO: [M_param] loss_combined: False
[12/18 19:29:06] fastreid INFO: [M_param] loss_weight: 1.0
[12/18 19:29:06] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/18 19:29:06] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/18 19:29:06] fastreid INFO: ------------------------------
[12/18 19:30:42] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 19:30:43] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 19:30:43] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 19:30:43] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 19:30:43] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 19:30:43] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 19:30:43] fastreid.data.datasets.bases INFO: => Loaded LiteData
[12/18 19:30:43] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:30:43] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 19:30:43] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:30:43] fastreid.data.datasets.bases INFO:   train    |     4 |       16 |         6
[12/18 19:30:43] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:30:43] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 19:30:45] fastreid INFO: ------------------------------
[12/18 19:30:45] fastreid INFO: Meta-learning paramters
[12/18 19:30:45] fastreid INFO: ------------------------------
[12/18 19:30:45] fastreid INFO: [M_param] synth_data: none
[12/18 19:30:45] fastreid INFO: [M_param] synth_method: real
[12/18 19:30:45] fastreid INFO: [M_param] num_domain: 6
[12/18 19:30:45] fastreid INFO: [M_param] whole: True
[12/18 19:30:45] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/18 19:30:45] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/18 19:30:45] fastreid INFO: [M_param] meta_all_params: False
[12/18 19:30:45] fastreid INFO: [M_param] iter_init_inner: 1
[12/18 19:30:45] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/18 19:30:45] fastreid INFO: [M_param] iter_init_outer: 1
[12/18 19:30:45] fastreid INFO: [M_param] update_ratio: 0.0
[12/18 19:30:45] fastreid INFO: [M_param] iters_per_epoch: 1
[12/18 19:30:45] fastreid INFO: [M_param] iter_mtrain: 1
[12/18 19:30:45] fastreid INFO: [M_param] shuffle_domain: True
[12/18 19:30:45] fastreid INFO: [M_param] use_second_order: False
[12/18 19:30:45] fastreid INFO: [M_param] num_mtrain: 3
[12/18 19:30:45] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/18 19:30:45] fastreid INFO: [M_param] allow_unused: False
[12/18 19:30:45] fastreid INFO: [M_param] zero_grad: True
[12/18 19:30:45] fastreid INFO: [M_param] type_running_stats_init: general
[12/18 19:30:45] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/18 19:30:45] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/18 19:30:45] fastreid INFO: [M_param] auto_grad_outside: True
[12/18 19:30:45] fastreid INFO: [M_param] inner_clamp: True
[12/18 19:30:45] fastreid INFO: [M_param] synth_grad: none
[12/18 19:30:45] fastreid INFO: [M_param] constant_grad: 0.01
[12/18 19:30:45] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/18 19:30:45] fastreid INFO: [M_param] print_grad: True
[12/18 19:30:45] fastreid INFO: [M_param] one_loss_for_iter: False
[12/18 19:30:45] fastreid INFO: [M_param] one_loss_order: forward
[12/18 19:30:45] fastreid INFO: [M_param] num_mtest: 3
[12/18 19:30:45] fastreid INFO: [M_param] sync: True
[12/18 19:30:45] fastreid INFO: [M_param] detail_mode: True
[12/18 19:30:45] fastreid INFO: [M_param] stop_gradient: True
[12/18 19:30:45] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/18 19:30:45] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/18 19:30:45] fastreid INFO: [M_param] main_zero_grad: True
[12/18 19:30:45] fastreid INFO: [M_param] norm_zero_grad: True
[12/18 19:30:45] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/18 19:30:45] fastreid INFO: [M_param] write_period_param: 1000
[12/18 19:30:45] fastreid INFO: [M_param] loss_combined: False
[12/18 19:30:45] fastreid INFO: [M_param] loss_weight: 1.0
[12/18 19:30:45] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/18 19:30:45] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/18 19:30:45] fastreid INFO: ------------------------------
[12/18 19:31:32] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 19:31:33] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 19:31:33] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 19:31:33] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 19:31:33] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 19:31:33] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 19:31:33] fastreid.data.datasets.bases INFO: => Loaded LiteData
[12/18 19:31:33] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:31:33] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 19:31:33] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:31:33] fastreid.data.datasets.bases INFO:   train    |     4 |       16 |         6
[12/18 19:31:33] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:31:33] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 19:31:35] fastreid INFO: ------------------------------
[12/18 19:31:35] fastreid INFO: Meta-learning paramters
[12/18 19:31:35] fastreid INFO: ------------------------------
[12/18 19:31:35] fastreid INFO: [M_param] synth_data: none
[12/18 19:31:35] fastreid INFO: [M_param] synth_method: real
[12/18 19:31:35] fastreid INFO: [M_param] num_domain: 6
[12/18 19:31:35] fastreid INFO: [M_param] whole: True
[12/18 19:31:35] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/18 19:31:35] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/18 19:31:35] fastreid INFO: [M_param] meta_all_params: False
[12/18 19:31:35] fastreid INFO: [M_param] iter_init_inner: 1
[12/18 19:31:35] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/18 19:31:35] fastreid INFO: [M_param] iter_init_outer: 1
[12/18 19:31:35] fastreid INFO: [M_param] update_ratio: 0.0
[12/18 19:31:35] fastreid INFO: [M_param] iters_per_epoch: 1
[12/18 19:31:35] fastreid INFO: [M_param] iter_mtrain: 1
[12/18 19:31:35] fastreid INFO: [M_param] shuffle_domain: True
[12/18 19:31:35] fastreid INFO: [M_param] use_second_order: False
[12/18 19:31:35] fastreid INFO: [M_param] num_mtrain: 3
[12/18 19:31:35] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/18 19:31:35] fastreid INFO: [M_param] allow_unused: False
[12/18 19:31:35] fastreid INFO: [M_param] zero_grad: True
[12/18 19:31:35] fastreid INFO: [M_param] type_running_stats_init: general
[12/18 19:31:35] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/18 19:31:35] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/18 19:31:35] fastreid INFO: [M_param] auto_grad_outside: True
[12/18 19:31:35] fastreid INFO: [M_param] inner_clamp: True
[12/18 19:31:35] fastreid INFO: [M_param] synth_grad: none
[12/18 19:31:35] fastreid INFO: [M_param] constant_grad: 0.01
[12/18 19:31:35] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/18 19:31:35] fastreid INFO: [M_param] print_grad: True
[12/18 19:31:35] fastreid INFO: [M_param] one_loss_for_iter: False
[12/18 19:31:35] fastreid INFO: [M_param] one_loss_order: forward
[12/18 19:31:35] fastreid INFO: [M_param] num_mtest: 3
[12/18 19:31:35] fastreid INFO: [M_param] sync: True
[12/18 19:31:35] fastreid INFO: [M_param] detail_mode: True
[12/18 19:31:35] fastreid INFO: [M_param] stop_gradient: True
[12/18 19:31:35] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/18 19:31:35] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/18 19:31:35] fastreid INFO: [M_param] main_zero_grad: True
[12/18 19:31:35] fastreid INFO: [M_param] norm_zero_grad: True
[12/18 19:31:35] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/18 19:31:35] fastreid INFO: [M_param] write_period_param: 1000
[12/18 19:31:35] fastreid INFO: [M_param] loss_combined: False
[12/18 19:31:35] fastreid INFO: [M_param] loss_weight: 1.0
[12/18 19:31:35] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/18 19:31:35] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/18 19:31:35] fastreid INFO: ------------------------------
[12/18 19:32:10] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 19:32:11] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 19:32:11] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 19:32:11] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 19:32:11] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 19:32:12] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 19:32:12] fastreid.data.datasets.bases INFO: => Loaded LiteData
[12/18 19:32:12] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:32:12] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 19:32:12] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:32:12] fastreid.data.datasets.bases INFO:   train    |     4 |       16 |         6
[12/18 19:32:12] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:32:12] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 19:32:14] fastreid INFO: ------------------------------
[12/18 19:32:14] fastreid INFO: Meta-learning paramters
[12/18 19:32:14] fastreid INFO: ------------------------------
[12/18 19:32:14] fastreid INFO: [M_param] synth_data: none
[12/18 19:32:14] fastreid INFO: [M_param] synth_method: real
[12/18 19:32:14] fastreid INFO: [M_param] num_domain: 6
[12/18 19:32:14] fastreid INFO: [M_param] whole: True
[12/18 19:32:14] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/18 19:32:14] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/18 19:32:14] fastreid INFO: [M_param] meta_all_params: False
[12/18 19:32:14] fastreid INFO: [M_param] iter_init_inner: 1
[12/18 19:32:14] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/18 19:32:14] fastreid INFO: [M_param] iter_init_outer: 1
[12/18 19:32:14] fastreid INFO: [M_param] update_ratio: 0.0
[12/18 19:32:14] fastreid INFO: [M_param] iters_per_epoch: 1
[12/18 19:32:14] fastreid INFO: [M_param] iter_mtrain: 1
[12/18 19:32:14] fastreid INFO: [M_param] shuffle_domain: True
[12/18 19:32:14] fastreid INFO: [M_param] use_second_order: False
[12/18 19:32:14] fastreid INFO: [M_param] num_mtrain: 3
[12/18 19:32:14] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/18 19:32:14] fastreid INFO: [M_param] allow_unused: False
[12/18 19:32:14] fastreid INFO: [M_param] zero_grad: True
[12/18 19:32:14] fastreid INFO: [M_param] type_running_stats_init: general
[12/18 19:32:14] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/18 19:32:14] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/18 19:32:14] fastreid INFO: [M_param] auto_grad_outside: True
[12/18 19:32:14] fastreid INFO: [M_param] inner_clamp: True
[12/18 19:32:14] fastreid INFO: [M_param] synth_grad: none
[12/18 19:32:14] fastreid INFO: [M_param] constant_grad: 0.01
[12/18 19:32:14] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/18 19:32:14] fastreid INFO: [M_param] print_grad: True
[12/18 19:32:14] fastreid INFO: [M_param] one_loss_for_iter: False
[12/18 19:32:14] fastreid INFO: [M_param] one_loss_order: forward
[12/18 19:32:14] fastreid INFO: [M_param] num_mtest: 3
[12/18 19:32:14] fastreid INFO: [M_param] sync: True
[12/18 19:32:14] fastreid INFO: [M_param] detail_mode: True
[12/18 19:32:14] fastreid INFO: [M_param] stop_gradient: True
[12/18 19:32:14] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/18 19:32:14] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/18 19:32:14] fastreid INFO: [M_param] main_zero_grad: True
[12/18 19:32:14] fastreid INFO: [M_param] norm_zero_grad: True
[12/18 19:32:14] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/18 19:32:14] fastreid INFO: [M_param] write_period_param: 1000
[12/18 19:32:14] fastreid INFO: [M_param] loss_combined: False
[12/18 19:32:14] fastreid INFO: [M_param] loss_weight: 1.0
[12/18 19:32:14] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/18 19:32:14] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/18 19:32:14] fastreid INFO: ------------------------------
[12/18 19:49:27] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 19:49:28] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 19:49:28] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 19:49:28] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 19:49:28] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 19:49:28] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 19:49:29] fastreid.data.datasets.bases INFO: => Loaded Market1501
[12/18 19:49:29] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:49:29] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 19:49:29] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:49:29] fastreid.data.datasets.bases INFO:   train    |   751 |    12936 |         6
[12/18 19:49:29] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:49:30] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 19:49:32] fastreid INFO: ------------------------------
[12/18 19:49:32] fastreid INFO: Meta-learning paramters
[12/18 19:49:32] fastreid INFO: ------------------------------
[12/18 19:49:32] fastreid INFO: [M_param] synth_data: none
[12/18 19:49:32] fastreid INFO: [M_param] synth_method: real
[12/18 19:49:32] fastreid INFO: [M_param] num_domain: 6
[12/18 19:49:32] fastreid INFO: [M_param] whole: True
[12/18 19:49:32] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/18 19:49:32] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/18 19:49:32] fastreid INFO: [M_param] meta_all_params: False
[12/18 19:49:32] fastreid INFO: [M_param] iter_init_inner: 1
[12/18 19:49:32] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/18 19:49:32] fastreid INFO: [M_param] iter_init_outer: 1
[12/18 19:49:32] fastreid INFO: [M_param] update_ratio: 0.0
[12/18 19:49:32] fastreid INFO: [M_param] iters_per_epoch: 2341
[12/18 19:49:32] fastreid INFO: [M_param] iter_mtrain: 1
[12/18 19:49:32] fastreid INFO: [M_param] shuffle_domain: True
[12/18 19:49:32] fastreid INFO: [M_param] use_second_order: False
[12/18 19:49:32] fastreid INFO: [M_param] num_mtrain: 3
[12/18 19:49:32] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/18 19:49:32] fastreid INFO: [M_param] allow_unused: False
[12/18 19:49:32] fastreid INFO: [M_param] zero_grad: True
[12/18 19:49:32] fastreid INFO: [M_param] type_running_stats_init: general
[12/18 19:49:32] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/18 19:49:32] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/18 19:49:32] fastreid INFO: [M_param] auto_grad_outside: True
[12/18 19:49:32] fastreid INFO: [M_param] inner_clamp: True
[12/18 19:49:32] fastreid INFO: [M_param] synth_grad: none
[12/18 19:49:32] fastreid INFO: [M_param] constant_grad: 0.01
[12/18 19:49:32] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/18 19:49:32] fastreid INFO: [M_param] print_grad: True
[12/18 19:49:32] fastreid INFO: [M_param] one_loss_for_iter: False
[12/18 19:49:32] fastreid INFO: [M_param] one_loss_order: forward
[12/18 19:49:32] fastreid INFO: [M_param] num_mtest: 3
[12/18 19:49:32] fastreid INFO: [M_param] sync: True
[12/18 19:49:32] fastreid INFO: [M_param] detail_mode: True
[12/18 19:49:32] fastreid INFO: [M_param] stop_gradient: True
[12/18 19:49:32] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/18 19:49:32] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/18 19:49:32] fastreid INFO: [M_param] main_zero_grad: True
[12/18 19:49:32] fastreid INFO: [M_param] norm_zero_grad: True
[12/18 19:49:32] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/18 19:49:32] fastreid INFO: [M_param] write_period_param: 1000
[12/18 19:49:32] fastreid INFO: [M_param] loss_combined: False
[12/18 19:49:32] fastreid INFO: [M_param] loss_weight: 1.0
[12/18 19:49:32] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/18 19:49:32] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/18 19:49:32] fastreid INFO: ------------------------------
[12/18 19:58:40] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 19:58:41] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 19:58:41] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 19:58:41] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 19:58:41] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 19:58:41] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 19:58:42] fastreid.data.datasets.bases INFO: => Loaded Market1501
[12/18 19:58:42] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:58:42] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 19:58:42] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:58:42] fastreid.data.datasets.bases INFO:   train    |   751 |    12936 |         6
[12/18 19:58:42] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:58:42] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 19:58:44] fastreid INFO: ------------------------------
[12/18 19:58:44] fastreid INFO: Meta-learning paramters
[12/18 19:58:44] fastreid INFO: ------------------------------
[12/18 19:58:44] fastreid INFO: [M_param] synth_data: none
[12/18 19:58:44] fastreid INFO: [M_param] synth_method: real
[12/18 19:58:44] fastreid INFO: [M_param] num_domain: 6
[12/18 19:58:44] fastreid INFO: [M_param] whole: True
[12/18 19:58:44] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/18 19:58:44] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/18 19:58:44] fastreid INFO: [M_param] meta_all_params: False
[12/18 19:58:44] fastreid INFO: [M_param] iter_init_inner: 1
[12/18 19:58:44] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/18 19:58:44] fastreid INFO: [M_param] iter_init_outer: 1
[12/18 19:58:44] fastreid INFO: [M_param] update_ratio: 0.0
[12/18 19:58:44] fastreid INFO: [M_param] iters_per_epoch: 2341
[12/18 19:58:44] fastreid INFO: [M_param] iter_mtrain: 1
[12/18 19:58:44] fastreid INFO: [M_param] shuffle_domain: True
[12/18 19:58:44] fastreid INFO: [M_param] use_second_order: False
[12/18 19:58:44] fastreid INFO: [M_param] num_mtrain: 3
[12/18 19:58:44] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/18 19:58:44] fastreid INFO: [M_param] allow_unused: False
[12/18 19:58:44] fastreid INFO: [M_param] zero_grad: True
[12/18 19:58:44] fastreid INFO: [M_param] type_running_stats_init: general
[12/18 19:58:44] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/18 19:58:44] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/18 19:58:44] fastreid INFO: [M_param] auto_grad_outside: True
[12/18 19:58:44] fastreid INFO: [M_param] inner_clamp: True
[12/18 19:58:44] fastreid INFO: [M_param] synth_grad: none
[12/18 19:58:44] fastreid INFO: [M_param] constant_grad: 0.01
[12/18 19:58:44] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/18 19:58:44] fastreid INFO: [M_param] print_grad: True
[12/18 19:58:44] fastreid INFO: [M_param] one_loss_for_iter: False
[12/18 19:58:44] fastreid INFO: [M_param] one_loss_order: forward
[12/18 19:58:44] fastreid INFO: [M_param] num_mtest: 3
[12/18 19:58:44] fastreid INFO: [M_param] sync: True
[12/18 19:58:44] fastreid INFO: [M_param] detail_mode: True
[12/18 19:58:44] fastreid INFO: [M_param] stop_gradient: True
[12/18 19:58:44] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/18 19:58:44] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/18 19:58:44] fastreid INFO: [M_param] main_zero_grad: True
[12/18 19:58:44] fastreid INFO: [M_param] norm_zero_grad: True
[12/18 19:58:44] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/18 19:58:44] fastreid INFO: [M_param] write_period_param: 1000
[12/18 19:58:44] fastreid INFO: [M_param] loss_combined: False
[12/18 19:58:44] fastreid INFO: [M_param] loss_weight: 1.0
[12/18 19:58:44] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/18 19:58:44] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/18 19:58:44] fastreid INFO: ------------------------------
[12/18 19:59:13] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 19:59:14] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 19:59:14] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 19:59:14] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 19:59:14] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 19:59:14] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 19:59:15] fastreid.data.datasets.bases INFO: => Loaded LiteData
[12/18 19:59:15] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:59:15] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 19:59:15] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:59:15] fastreid.data.datasets.bases INFO:   train    |     4 |       16 |         6
[12/18 19:59:15] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:59:15] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 19:59:17] fastreid INFO: ------------------------------
[12/18 19:59:17] fastreid INFO: Meta-learning paramters
[12/18 19:59:17] fastreid INFO: ------------------------------
[12/18 19:59:17] fastreid INFO: [M_param] synth_data: none
[12/18 19:59:17] fastreid INFO: [M_param] synth_method: real
[12/18 19:59:17] fastreid INFO: [M_param] num_domain: 6
[12/18 19:59:17] fastreid INFO: [M_param] whole: True
[12/18 19:59:17] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/18 19:59:17] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/18 19:59:17] fastreid INFO: [M_param] meta_all_params: False
[12/18 19:59:17] fastreid INFO: [M_param] iter_init_inner: 1
[12/18 19:59:17] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/18 19:59:17] fastreid INFO: [M_param] iter_init_outer: 1
[12/18 19:59:17] fastreid INFO: [M_param] update_ratio: 0.0
[12/18 19:59:17] fastreid INFO: [M_param] iters_per_epoch: 1
[12/18 19:59:17] fastreid INFO: [M_param] iter_mtrain: 1
[12/18 19:59:17] fastreid INFO: [M_param] shuffle_domain: True
[12/18 19:59:17] fastreid INFO: [M_param] use_second_order: False
[12/18 19:59:17] fastreid INFO: [M_param] num_mtrain: 3
[12/18 19:59:17] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/18 19:59:17] fastreid INFO: [M_param] allow_unused: False
[12/18 19:59:17] fastreid INFO: [M_param] zero_grad: True
[12/18 19:59:17] fastreid INFO: [M_param] type_running_stats_init: general
[12/18 19:59:17] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/18 19:59:17] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/18 19:59:17] fastreid INFO: [M_param] auto_grad_outside: True
[12/18 19:59:17] fastreid INFO: [M_param] inner_clamp: True
[12/18 19:59:17] fastreid INFO: [M_param] synth_grad: none
[12/18 19:59:17] fastreid INFO: [M_param] constant_grad: 0.01
[12/18 19:59:17] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/18 19:59:17] fastreid INFO: [M_param] print_grad: True
[12/18 19:59:17] fastreid INFO: [M_param] one_loss_for_iter: False
[12/18 19:59:17] fastreid INFO: [M_param] one_loss_order: forward
[12/18 19:59:17] fastreid INFO: [M_param] num_mtest: 3
[12/18 19:59:17] fastreid INFO: [M_param] sync: True
[12/18 19:59:17] fastreid INFO: [M_param] detail_mode: True
[12/18 19:59:17] fastreid INFO: [M_param] stop_gradient: True
[12/18 19:59:17] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/18 19:59:17] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/18 19:59:17] fastreid INFO: [M_param] main_zero_grad: True
[12/18 19:59:17] fastreid INFO: [M_param] norm_zero_grad: True
[12/18 19:59:17] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/18 19:59:17] fastreid INFO: [M_param] write_period_param: 1000
[12/18 19:59:17] fastreid INFO: [M_param] loss_combined: False
[12/18 19:59:17] fastreid INFO: [M_param] loss_weight: 1.0
[12/18 19:59:17] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/18 19:59:17] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/18 19:59:17] fastreid INFO: ------------------------------
[12/18 19:59:54] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 19:59:55] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 19:59:55] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 19:59:55] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 19:59:55] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 19:59:55] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 19:59:55] fastreid.data.datasets.bases INFO: => Loaded LiteData
[12/18 19:59:55] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:59:55] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 19:59:55] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:59:55] fastreid.data.datasets.bases INFO:   train    |     4 |       16 |         6
[12/18 19:59:55] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 19:59:55] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 19:59:57] fastreid INFO: ------------------------------
[12/18 19:59:57] fastreid INFO: Meta-learning paramters
[12/18 19:59:57] fastreid INFO: ------------------------------
[12/18 19:59:57] fastreid INFO: [M_param] synth_data: none
[12/18 19:59:57] fastreid INFO: [M_param] synth_method: real
[12/18 19:59:57] fastreid INFO: [M_param] num_domain: 6
[12/18 19:59:57] fastreid INFO: [M_param] whole: True
[12/18 19:59:57] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/18 19:59:57] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/18 19:59:57] fastreid INFO: [M_param] meta_all_params: False
[12/18 19:59:57] fastreid INFO: [M_param] iter_init_inner: 1
[12/18 19:59:57] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/18 19:59:57] fastreid INFO: [M_param] iter_init_outer: 1
[12/18 19:59:57] fastreid INFO: [M_param] update_ratio: 0.0
[12/18 19:59:57] fastreid INFO: [M_param] iters_per_epoch: 1
[12/18 19:59:57] fastreid INFO: [M_param] iter_mtrain: 1
[12/18 19:59:57] fastreid INFO: [M_param] shuffle_domain: True
[12/18 19:59:57] fastreid INFO: [M_param] use_second_order: False
[12/18 19:59:57] fastreid INFO: [M_param] num_mtrain: 3
[12/18 19:59:57] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/18 19:59:57] fastreid INFO: [M_param] allow_unused: False
[12/18 19:59:57] fastreid INFO: [M_param] zero_grad: True
[12/18 19:59:57] fastreid INFO: [M_param] type_running_stats_init: general
[12/18 19:59:57] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/18 19:59:57] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/18 19:59:57] fastreid INFO: [M_param] auto_grad_outside: True
[12/18 19:59:57] fastreid INFO: [M_param] inner_clamp: True
[12/18 19:59:57] fastreid INFO: [M_param] synth_grad: none
[12/18 19:59:57] fastreid INFO: [M_param] constant_grad: 0.01
[12/18 19:59:57] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/18 19:59:57] fastreid INFO: [M_param] print_grad: True
[12/18 19:59:57] fastreid INFO: [M_param] one_loss_for_iter: False
[12/18 19:59:57] fastreid INFO: [M_param] one_loss_order: forward
[12/18 19:59:57] fastreid INFO: [M_param] num_mtest: 3
[12/18 19:59:57] fastreid INFO: [M_param] sync: True
[12/18 19:59:57] fastreid INFO: [M_param] detail_mode: True
[12/18 19:59:57] fastreid INFO: [M_param] stop_gradient: True
[12/18 19:59:57] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/18 19:59:57] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/18 19:59:57] fastreid INFO: [M_param] main_zero_grad: True
[12/18 19:59:57] fastreid INFO: [M_param] norm_zero_grad: True
[12/18 19:59:57] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/18 19:59:57] fastreid INFO: [M_param] write_period_param: 1000
[12/18 19:59:57] fastreid INFO: [M_param] loss_combined: False
[12/18 19:59:57] fastreid INFO: [M_param] loss_weight: 1.0
[12/18 19:59:57] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/18 19:59:57] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/18 19:59:57] fastreid INFO: ------------------------------
[12/18 20:00:40] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 20:00:41] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 20:00:41] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 20:00:41] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 20:00:41] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 20:00:41] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 20:00:41] fastreid.data.datasets.bases INFO: => Loaded LiteData
[12/18 20:00:41] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 20:00:41] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 20:00:41] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 20:00:41] fastreid.data.datasets.bases INFO:   train    |     4 |       16 |         6
[12/18 20:00:41] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 20:00:41] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 20:00:43] fastreid INFO: ------------------------------
[12/18 20:00:43] fastreid INFO: Meta-learning paramters
[12/18 20:00:43] fastreid INFO: ------------------------------
[12/18 20:00:43] fastreid INFO: [M_param] synth_data: none
[12/18 20:00:43] fastreid INFO: [M_param] synth_method: real
[12/18 20:00:43] fastreid INFO: [M_param] num_domain: 6
[12/18 20:00:43] fastreid INFO: [M_param] whole: True
[12/18 20:00:43] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/18 20:00:43] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/18 20:00:43] fastreid INFO: [M_param] meta_all_params: False
[12/18 20:00:43] fastreid INFO: [M_param] iter_init_inner: 1
[12/18 20:00:43] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/18 20:00:43] fastreid INFO: [M_param] iter_init_outer: 1
[12/18 20:00:43] fastreid INFO: [M_param] update_ratio: 0.0
[12/18 20:00:43] fastreid INFO: [M_param] iters_per_epoch: 1
[12/18 20:00:43] fastreid INFO: [M_param] iter_mtrain: 1
[12/18 20:00:43] fastreid INFO: [M_param] shuffle_domain: True
[12/18 20:00:43] fastreid INFO: [M_param] use_second_order: False
[12/18 20:00:43] fastreid INFO: [M_param] num_mtrain: 3
[12/18 20:00:43] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/18 20:00:43] fastreid INFO: [M_param] allow_unused: False
[12/18 20:00:43] fastreid INFO: [M_param] zero_grad: True
[12/18 20:00:43] fastreid INFO: [M_param] type_running_stats_init: general
[12/18 20:00:43] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/18 20:00:43] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/18 20:00:43] fastreid INFO: [M_param] auto_grad_outside: True
[12/18 20:00:43] fastreid INFO: [M_param] inner_clamp: True
[12/18 20:00:43] fastreid INFO: [M_param] synth_grad: none
[12/18 20:00:43] fastreid INFO: [M_param] constant_grad: 0.01
[12/18 20:00:43] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/18 20:00:43] fastreid INFO: [M_param] print_grad: True
[12/18 20:00:43] fastreid INFO: [M_param] one_loss_for_iter: False
[12/18 20:00:43] fastreid INFO: [M_param] one_loss_order: forward
[12/18 20:00:43] fastreid INFO: [M_param] num_mtest: 3
[12/18 20:00:43] fastreid INFO: [M_param] sync: True
[12/18 20:00:43] fastreid INFO: [M_param] detail_mode: True
[12/18 20:00:43] fastreid INFO: [M_param] stop_gradient: True
[12/18 20:00:43] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/18 20:00:43] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/18 20:00:43] fastreid INFO: [M_param] main_zero_grad: True
[12/18 20:00:43] fastreid INFO: [M_param] norm_zero_grad: True
[12/18 20:00:43] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/18 20:00:43] fastreid INFO: [M_param] write_period_param: 1000
[12/18 20:00:43] fastreid INFO: [M_param] loss_combined: False
[12/18 20:00:43] fastreid INFO: [M_param] loss_weight: 1.0
[12/18 20:00:43] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/18 20:00:43] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/18 20:00:43] fastreid INFO: ------------------------------
[12/18 20:01:14] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 20:01:15] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 20:01:15] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 20:01:15] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 20:01:15] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 20:01:15] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 20:01:15] fastreid.data.datasets.bases INFO: => Loaded LiteData
[12/18 20:01:15] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 20:01:15] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 20:01:15] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 20:01:15] fastreid.data.datasets.bases INFO:   train    |     4 |       16 |         6
[12/18 20:01:15] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 20:01:15] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 20:01:17] fastreid INFO: ------------------------------
[12/18 20:01:17] fastreid INFO: Meta-learning paramters
[12/18 20:01:17] fastreid INFO: ------------------------------
[12/18 20:01:17] fastreid INFO: [M_param] synth_data: none
[12/18 20:01:17] fastreid INFO: [M_param] synth_method: real
[12/18 20:01:17] fastreid INFO: [M_param] num_domain: 6
[12/18 20:01:17] fastreid INFO: [M_param] whole: True
[12/18 20:01:17] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/18 20:01:17] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/18 20:01:17] fastreid INFO: [M_param] meta_all_params: False
[12/18 20:01:17] fastreid INFO: [M_param] iter_init_inner: 1
[12/18 20:01:17] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/18 20:01:17] fastreid INFO: [M_param] iter_init_outer: 1
[12/18 20:01:17] fastreid INFO: [M_param] update_ratio: 0.0
[12/18 20:01:17] fastreid INFO: [M_param] iters_per_epoch: 1
[12/18 20:01:17] fastreid INFO: [M_param] iter_mtrain: 1
[12/18 20:01:17] fastreid INFO: [M_param] shuffle_domain: True
[12/18 20:01:17] fastreid INFO: [M_param] use_second_order: False
[12/18 20:01:17] fastreid INFO: [M_param] num_mtrain: 3
[12/18 20:01:17] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/18 20:01:17] fastreid INFO: [M_param] allow_unused: False
[12/18 20:01:17] fastreid INFO: [M_param] zero_grad: True
[12/18 20:01:17] fastreid INFO: [M_param] type_running_stats_init: general
[12/18 20:01:17] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/18 20:01:17] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/18 20:01:17] fastreid INFO: [M_param] auto_grad_outside: True
[12/18 20:01:17] fastreid INFO: [M_param] inner_clamp: True
[12/18 20:01:17] fastreid INFO: [M_param] synth_grad: none
[12/18 20:01:17] fastreid INFO: [M_param] constant_grad: 0.01
[12/18 20:01:17] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/18 20:01:17] fastreid INFO: [M_param] print_grad: True
[12/18 20:01:17] fastreid INFO: [M_param] one_loss_for_iter: False
[12/18 20:01:17] fastreid INFO: [M_param] one_loss_order: forward
[12/18 20:01:17] fastreid INFO: [M_param] num_mtest: 3
[12/18 20:01:17] fastreid INFO: [M_param] sync: True
[12/18 20:01:17] fastreid INFO: [M_param] detail_mode: True
[12/18 20:01:17] fastreid INFO: [M_param] stop_gradient: True
[12/18 20:01:17] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/18 20:01:17] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/18 20:01:17] fastreid INFO: [M_param] main_zero_grad: True
[12/18 20:01:17] fastreid INFO: [M_param] norm_zero_grad: True
[12/18 20:01:17] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/18 20:01:17] fastreid INFO: [M_param] write_period_param: 1000
[12/18 20:01:17] fastreid INFO: [M_param] loss_combined: False
[12/18 20:01:17] fastreid INFO: [M_param] loss_weight: 1.0
[12/18 20:01:17] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/18 20:01:17] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/18 20:01:17] fastreid INFO: ------------------------------
[12/18 20:18:57] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 20:18:58] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 20:18:58] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 20:18:58] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 20:18:58] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 20:18:58] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 20:18:58] fastreid.data.datasets.bases INFO: => Loaded LiteData
[12/18 20:18:58] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 20:18:58] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 20:18:58] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 20:18:58] fastreid.data.datasets.bases INFO:   train    |     4 |       16 |         6
[12/18 20:18:58] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 20:18:58] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 20:19:00] fastreid INFO: ------------------------------
[12/18 20:19:00] fastreid INFO: Meta-learning paramters
[12/18 20:19:00] fastreid INFO: ------------------------------
[12/18 20:19:00] fastreid INFO: [M_param] synth_data: none
[12/18 20:19:00] fastreid INFO: [M_param] synth_method: real
[12/18 20:19:00] fastreid INFO: [M_param] num_domain: 6
[12/18 20:19:00] fastreid INFO: [M_param] whole: True
[12/18 20:19:00] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/18 20:19:00] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/18 20:19:00] fastreid INFO: [M_param] meta_all_params: False
[12/18 20:19:00] fastreid INFO: [M_param] iter_init_inner: 1
[12/18 20:19:00] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/18 20:19:00] fastreid INFO: [M_param] iter_init_outer: 1
[12/18 20:19:00] fastreid INFO: [M_param] update_ratio: 0.0
[12/18 20:19:00] fastreid INFO: [M_param] iters_per_epoch: 1
[12/18 20:19:00] fastreid INFO: [M_param] iter_mtrain: 1
[12/18 20:19:00] fastreid INFO: [M_param] shuffle_domain: True
[12/18 20:19:00] fastreid INFO: [M_param] use_second_order: False
[12/18 20:19:00] fastreid INFO: [M_param] num_mtrain: 3
[12/18 20:19:00] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/18 20:19:00] fastreid INFO: [M_param] allow_unused: False
[12/18 20:19:00] fastreid INFO: [M_param] zero_grad: True
[12/18 20:19:00] fastreid INFO: [M_param] type_running_stats_init: general
[12/18 20:19:00] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/18 20:19:00] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/18 20:19:00] fastreid INFO: [M_param] auto_grad_outside: True
[12/18 20:19:00] fastreid INFO: [M_param] inner_clamp: True
[12/18 20:19:00] fastreid INFO: [M_param] synth_grad: none
[12/18 20:19:00] fastreid INFO: [M_param] constant_grad: 0.01
[12/18 20:19:00] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/18 20:19:00] fastreid INFO: [M_param] print_grad: True
[12/18 20:19:00] fastreid INFO: [M_param] one_loss_for_iter: False
[12/18 20:19:00] fastreid INFO: [M_param] one_loss_order: forward
[12/18 20:19:00] fastreid INFO: [M_param] num_mtest: 3
[12/18 20:19:00] fastreid INFO: [M_param] sync: True
[12/18 20:19:00] fastreid INFO: [M_param] detail_mode: True
[12/18 20:19:00] fastreid INFO: [M_param] stop_gradient: True
[12/18 20:19:00] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/18 20:19:00] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/18 20:19:00] fastreid INFO: [M_param] main_zero_grad: True
[12/18 20:19:00] fastreid INFO: [M_param] norm_zero_grad: True
[12/18 20:19:00] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/18 20:19:00] fastreid INFO: [M_param] write_period_param: 1000
[12/18 20:19:00] fastreid INFO: [M_param] loss_combined: False
[12/18 20:19:00] fastreid INFO: [M_param] loss_weight: 1.0
[12/18 20:19:00] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/18 20:19:00] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/18 20:19:00] fastreid INFO: ------------------------------
[12/18 20:26:04] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 20:26:05] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 20:26:05] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 20:26:05] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 20:26:05] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 20:26:05] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 20:26:05] fastreid.data.datasets.bases INFO: => Loaded LiteData
[12/18 20:26:05] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 20:26:05] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 20:26:05] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 20:26:05] fastreid.data.datasets.bases INFO:   train    |     4 |       16 |         6
[12/18 20:26:05] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 20:26:05] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 20:26:08] fastreid INFO: ------------------------------
[12/18 20:26:08] fastreid INFO: Meta-learning paramters
[12/18 20:26:08] fastreid INFO: ------------------------------
[12/18 20:26:08] fastreid INFO: [M_param] synth_data: none
[12/18 20:26:08] fastreid INFO: [M_param] synth_method: real
[12/18 20:26:08] fastreid INFO: [M_param] num_domain: 6
[12/18 20:26:08] fastreid INFO: [M_param] whole: True
[12/18 20:26:08] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/18 20:26:08] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/18 20:26:08] fastreid INFO: [M_param] meta_all_params: False
[12/18 20:26:08] fastreid INFO: [M_param] iter_init_inner: 1
[12/18 20:26:08] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/18 20:26:08] fastreid INFO: [M_param] iter_init_outer: 1
[12/18 20:26:08] fastreid INFO: [M_param] update_ratio: 0.0
[12/18 20:26:08] fastreid INFO: [M_param] iters_per_epoch: 1
[12/18 20:26:08] fastreid INFO: [M_param] iter_mtrain: 1
[12/18 20:26:08] fastreid INFO: [M_param] shuffle_domain: True
[12/18 20:26:08] fastreid INFO: [M_param] use_second_order: False
[12/18 20:26:08] fastreid INFO: [M_param] num_mtrain: 3
[12/18 20:26:08] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/18 20:26:08] fastreid INFO: [M_param] allow_unused: False
[12/18 20:26:08] fastreid INFO: [M_param] zero_grad: True
[12/18 20:26:08] fastreid INFO: [M_param] type_running_stats_init: general
[12/18 20:26:08] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/18 20:26:08] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/18 20:26:08] fastreid INFO: [M_param] auto_grad_outside: True
[12/18 20:26:08] fastreid INFO: [M_param] inner_clamp: True
[12/18 20:26:08] fastreid INFO: [M_param] synth_grad: none
[12/18 20:26:08] fastreid INFO: [M_param] constant_grad: 0.01
[12/18 20:26:08] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/18 20:26:08] fastreid INFO: [M_param] print_grad: True
[12/18 20:26:08] fastreid INFO: [M_param] one_loss_for_iter: False
[12/18 20:26:08] fastreid INFO: [M_param] one_loss_order: forward
[12/18 20:26:08] fastreid INFO: [M_param] num_mtest: 3
[12/18 20:26:08] fastreid INFO: [M_param] sync: True
[12/18 20:26:08] fastreid INFO: [M_param] detail_mode: True
[12/18 20:26:08] fastreid INFO: [M_param] stop_gradient: True
[12/18 20:26:08] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/18 20:26:08] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/18 20:26:08] fastreid INFO: [M_param] main_zero_grad: True
[12/18 20:26:08] fastreid INFO: [M_param] norm_zero_grad: True
[12/18 20:26:08] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/18 20:26:08] fastreid INFO: [M_param] write_period_param: 1000
[12/18 20:26:08] fastreid INFO: [M_param] loss_combined: False
[12/18 20:26:08] fastreid INFO: [M_param] loss_weight: 1.0
[12/18 20:26:08] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/18 20:26:08] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/18 20:26:08] fastreid INFO: ------------------------------
[12/18 20:26:55] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 20:26:56] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 20:26:56] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 20:26:56] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 20:26:56] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 20:26:56] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 20:26:56] fastreid.data.datasets.bases INFO: => Loaded LiteData
[12/18 20:26:56] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 20:26:56] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 20:26:56] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 20:26:56] fastreid.data.datasets.bases INFO:   train    |     4 |       16 |         6
[12/18 20:26:56] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 20:26:56] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 20:26:58] fastreid INFO: ------------------------------
[12/18 20:26:58] fastreid INFO: Meta-learning paramters
[12/18 20:26:58] fastreid INFO: ------------------------------
[12/18 20:26:58] fastreid INFO: [M_param] synth_data: none
[12/18 20:26:58] fastreid INFO: [M_param] synth_method: real
[12/18 20:26:58] fastreid INFO: [M_param] num_domain: 6
[12/18 20:26:58] fastreid INFO: [M_param] whole: True
[12/18 20:26:58] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/18 20:26:58] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/18 20:26:58] fastreid INFO: [M_param] meta_all_params: False
[12/18 20:26:58] fastreid INFO: [M_param] iter_init_inner: 1
[12/18 20:26:58] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/18 20:26:58] fastreid INFO: [M_param] iter_init_outer: 1
[12/18 20:26:58] fastreid INFO: [M_param] update_ratio: 0.0
[12/18 20:26:58] fastreid INFO: [M_param] iters_per_epoch: 1
[12/18 20:26:58] fastreid INFO: [M_param] iter_mtrain: 1
[12/18 20:26:58] fastreid INFO: [M_param] shuffle_domain: True
[12/18 20:26:58] fastreid INFO: [M_param] use_second_order: False
[12/18 20:26:58] fastreid INFO: [M_param] num_mtrain: 3
[12/18 20:26:58] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/18 20:26:58] fastreid INFO: [M_param] allow_unused: False
[12/18 20:26:58] fastreid INFO: [M_param] zero_grad: True
[12/18 20:26:58] fastreid INFO: [M_param] type_running_stats_init: general
[12/18 20:26:58] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/18 20:26:58] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/18 20:26:58] fastreid INFO: [M_param] auto_grad_outside: True
[12/18 20:26:58] fastreid INFO: [M_param] inner_clamp: True
[12/18 20:26:58] fastreid INFO: [M_param] synth_grad: none
[12/18 20:26:58] fastreid INFO: [M_param] constant_grad: 0.01
[12/18 20:26:58] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/18 20:26:58] fastreid INFO: [M_param] print_grad: True
[12/18 20:26:58] fastreid INFO: [M_param] one_loss_for_iter: False
[12/18 20:26:58] fastreid INFO: [M_param] one_loss_order: forward
[12/18 20:26:58] fastreid INFO: [M_param] num_mtest: 3
[12/18 20:26:58] fastreid INFO: [M_param] sync: True
[12/18 20:26:58] fastreid INFO: [M_param] detail_mode: True
[12/18 20:26:58] fastreid INFO: [M_param] stop_gradient: True
[12/18 20:26:58] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/18 20:26:58] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/18 20:26:58] fastreid INFO: [M_param] main_zero_grad: True
[12/18 20:26:58] fastreid INFO: [M_param] norm_zero_grad: True
[12/18 20:26:58] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/18 20:26:58] fastreid INFO: [M_param] write_period_param: 1000
[12/18 20:26:58] fastreid INFO: [M_param] loss_combined: False
[12/18 20:26:58] fastreid INFO: [M_param] loss_weight: 1.0
[12/18 20:26:58] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/18 20:26:58] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/18 20:26:58] fastreid INFO: ------------------------------
[12/18 20:29:21] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 20:29:22] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 20:29:22] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 20:29:22] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 20:29:22] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 20:29:23] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 20:29:23] fastreid.data.datasets.bases INFO: => Loaded LiteData
[12/18 20:29:23] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 20:29:23] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 20:29:23] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 20:29:23] fastreid.data.datasets.bases INFO:   train    |     4 |       16 |         6
[12/18 20:29:23] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 20:29:23] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 20:29:25] fastreid INFO: ------------------------------
[12/18 20:29:25] fastreid INFO: Meta-learning paramters
[12/18 20:29:25] fastreid INFO: ------------------------------
[12/18 20:29:25] fastreid INFO: [M_param] synth_data: none
[12/18 20:29:25] fastreid INFO: [M_param] synth_method: real
[12/18 20:29:25] fastreid INFO: [M_param] num_domain: 6
[12/18 20:29:25] fastreid INFO: [M_param] whole: True
[12/18 20:29:25] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/18 20:29:25] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/18 20:29:25] fastreid INFO: [M_param] meta_all_params: False
[12/18 20:29:25] fastreid INFO: [M_param] iter_init_inner: 1
[12/18 20:29:25] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/18 20:29:25] fastreid INFO: [M_param] iter_init_outer: 1
[12/18 20:29:25] fastreid INFO: [M_param] update_ratio: 0.0
[12/18 20:29:25] fastreid INFO: [M_param] iters_per_epoch: 1
[12/18 20:29:25] fastreid INFO: [M_param] iter_mtrain: 1
[12/18 20:29:25] fastreid INFO: [M_param] shuffle_domain: True
[12/18 20:29:25] fastreid INFO: [M_param] use_second_order: False
[12/18 20:29:25] fastreid INFO: [M_param] num_mtrain: 3
[12/18 20:29:25] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/18 20:29:25] fastreid INFO: [M_param] allow_unused: False
[12/18 20:29:25] fastreid INFO: [M_param] zero_grad: True
[12/18 20:29:25] fastreid INFO: [M_param] type_running_stats_init: general
[12/18 20:29:25] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/18 20:29:25] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/18 20:29:25] fastreid INFO: [M_param] auto_grad_outside: True
[12/18 20:29:25] fastreid INFO: [M_param] inner_clamp: True
[12/18 20:29:25] fastreid INFO: [M_param] synth_grad: none
[12/18 20:29:25] fastreid INFO: [M_param] constant_grad: 0.01
[12/18 20:29:25] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/18 20:29:25] fastreid INFO: [M_param] print_grad: True
[12/18 20:29:25] fastreid INFO: [M_param] one_loss_for_iter: False
[12/18 20:29:25] fastreid INFO: [M_param] one_loss_order: forward
[12/18 20:29:25] fastreid INFO: [M_param] num_mtest: 3
[12/18 20:29:25] fastreid INFO: [M_param] sync: True
[12/18 20:29:25] fastreid INFO: [M_param] detail_mode: True
[12/18 20:29:25] fastreid INFO: [M_param] stop_gradient: True
[12/18 20:29:25] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/18 20:29:25] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/18 20:29:25] fastreid INFO: [M_param] main_zero_grad: True
[12/18 20:29:25] fastreid INFO: [M_param] norm_zero_grad: True
[12/18 20:29:25] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/18 20:29:25] fastreid INFO: [M_param] write_period_param: 1000
[12/18 20:29:25] fastreid INFO: [M_param] loss_combined: False
[12/18 20:29:25] fastreid INFO: [M_param] loss_weight: 1.0
[12/18 20:29:25] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/18 20:29:25] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/18 20:29:25] fastreid INFO: ------------------------------
[12/18 20:33:15] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 20:33:16] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 20:33:16] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 20:33:16] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 20:33:16] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 20:33:16] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 20:33:16] fastreid.data.datasets.bases INFO: => Loaded LiteData
[12/18 20:33:16] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 20:33:16] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 20:33:16] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 20:33:16] fastreid.data.datasets.bases INFO:   train    |     4 |       16 |         6
[12/18 20:33:16] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 20:33:16] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 20:33:18] fastreid INFO: ------------------------------
[12/18 20:33:18] fastreid INFO: Meta-learning paramters
[12/18 20:33:18] fastreid INFO: ------------------------------
[12/18 20:33:18] fastreid INFO: [M_param] synth_data: none
[12/18 20:33:18] fastreid INFO: [M_param] synth_method: real
[12/18 20:33:18] fastreid INFO: [M_param] num_domain: 6
[12/18 20:33:18] fastreid INFO: [M_param] whole: True
[12/18 20:33:18] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/18 20:33:18] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/18 20:33:18] fastreid INFO: [M_param] meta_all_params: False
[12/18 20:33:18] fastreid INFO: [M_param] iter_init_inner: 1
[12/18 20:33:18] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/18 20:33:18] fastreid INFO: [M_param] iter_init_outer: 1
[12/18 20:33:18] fastreid INFO: [M_param] update_ratio: 0.0
[12/18 20:33:18] fastreid INFO: [M_param] iters_per_epoch: 1
[12/18 20:33:18] fastreid INFO: [M_param] iter_mtrain: 1
[12/18 20:33:18] fastreid INFO: [M_param] shuffle_domain: True
[12/18 20:33:18] fastreid INFO: [M_param] use_second_order: False
[12/18 20:33:18] fastreid INFO: [M_param] num_mtrain: 3
[12/18 20:33:18] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/18 20:33:18] fastreid INFO: [M_param] allow_unused: False
[12/18 20:33:18] fastreid INFO: [M_param] zero_grad: True
[12/18 20:33:18] fastreid INFO: [M_param] type_running_stats_init: general
[12/18 20:33:18] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/18 20:33:18] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/18 20:33:18] fastreid INFO: [M_param] auto_grad_outside: True
[12/18 20:33:18] fastreid INFO: [M_param] inner_clamp: True
[12/18 20:33:18] fastreid INFO: [M_param] synth_grad: none
[12/18 20:33:18] fastreid INFO: [M_param] constant_grad: 0.01
[12/18 20:33:18] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/18 20:33:18] fastreid INFO: [M_param] print_grad: True
[12/18 20:33:18] fastreid INFO: [M_param] one_loss_for_iter: False
[12/18 20:33:18] fastreid INFO: [M_param] one_loss_order: forward
[12/18 20:33:18] fastreid INFO: [M_param] num_mtest: 3
[12/18 20:33:18] fastreid INFO: [M_param] sync: True
[12/18 20:33:18] fastreid INFO: [M_param] detail_mode: True
[12/18 20:33:18] fastreid INFO: [M_param] stop_gradient: True
[12/18 20:33:18] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/18 20:33:18] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/18 20:33:18] fastreid INFO: [M_param] main_zero_grad: True
[12/18 20:33:18] fastreid INFO: [M_param] norm_zero_grad: True
[12/18 20:33:18] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/18 20:33:18] fastreid INFO: [M_param] write_period_param: 1000
[12/18 20:33:18] fastreid INFO: [M_param] loss_combined: False
[12/18 20:33:18] fastreid INFO: [M_param] loss_weight: 1.0
[12/18 20:33:18] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/18 20:33:18] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/18 20:33:18] fastreid INFO: ------------------------------
[12/18 20:47:13] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 20:47:14] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 20:47:14] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 20:47:14] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 20:47:14] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 20:47:14] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 20:47:14] fastreid.data.datasets.bases INFO: => Loaded LiteData
[12/18 20:47:14] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 20:47:14] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 20:47:14] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 20:47:14] fastreid.data.datasets.bases INFO:   train    |     4 |       16 |         6
[12/18 20:47:14] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 20:47:14] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 20:47:16] fastreid INFO: ------------------------------
[12/18 20:47:16] fastreid INFO: Meta-learning paramters
[12/18 20:47:16] fastreid INFO: ------------------------------
[12/18 20:47:16] fastreid INFO: [M_param] synth_data: none
[12/18 20:47:16] fastreid INFO: [M_param] synth_method: real
[12/18 20:47:16] fastreid INFO: [M_param] num_domain: 6
[12/18 20:47:16] fastreid INFO: [M_param] whole: True
[12/18 20:47:16] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/18 20:47:16] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/18 20:47:16] fastreid INFO: [M_param] meta_all_params: False
[12/18 20:47:16] fastreid INFO: [M_param] iter_init_inner: 1
[12/18 20:47:16] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/18 20:47:16] fastreid INFO: [M_param] iter_init_outer: 1
[12/18 20:47:16] fastreid INFO: [M_param] update_ratio: 0.0
[12/18 20:47:16] fastreid INFO: [M_param] iters_per_epoch: 1
[12/18 20:47:16] fastreid INFO: [M_param] iter_mtrain: 1
[12/18 20:47:16] fastreid INFO: [M_param] shuffle_domain: True
[12/18 20:47:16] fastreid INFO: [M_param] use_second_order: False
[12/18 20:47:16] fastreid INFO: [M_param] num_mtrain: 3
[12/18 20:47:16] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/18 20:47:16] fastreid INFO: [M_param] allow_unused: False
[12/18 20:47:16] fastreid INFO: [M_param] zero_grad: True
[12/18 20:47:16] fastreid INFO: [M_param] type_running_stats_init: general
[12/18 20:47:16] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/18 20:47:16] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/18 20:47:16] fastreid INFO: [M_param] auto_grad_outside: True
[12/18 20:47:16] fastreid INFO: [M_param] inner_clamp: True
[12/18 20:47:16] fastreid INFO: [M_param] synth_grad: none
[12/18 20:47:16] fastreid INFO: [M_param] constant_grad: 0.01
[12/18 20:47:16] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/18 20:47:16] fastreid INFO: [M_param] print_grad: True
[12/18 20:47:16] fastreid INFO: [M_param] one_loss_for_iter: False
[12/18 20:47:16] fastreid INFO: [M_param] one_loss_order: forward
[12/18 20:47:16] fastreid INFO: [M_param] num_mtest: 3
[12/18 20:47:16] fastreid INFO: [M_param] sync: True
[12/18 20:47:16] fastreid INFO: [M_param] detail_mode: True
[12/18 20:47:16] fastreid INFO: [M_param] stop_gradient: True
[12/18 20:47:16] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/18 20:47:16] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/18 20:47:16] fastreid INFO: [M_param] main_zero_grad: True
[12/18 20:47:16] fastreid INFO: [M_param] norm_zero_grad: True
[12/18 20:47:16] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/18 20:47:16] fastreid INFO: [M_param] write_period_param: 1000
[12/18 20:47:16] fastreid INFO: [M_param] loss_combined: False
[12/18 20:47:16] fastreid INFO: [M_param] loss_weight: 1.0
[12/18 20:47:16] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/18 20:47:16] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/18 20:47:16] fastreid INFO: ------------------------------
[12/18 20:48:15] fastreid INFO: Rank of current process: 0. World size: 1
[12/18 20:48:16] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/18 20:48:16] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/18 20:48:16] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/18 20:48:16] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/18 20:48:17] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/18 20:48:17] fastreid.data.datasets.bases INFO: => Loaded LiteData
[12/18 20:48:17] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 20:48:17] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/18 20:48:17] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 20:48:17] fastreid.data.datasets.bases INFO:   train    |     4 |       16 |         6
[12/18 20:48:17] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/18 20:48:17] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/18 20:48:19] fastreid INFO: ------------------------------
[12/18 20:48:19] fastreid INFO: Meta-learning paramters
[12/18 20:48:19] fastreid INFO: ------------------------------
[12/18 20:48:19] fastreid INFO: [M_param] synth_data: none
[12/18 20:48:19] fastreid INFO: [M_param] synth_method: real
[12/18 20:48:19] fastreid INFO: [M_param] num_domain: 6
[12/18 20:48:19] fastreid INFO: [M_param] whole: True
[12/18 20:48:19] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/18 20:48:19] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/18 20:48:19] fastreid INFO: [M_param] meta_all_params: False
[12/18 20:48:19] fastreid INFO: [M_param] iter_init_inner: 1
[12/18 20:48:19] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/18 20:48:19] fastreid INFO: [M_param] iter_init_outer: 1
[12/18 20:48:19] fastreid INFO: [M_param] update_ratio: 0.0
[12/18 20:48:19] fastreid INFO: [M_param] iters_per_epoch: 1
[12/18 20:48:19] fastreid INFO: [M_param] iter_mtrain: 1
[12/18 20:48:19] fastreid INFO: [M_param] shuffle_domain: True
[12/18 20:48:19] fastreid INFO: [M_param] use_second_order: False
[12/18 20:48:19] fastreid INFO: [M_param] num_mtrain: 3
[12/18 20:48:19] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/18 20:48:19] fastreid INFO: [M_param] allow_unused: False
[12/18 20:48:19] fastreid INFO: [M_param] zero_grad: True
[12/18 20:48:19] fastreid INFO: [M_param] type_running_stats_init: general
[12/18 20:48:19] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/18 20:48:19] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/18 20:48:19] fastreid INFO: [M_param] auto_grad_outside: True
[12/18 20:48:19] fastreid INFO: [M_param] inner_clamp: True
[12/18 20:48:19] fastreid INFO: [M_param] synth_grad: none
[12/18 20:48:19] fastreid INFO: [M_param] constant_grad: 0.01
[12/18 20:48:19] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/18 20:48:19] fastreid INFO: [M_param] print_grad: True
[12/18 20:48:19] fastreid INFO: [M_param] one_loss_for_iter: False
[12/18 20:48:19] fastreid INFO: [M_param] one_loss_order: forward
[12/18 20:48:19] fastreid INFO: [M_param] num_mtest: 3
[12/18 20:48:19] fastreid INFO: [M_param] sync: True
[12/18 20:48:19] fastreid INFO: [M_param] detail_mode: True
[12/18 20:48:19] fastreid INFO: [M_param] stop_gradient: True
[12/18 20:48:19] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/18 20:48:19] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/18 20:48:19] fastreid INFO: [M_param] main_zero_grad: True
[12/18 20:48:19] fastreid INFO: [M_param] norm_zero_grad: True
[12/18 20:48:19] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/18 20:48:19] fastreid INFO: [M_param] write_period_param: 1000
[12/18 20:48:19] fastreid INFO: [M_param] loss_combined: False
[12/18 20:48:19] fastreid INFO: [M_param] loss_weight: 1.0
[12/18 20:48:19] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/18 20:48:19] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/18 20:48:19] fastreid INFO: ------------------------------
[12/24 23:15:32] fastreid INFO: Rank of current process: 0. World size: 1
[12/24 23:15:33] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/24 23:15:33] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/24 23:15:33] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/24 23:15:33] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/24 23:15:33] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/24 23:15:33] fastreid.data.datasets.bases INFO: => Loaded Market1501
[12/24 23:15:33] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/24 23:15:33] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/24 23:15:33] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/24 23:15:33] fastreid.data.datasets.bases INFO:   train    |   751 |    12936 |         6
[12/24 23:15:33] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/24 23:15:33] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/24 23:15:35] fastreid INFO: ------------------------------
[12/24 23:15:35] fastreid INFO: Meta-learning paramters
[12/24 23:15:35] fastreid INFO: ------------------------------
[12/24 23:15:35] fastreid INFO: [M_param] synth_data: none
[12/24 23:15:35] fastreid INFO: [M_param] synth_method: real
[12/24 23:15:35] fastreid INFO: [M_param] num_domain: 6
[12/24 23:15:35] fastreid INFO: [M_param] whole: True
[12/24 23:15:35] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/24 23:15:35] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/24 23:15:35] fastreid INFO: [M_param] meta_all_params: False
[12/24 23:15:35] fastreid INFO: [M_param] iter_init_inner: 1
[12/24 23:15:35] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/24 23:15:35] fastreid INFO: [M_param] iter_init_outer: 1
[12/24 23:15:35] fastreid INFO: [M_param] update_ratio: 0.0
[12/24 23:15:35] fastreid INFO: [M_param] iters_per_epoch: 877
[12/24 23:15:35] fastreid INFO: [M_param] iter_mtrain: 1
[12/24 23:15:35] fastreid INFO: [M_param] shuffle_domain: True
[12/24 23:15:35] fastreid INFO: [M_param] use_second_order: False
[12/24 23:15:35] fastreid INFO: [M_param] num_mtrain: 3
[12/24 23:15:35] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/24 23:15:35] fastreid INFO: [M_param] allow_unused: False
[12/24 23:15:35] fastreid INFO: [M_param] zero_grad: True
[12/24 23:15:35] fastreid INFO: [M_param] type_running_stats_init: general
[12/24 23:15:35] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/24 23:15:35] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/24 23:15:35] fastreid INFO: [M_param] auto_grad_outside: True
[12/24 23:15:35] fastreid INFO: [M_param] inner_clamp: True
[12/24 23:15:35] fastreid INFO: [M_param] synth_grad: none
[12/24 23:15:35] fastreid INFO: [M_param] constant_grad: 0.01
[12/24 23:15:35] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/24 23:15:35] fastreid INFO: [M_param] print_grad: True
[12/24 23:15:35] fastreid INFO: [M_param] one_loss_for_iter: False
[12/24 23:15:35] fastreid INFO: [M_param] one_loss_order: forward
[12/24 23:15:35] fastreid INFO: [M_param] num_mtest: 3
[12/24 23:15:35] fastreid INFO: [M_param] sync: True
[12/24 23:15:35] fastreid INFO: [M_param] detail_mode: True
[12/24 23:15:35] fastreid INFO: [M_param] stop_gradient: True
[12/24 23:15:35] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/24 23:15:35] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/24 23:15:35] fastreid INFO: [M_param] main_zero_grad: True
[12/24 23:15:35] fastreid INFO: [M_param] norm_zero_grad: True
[12/24 23:15:35] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/24 23:15:35] fastreid INFO: [M_param] write_period_param: 1000
[12/24 23:15:35] fastreid INFO: [M_param] loss_combined: False
[12/24 23:15:35] fastreid INFO: [M_param] loss_weight: 1.0
[12/24 23:15:35] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/24 23:15:35] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/24 23:15:35] fastreid INFO: ------------------------------
[12/24 23:15:35] fastreid.utils.checkpoint INFO: Loading checkpoint from ./refs/logs/Sample/M-resnet\model_0015199.pth
[12/24 23:15:35] fastreid.utils.checkpoint INFO: Loading optimizer_main from ./refs/logs/Sample/M-resnet\model_0015199.pth
[12/24 23:15:35] fastreid.utils.checkpoint INFO: Loading scheduler_main from ./refs/logs/Sample/M-resnet\model_0015199.pth
[12/24 23:15:35] fastreid.utils.checkpoint INFO: Loading optimizer_norm from ./refs/logs/Sample/M-resnet\model_0015199.pth
[12/24 23:15:35] fastreid.utils.checkpoint INFO: Loading scheduler_norm from ./refs/logs/Sample/M-resnet\model_0015199.pth
[12/24 23:16:06] fastreid INFO: Rank of current process: 0. World size: 1
[12/24 23:16:07] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/24 23:16:07] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/24 23:16:07] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/24 23:16:07] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/24 23:16:07] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/24 23:16:07] fastreid.data.datasets.bases INFO: => Loaded Market1501
[12/24 23:16:07] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/24 23:16:07] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/24 23:16:07] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/24 23:16:07] fastreid.data.datasets.bases INFO:   train    |   751 |    12936 |         6
[12/24 23:16:07] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/24 23:16:07] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/24 23:16:09] fastreid INFO: ------------------------------
[12/24 23:16:09] fastreid INFO: Meta-learning paramters
[12/24 23:16:09] fastreid INFO: ------------------------------
[12/24 23:16:09] fastreid INFO: [M_param] synth_data: none
[12/24 23:16:09] fastreid INFO: [M_param] synth_method: real
[12/24 23:16:09] fastreid INFO: [M_param] num_domain: 6
[12/24 23:16:09] fastreid INFO: [M_param] whole: True
[12/24 23:16:09] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/24 23:16:09] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/24 23:16:09] fastreid INFO: [M_param] meta_all_params: False
[12/24 23:16:09] fastreid INFO: [M_param] iter_init_inner: 1
[12/24 23:16:09] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/24 23:16:09] fastreid INFO: [M_param] iter_init_outer: 1
[12/24 23:16:09] fastreid INFO: [M_param] update_ratio: 0.0
[12/24 23:16:09] fastreid INFO: [M_param] iters_per_epoch: 877
[12/24 23:16:09] fastreid INFO: [M_param] iter_mtrain: 1
[12/24 23:16:09] fastreid INFO: [M_param] shuffle_domain: True
[12/24 23:16:09] fastreid INFO: [M_param] use_second_order: False
[12/24 23:16:09] fastreid INFO: [M_param] num_mtrain: 3
[12/24 23:16:09] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/24 23:16:09] fastreid INFO: [M_param] allow_unused: False
[12/24 23:16:09] fastreid INFO: [M_param] zero_grad: True
[12/24 23:16:09] fastreid INFO: [M_param] type_running_stats_init: general
[12/24 23:16:09] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/24 23:16:09] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/24 23:16:09] fastreid INFO: [M_param] auto_grad_outside: True
[12/24 23:16:09] fastreid INFO: [M_param] inner_clamp: True
[12/24 23:16:09] fastreid INFO: [M_param] synth_grad: none
[12/24 23:16:09] fastreid INFO: [M_param] constant_grad: 0.01
[12/24 23:16:09] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/24 23:16:09] fastreid INFO: [M_param] print_grad: True
[12/24 23:16:09] fastreid INFO: [M_param] one_loss_for_iter: False
[12/24 23:16:09] fastreid INFO: [M_param] one_loss_order: forward
[12/24 23:16:09] fastreid INFO: [M_param] num_mtest: 3
[12/24 23:16:09] fastreid INFO: [M_param] sync: True
[12/24 23:16:09] fastreid INFO: [M_param] detail_mode: True
[12/24 23:16:09] fastreid INFO: [M_param] stop_gradient: True
[12/24 23:16:09] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/24 23:16:09] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/24 23:16:09] fastreid INFO: [M_param] main_zero_grad: True
[12/24 23:16:09] fastreid INFO: [M_param] norm_zero_grad: True
[12/24 23:16:09] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/24 23:16:09] fastreid INFO: [M_param] write_period_param: 1000
[12/24 23:16:09] fastreid INFO: [M_param] loss_combined: False
[12/24 23:16:09] fastreid INFO: [M_param] loss_weight: 1.0
[12/24 23:16:09] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/24 23:16:09] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/24 23:16:09] fastreid INFO: ------------------------------
[12/24 23:16:09] fastreid.utils.checkpoint INFO: Loading checkpoint from ./refs/logs/Sample/M-resnet\model_0015199.pth
[12/24 23:16:09] fastreid.utils.checkpoint INFO: Loading optimizer_main from ./refs/logs/Sample/M-resnet\model_0015199.pth
[12/24 23:16:09] fastreid.utils.checkpoint INFO: Loading scheduler_main from ./refs/logs/Sample/M-resnet\model_0015199.pth
[12/24 23:16:09] fastreid.utils.checkpoint INFO: Loading optimizer_norm from ./refs/logs/Sample/M-resnet\model_0015199.pth
[12/24 23:16:09] fastreid.utils.checkpoint INFO: Loading scheduler_norm from ./refs/logs/Sample/M-resnet\model_0015199.pth
[12/24 23:16:36] fastreid INFO: Rank of current process: 0. World size: 1
[12/24 23:16:37] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/24 23:16:37] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/24 23:16:37] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/24 23:16:37] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/24 23:16:37] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/24 23:16:37] fastreid.data.datasets.bases INFO: => Loaded Market1501
[12/24 23:16:37] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/24 23:16:37] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/24 23:16:37] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/24 23:16:37] fastreid.data.datasets.bases INFO:   train    |   751 |    12936 |         6
[12/24 23:16:37] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/24 23:16:37] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/24 23:16:39] fastreid INFO: ------------------------------
[12/24 23:16:39] fastreid INFO: Meta-learning paramters
[12/24 23:16:39] fastreid INFO: ------------------------------
[12/24 23:16:39] fastreid INFO: [M_param] synth_data: none
[12/24 23:16:39] fastreid INFO: [M_param] synth_method: real
[12/24 23:16:39] fastreid INFO: [M_param] num_domain: 6
[12/24 23:16:39] fastreid INFO: [M_param] whole: True
[12/24 23:16:39] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/24 23:16:39] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/24 23:16:39] fastreid INFO: [M_param] meta_all_params: False
[12/24 23:16:39] fastreid INFO: [M_param] iter_init_inner: 1
[12/24 23:16:39] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/24 23:16:39] fastreid INFO: [M_param] iter_init_outer: 1
[12/24 23:16:39] fastreid INFO: [M_param] update_ratio: 0.0
[12/24 23:16:39] fastreid INFO: [M_param] iters_per_epoch: 877
[12/24 23:16:39] fastreid INFO: [M_param] iter_mtrain: 1
[12/24 23:16:39] fastreid INFO: [M_param] shuffle_domain: True
[12/24 23:16:39] fastreid INFO: [M_param] use_second_order: False
[12/24 23:16:39] fastreid INFO: [M_param] num_mtrain: 3
[12/24 23:16:39] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/24 23:16:39] fastreid INFO: [M_param] allow_unused: False
[12/24 23:16:39] fastreid INFO: [M_param] zero_grad: True
[12/24 23:16:39] fastreid INFO: [M_param] type_running_stats_init: general
[12/24 23:16:39] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/24 23:16:39] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/24 23:16:39] fastreid INFO: [M_param] auto_grad_outside: True
[12/24 23:16:39] fastreid INFO: [M_param] inner_clamp: True
[12/24 23:16:39] fastreid INFO: [M_param] synth_grad: none
[12/24 23:16:39] fastreid INFO: [M_param] constant_grad: 0.01
[12/24 23:16:39] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/24 23:16:39] fastreid INFO: [M_param] print_grad: True
[12/24 23:16:39] fastreid INFO: [M_param] one_loss_for_iter: False
[12/24 23:16:39] fastreid INFO: [M_param] one_loss_order: forward
[12/24 23:16:39] fastreid INFO: [M_param] num_mtest: 3
[12/24 23:16:39] fastreid INFO: [M_param] sync: True
[12/24 23:16:39] fastreid INFO: [M_param] detail_mode: True
[12/24 23:16:39] fastreid INFO: [M_param] stop_gradient: True
[12/24 23:16:39] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/24 23:16:39] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/24 23:16:39] fastreid INFO: [M_param] main_zero_grad: True
[12/24 23:16:39] fastreid INFO: [M_param] norm_zero_grad: True
[12/24 23:16:39] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/24 23:16:39] fastreid INFO: [M_param] write_period_param: 1000
[12/24 23:16:39] fastreid INFO: [M_param] loss_combined: False
[12/24 23:16:39] fastreid INFO: [M_param] loss_weight: 1.0
[12/24 23:16:39] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/24 23:16:39] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/24 23:16:39] fastreid INFO: ------------------------------
[12/24 23:16:39] fastreid.utils.checkpoint INFO: Loading checkpoint from ./refs/logs/Sample/M-resnet\model_0015199.pth
[12/24 23:16:39] fastreid.utils.checkpoint INFO: Loading optimizer_main from ./refs/logs/Sample/M-resnet\model_0015199.pth
[12/24 23:16:39] fastreid.utils.checkpoint INFO: Loading scheduler_main from ./refs/logs/Sample/M-resnet\model_0015199.pth
[12/24 23:16:39] fastreid.utils.checkpoint INFO: Loading optimizer_norm from ./refs/logs/Sample/M-resnet\model_0015199.pth
[12/24 23:16:39] fastreid.utils.checkpoint INFO: Loading scheduler_norm from ./refs/logs/Sample/M-resnet\model_0015199.pth
[12/24 23:17:53] fastreid INFO: Rank of current process: 0. World size: 1
[12/24 23:17:53] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/24 23:17:53] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/24 23:17:53] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/24 23:17:53] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/24 23:17:53] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/24 23:17:54] fastreid.data.datasets.bases INFO: => Loaded Market1501
[12/24 23:17:54] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/24 23:17:54] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/24 23:17:54] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/24 23:17:54] fastreid.data.datasets.bases INFO:   train    |   751 |    12936 |         6
[12/24 23:17:54] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/24 23:17:54] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/24 23:17:55] fastreid INFO: ------------------------------
[12/24 23:17:55] fastreid INFO: Meta-learning paramters
[12/24 23:17:55] fastreid INFO: ------------------------------
[12/24 23:17:55] fastreid INFO: [M_param] synth_data: none
[12/24 23:17:55] fastreid INFO: [M_param] synth_method: real
[12/24 23:17:55] fastreid INFO: [M_param] num_domain: 6
[12/24 23:17:55] fastreid INFO: [M_param] whole: True
[12/24 23:17:55] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/24 23:17:55] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/24 23:17:55] fastreid INFO: [M_param] meta_all_params: False
[12/24 23:17:55] fastreid INFO: [M_param] iter_init_inner: 1
[12/24 23:17:55] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/24 23:17:55] fastreid INFO: [M_param] iter_init_outer: 1
[12/24 23:17:55] fastreid INFO: [M_param] update_ratio: 0.0
[12/24 23:17:55] fastreid INFO: [M_param] iters_per_epoch: 877
[12/24 23:17:55] fastreid INFO: [M_param] iter_mtrain: 1
[12/24 23:17:55] fastreid INFO: [M_param] shuffle_domain: True
[12/24 23:17:55] fastreid INFO: [M_param] use_second_order: False
[12/24 23:17:55] fastreid INFO: [M_param] num_mtrain: 3
[12/24 23:17:55] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/24 23:17:55] fastreid INFO: [M_param] allow_unused: False
[12/24 23:17:55] fastreid INFO: [M_param] zero_grad: True
[12/24 23:17:55] fastreid INFO: [M_param] type_running_stats_init: general
[12/24 23:17:55] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/24 23:17:55] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/24 23:17:55] fastreid INFO: [M_param] auto_grad_outside: True
[12/24 23:17:55] fastreid INFO: [M_param] inner_clamp: True
[12/24 23:17:55] fastreid INFO: [M_param] synth_grad: none
[12/24 23:17:55] fastreid INFO: [M_param] constant_grad: 0.01
[12/24 23:17:55] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/24 23:17:55] fastreid INFO: [M_param] print_grad: True
[12/24 23:17:55] fastreid INFO: [M_param] one_loss_for_iter: False
[12/24 23:17:55] fastreid INFO: [M_param] one_loss_order: forward
[12/24 23:17:55] fastreid INFO: [M_param] num_mtest: 3
[12/24 23:17:55] fastreid INFO: [M_param] sync: True
[12/24 23:17:55] fastreid INFO: [M_param] detail_mode: True
[12/24 23:17:55] fastreid INFO: [M_param] stop_gradient: True
[12/24 23:17:55] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/24 23:17:55] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/24 23:17:55] fastreid INFO: [M_param] main_zero_grad: True
[12/24 23:17:55] fastreid INFO: [M_param] norm_zero_grad: True
[12/24 23:17:55] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/24 23:17:55] fastreid INFO: [M_param] write_period_param: 1000
[12/24 23:17:55] fastreid INFO: [M_param] loss_combined: False
[12/24 23:17:55] fastreid INFO: [M_param] loss_weight: 1.0
[12/24 23:17:55] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/24 23:17:55] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/24 23:17:55] fastreid INFO: ------------------------------
[12/24 23:17:55] fastreid.utils.checkpoint INFO: Loading checkpoint from ./refs/logs/Sample/M-resnet\model_0015199.pth
[12/24 23:17:56] fastreid.utils.checkpoint INFO: Loading optimizer_main from ./refs/logs/Sample/M-resnet\model_0015199.pth
[12/24 23:17:56] fastreid.utils.checkpoint INFO: Loading scheduler_main from ./refs/logs/Sample/M-resnet\model_0015199.pth
[12/24 23:17:56] fastreid.utils.checkpoint INFO: Loading optimizer_norm from ./refs/logs/Sample/M-resnet\model_0015199.pth
[12/24 23:17:56] fastreid.utils.checkpoint INFO: Loading scheduler_norm from ./refs/logs/Sample/M-resnet\model_0015199.pth
[12/24 23:19:09] fastreid INFO: Rank of current process: 0. World size: 1
[12/24 23:19:09] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/24 23:19:09] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/24 23:19:09] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/24 23:19:09] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/24 23:19:10] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/24 23:19:10] fastreid.data.datasets.bases INFO: => Loaded Market1501
[12/24 23:19:10] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/24 23:19:10] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/24 23:19:10] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/24 23:19:10] fastreid.data.datasets.bases INFO:   train    |   751 |    12936 |         6
[12/24 23:19:10] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/24 23:19:10] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/24 23:19:46] fastreid INFO: Rank of current process: 0. World size: 1
[12/24 23:19:46] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/24 23:19:46] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/24 23:19:46] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/24 23:19:46] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/24 23:19:46] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/24 23:19:47] fastreid.data.datasets.bases INFO: => Loaded Market1501
[12/24 23:19:47] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/24 23:19:47] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/24 23:19:47] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/24 23:19:47] fastreid.data.datasets.bases INFO:   train    |   751 |    12936 |         6
[12/24 23:19:47] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/24 23:19:47] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/24 23:19:49] fastreid INFO: ------------------------------
[12/24 23:19:49] fastreid INFO: Meta-learning paramters
[12/24 23:19:49] fastreid INFO: ------------------------------
[12/24 23:19:49] fastreid INFO: [M_param] synth_data: none
[12/24 23:19:49] fastreid INFO: [M_param] synth_method: real
[12/24 23:19:49] fastreid INFO: [M_param] num_domain: 6
[12/24 23:19:49] fastreid INFO: [M_param] whole: True
[12/24 23:19:49] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/24 23:19:49] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/24 23:19:49] fastreid INFO: [M_param] meta_all_params: False
[12/24 23:19:49] fastreid INFO: [M_param] iter_init_inner: 1
[12/24 23:19:49] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/24 23:19:49] fastreid INFO: [M_param] iter_init_outer: 1
[12/24 23:19:49] fastreid INFO: [M_param] update_ratio: 0.0
[12/24 23:19:49] fastreid INFO: [M_param] iters_per_epoch: 877
[12/24 23:19:49] fastreid INFO: [M_param] iter_mtrain: 1
[12/24 23:19:49] fastreid INFO: [M_param] shuffle_domain: True
[12/24 23:19:49] fastreid INFO: [M_param] use_second_order: False
[12/24 23:19:49] fastreid INFO: [M_param] num_mtrain: 3
[12/24 23:19:49] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/24 23:19:49] fastreid INFO: [M_param] allow_unused: False
[12/24 23:19:49] fastreid INFO: [M_param] zero_grad: True
[12/24 23:19:49] fastreid INFO: [M_param] type_running_stats_init: general
[12/24 23:19:49] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/24 23:19:49] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/24 23:19:49] fastreid INFO: [M_param] auto_grad_outside: True
[12/24 23:19:49] fastreid INFO: [M_param] inner_clamp: True
[12/24 23:19:49] fastreid INFO: [M_param] synth_grad: none
[12/24 23:19:49] fastreid INFO: [M_param] constant_grad: 0.01
[12/24 23:19:49] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/24 23:19:49] fastreid INFO: [M_param] print_grad: True
[12/24 23:19:49] fastreid INFO: [M_param] one_loss_for_iter: False
[12/24 23:19:49] fastreid INFO: [M_param] one_loss_order: forward
[12/24 23:19:49] fastreid INFO: [M_param] num_mtest: 3
[12/24 23:19:49] fastreid INFO: [M_param] sync: True
[12/24 23:19:49] fastreid INFO: [M_param] detail_mode: True
[12/24 23:19:49] fastreid INFO: [M_param] stop_gradient: True
[12/24 23:19:49] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/24 23:19:49] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/24 23:19:49] fastreid INFO: [M_param] main_zero_grad: True
[12/24 23:19:49] fastreid INFO: [M_param] norm_zero_grad: True
[12/24 23:19:49] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/24 23:19:49] fastreid INFO: [M_param] write_period_param: 1000
[12/24 23:19:49] fastreid INFO: [M_param] loss_combined: False
[12/24 23:19:49] fastreid INFO: [M_param] loss_weight: 1.0
[12/24 23:19:49] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/24 23:19:49] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/24 23:19:49] fastreid INFO: ------------------------------
[12/24 23:19:49] fastreid.utils.checkpoint INFO: Loading checkpoint from ./refs/logs/Sample/M-resnet\model_0015199.pth
[12/24 23:19:49] fastreid.utils.checkpoint INFO: Loading optimizer_main from ./refs/logs/Sample/M-resnet\model_0015199.pth
[12/24 23:19:49] fastreid.utils.checkpoint INFO: Loading scheduler_main from ./refs/logs/Sample/M-resnet\model_0015199.pth
[12/24 23:19:49] fastreid.utils.checkpoint INFO: Loading optimizer_norm from ./refs/logs/Sample/M-resnet\model_0015199.pth
[12/24 23:19:49] fastreid.utils.checkpoint INFO: Loading scheduler_norm from ./refs/logs/Sample/M-resnet\model_0015199.pth
[12/24 23:20:17] fastreid INFO: Rank of current process: 0. World size: 1
[12/24 23:20:17] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/24 23:20:17] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/24 23:20:17] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/24 23:20:17] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/24 23:20:17] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/24 23:20:18] fastreid.data.datasets.bases INFO: => Loaded Market1501
[12/24 23:20:18] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/24 23:20:18] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/24 23:20:18] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/24 23:20:18] fastreid.data.datasets.bases INFO:   train    |   751 |    12936 |         6
[12/24 23:20:18] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/24 23:20:18] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/24 23:20:20] fastreid INFO: ------------------------------
[12/24 23:20:20] fastreid INFO: Meta-learning paramters
[12/24 23:20:20] fastreid INFO: ------------------------------
[12/24 23:20:20] fastreid INFO: [M_param] synth_data: none
[12/24 23:20:20] fastreid INFO: [M_param] synth_method: real
[12/24 23:20:20] fastreid INFO: [M_param] num_domain: 6
[12/24 23:20:20] fastreid INFO: [M_param] whole: True
[12/24 23:20:20] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/24 23:20:20] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/24 23:20:20] fastreid INFO: [M_param] meta_all_params: False
[12/24 23:20:20] fastreid INFO: [M_param] iter_init_inner: 1
[12/24 23:20:20] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/24 23:20:20] fastreid INFO: [M_param] iter_init_outer: 1
[12/24 23:20:20] fastreid INFO: [M_param] update_ratio: 0.0
[12/24 23:20:20] fastreid INFO: [M_param] iters_per_epoch: 877
[12/24 23:20:20] fastreid INFO: [M_param] iter_mtrain: 1
[12/24 23:20:20] fastreid INFO: [M_param] shuffle_domain: True
[12/24 23:20:20] fastreid INFO: [M_param] use_second_order: False
[12/24 23:20:20] fastreid INFO: [M_param] num_mtrain: 3
[12/24 23:20:20] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/24 23:20:20] fastreid INFO: [M_param] allow_unused: False
[12/24 23:20:20] fastreid INFO: [M_param] zero_grad: True
[12/24 23:20:20] fastreid INFO: [M_param] type_running_stats_init: general
[12/24 23:20:20] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/24 23:20:20] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/24 23:20:20] fastreid INFO: [M_param] auto_grad_outside: True
[12/24 23:20:20] fastreid INFO: [M_param] inner_clamp: True
[12/24 23:20:20] fastreid INFO: [M_param] synth_grad: none
[12/24 23:20:20] fastreid INFO: [M_param] constant_grad: 0.01
[12/24 23:20:20] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/24 23:20:20] fastreid INFO: [M_param] print_grad: True
[12/24 23:20:20] fastreid INFO: [M_param] one_loss_for_iter: False
[12/24 23:20:20] fastreid INFO: [M_param] one_loss_order: forward
[12/24 23:20:20] fastreid INFO: [M_param] num_mtest: 3
[12/24 23:20:20] fastreid INFO: [M_param] sync: True
[12/24 23:20:20] fastreid INFO: [M_param] detail_mode: True
[12/24 23:20:20] fastreid INFO: [M_param] stop_gradient: True
[12/24 23:20:20] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/24 23:20:20] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/24 23:20:20] fastreid INFO: [M_param] main_zero_grad: True
[12/24 23:20:20] fastreid INFO: [M_param] norm_zero_grad: True
[12/24 23:20:20] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/24 23:20:20] fastreid INFO: [M_param] write_period_param: 1000
[12/24 23:20:20] fastreid INFO: [M_param] loss_combined: False
[12/24 23:20:20] fastreid INFO: [M_param] loss_weight: 1.0
[12/24 23:20:20] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/24 23:20:20] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/24 23:20:20] fastreid INFO: ------------------------------
[12/24 23:20:20] fastreid.utils.checkpoint INFO: Loading checkpoint from ./refs/logs/Sample/M-resnet\model_0015199.pth
[12/24 23:20:20] fastreid.utils.checkpoint INFO: Loading optimizer_main from ./refs/logs/Sample/M-resnet\model_0015199.pth
[12/24 23:20:20] fastreid.utils.checkpoint INFO: Loading scheduler_main from ./refs/logs/Sample/M-resnet\model_0015199.pth
[12/24 23:20:20] fastreid.utils.checkpoint INFO: Loading optimizer_norm from ./refs/logs/Sample/M-resnet\model_0015199.pth
[12/24 23:20:20] fastreid.utils.checkpoint INFO: Loading scheduler_norm from ./refs/logs/Sample/M-resnet\model_0015199.pth
[12/24 23:20:49] fastreid INFO: Rank of current process: 0. World size: 1
[12/24 23:20:49] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/24 23:20:49] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/24 23:20:49] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/24 23:20:49] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/24 23:20:49] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/24 23:20:50] fastreid.data.datasets.bases INFO: => Loaded Market1501
[12/24 23:20:50] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/24 23:20:50] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/24 23:20:50] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/24 23:20:50] fastreid.data.datasets.bases INFO:   train    |   751 |    12936 |         6
[12/24 23:20:50] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/24 23:20:50] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/24 23:20:51] fastreid INFO: ------------------------------
[12/24 23:20:51] fastreid INFO: Meta-learning paramters
[12/24 23:20:51] fastreid INFO: ------------------------------
[12/24 23:20:51] fastreid INFO: [M_param] synth_data: none
[12/24 23:20:51] fastreid INFO: [M_param] synth_method: real
[12/24 23:20:51] fastreid INFO: [M_param] num_domain: 6
[12/24 23:20:51] fastreid INFO: [M_param] whole: True
[12/24 23:20:51] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/24 23:20:51] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/24 23:20:51] fastreid INFO: [M_param] meta_all_params: False
[12/24 23:20:51] fastreid INFO: [M_param] iter_init_inner: 1
[12/24 23:20:51] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/24 23:20:51] fastreid INFO: [M_param] iter_init_outer: 1
[12/24 23:20:51] fastreid INFO: [M_param] update_ratio: 0.0
[12/24 23:20:51] fastreid INFO: [M_param] iters_per_epoch: 877
[12/24 23:20:51] fastreid INFO: [M_param] iter_mtrain: 1
[12/24 23:20:51] fastreid INFO: [M_param] shuffle_domain: True
[12/24 23:20:51] fastreid INFO: [M_param] use_second_order: False
[12/24 23:20:51] fastreid INFO: [M_param] num_mtrain: 3
[12/24 23:20:51] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/24 23:20:51] fastreid INFO: [M_param] allow_unused: False
[12/24 23:20:51] fastreid INFO: [M_param] zero_grad: True
[12/24 23:20:51] fastreid INFO: [M_param] type_running_stats_init: general
[12/24 23:20:51] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/24 23:20:51] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/24 23:20:51] fastreid INFO: [M_param] auto_grad_outside: True
[12/24 23:20:51] fastreid INFO: [M_param] inner_clamp: True
[12/24 23:20:51] fastreid INFO: [M_param] synth_grad: none
[12/24 23:20:51] fastreid INFO: [M_param] constant_grad: 0.01
[12/24 23:20:51] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/24 23:20:51] fastreid INFO: [M_param] print_grad: True
[12/24 23:20:51] fastreid INFO: [M_param] one_loss_for_iter: False
[12/24 23:20:51] fastreid INFO: [M_param] one_loss_order: forward
[12/24 23:20:51] fastreid INFO: [M_param] num_mtest: 3
[12/24 23:20:51] fastreid INFO: [M_param] sync: True
[12/24 23:20:51] fastreid INFO: [M_param] detail_mode: True
[12/24 23:20:51] fastreid INFO: [M_param] stop_gradient: True
[12/24 23:20:51] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/24 23:20:51] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/24 23:20:51] fastreid INFO: [M_param] main_zero_grad: True
[12/24 23:20:51] fastreid INFO: [M_param] norm_zero_grad: True
[12/24 23:20:51] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/24 23:20:51] fastreid INFO: [M_param] write_period_param: 1000
[12/24 23:20:51] fastreid INFO: [M_param] loss_combined: False
[12/24 23:20:51] fastreid INFO: [M_param] loss_weight: 1.0
[12/24 23:20:51] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/24 23:20:51] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/24 23:20:51] fastreid INFO: ------------------------------
[12/24 23:21:26] fastreid INFO: Rank of current process: 0. World size: 1
[12/24 23:21:27] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/24 23:21:27] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/24 23:21:27] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/24 23:21:27] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/24 23:21:27] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/24 23:21:27] fastreid.data.datasets.bases INFO: => Loaded Market1501
[12/24 23:21:27] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/24 23:21:27] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/24 23:21:27] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/24 23:21:27] fastreid.data.datasets.bases INFO:   train    |   751 |    12936 |         6
[12/24 23:21:27] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/24 23:21:27] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/24 23:21:29] fastreid INFO: ------------------------------
[12/24 23:21:29] fastreid INFO: Meta-learning paramters
[12/24 23:21:29] fastreid INFO: ------------------------------
[12/24 23:21:29] fastreid INFO: [M_param] synth_data: none
[12/24 23:21:29] fastreid INFO: [M_param] synth_method: real
[12/24 23:21:29] fastreid INFO: [M_param] num_domain: 6
[12/24 23:21:29] fastreid INFO: [M_param] whole: True
[12/24 23:21:29] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/24 23:21:29] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/24 23:21:29] fastreid INFO: [M_param] meta_all_params: False
[12/24 23:21:29] fastreid INFO: [M_param] iter_init_inner: 1
[12/24 23:21:29] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/24 23:21:29] fastreid INFO: [M_param] iter_init_outer: 1
[12/24 23:21:29] fastreid INFO: [M_param] update_ratio: 0.0
[12/24 23:21:29] fastreid INFO: [M_param] iters_per_epoch: 877
[12/24 23:21:29] fastreid INFO: [M_param] iter_mtrain: 1
[12/24 23:21:29] fastreid INFO: [M_param] shuffle_domain: True
[12/24 23:21:29] fastreid INFO: [M_param] use_second_order: False
[12/24 23:21:29] fastreid INFO: [M_param] num_mtrain: 3
[12/24 23:21:29] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/24 23:21:29] fastreid INFO: [M_param] allow_unused: False
[12/24 23:21:29] fastreid INFO: [M_param] zero_grad: True
[12/24 23:21:29] fastreid INFO: [M_param] type_running_stats_init: general
[12/24 23:21:29] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/24 23:21:29] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/24 23:21:29] fastreid INFO: [M_param] auto_grad_outside: True
[12/24 23:21:29] fastreid INFO: [M_param] inner_clamp: True
[12/24 23:21:29] fastreid INFO: [M_param] synth_grad: none
[12/24 23:21:29] fastreid INFO: [M_param] constant_grad: 0.01
[12/24 23:21:29] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/24 23:21:29] fastreid INFO: [M_param] print_grad: True
[12/24 23:21:29] fastreid INFO: [M_param] one_loss_for_iter: False
[12/24 23:21:29] fastreid INFO: [M_param] one_loss_order: forward
[12/24 23:21:29] fastreid INFO: [M_param] num_mtest: 3
[12/24 23:21:29] fastreid INFO: [M_param] sync: True
[12/24 23:21:29] fastreid INFO: [M_param] detail_mode: True
[12/24 23:21:29] fastreid INFO: [M_param] stop_gradient: True
[12/24 23:21:29] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/24 23:21:29] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/24 23:21:29] fastreid INFO: [M_param] main_zero_grad: True
[12/24 23:21:29] fastreid INFO: [M_param] norm_zero_grad: True
[12/24 23:21:29] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/24 23:21:29] fastreid INFO: [M_param] write_period_param: 1000
[12/24 23:21:29] fastreid INFO: [M_param] loss_combined: False
[12/24 23:21:29] fastreid INFO: [M_param] loss_weight: 1.0
[12/24 23:21:29] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/24 23:21:29] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/24 23:21:29] fastreid INFO: ------------------------------
[12/24 23:21:53] fastreid INFO: Rank of current process: 0. World size: 1
[12/24 23:21:53] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/24 23:21:53] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/24 23:21:53] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/24 23:21:53] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/24 23:21:53] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/24 23:21:54] fastreid.data.datasets.bases INFO: => Loaded Market1501
[12/24 23:21:54] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/24 23:21:54] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/24 23:21:54] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/24 23:21:54] fastreid.data.datasets.bases INFO:   train    |   751 |    12936 |         6
[12/24 23:21:54] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/24 23:21:54] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/24 23:21:56] fastreid INFO: ------------------------------
[12/24 23:21:56] fastreid INFO: Meta-learning paramters
[12/24 23:21:56] fastreid INFO: ------------------------------
[12/24 23:21:56] fastreid INFO: [M_param] synth_data: none
[12/24 23:21:56] fastreid INFO: [M_param] synth_method: real
[12/24 23:21:56] fastreid INFO: [M_param] num_domain: 6
[12/24 23:21:56] fastreid INFO: [M_param] whole: True
[12/24 23:21:56] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/24 23:21:56] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/24 23:21:56] fastreid INFO: [M_param] meta_all_params: False
[12/24 23:21:56] fastreid INFO: [M_param] iter_init_inner: 1
[12/24 23:21:56] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/24 23:21:56] fastreid INFO: [M_param] iter_init_outer: 1
[12/24 23:21:56] fastreid INFO: [M_param] update_ratio: 0.0
[12/24 23:21:56] fastreid INFO: [M_param] iters_per_epoch: 877
[12/24 23:21:56] fastreid INFO: [M_param] iter_mtrain: 1
[12/24 23:21:56] fastreid INFO: [M_param] shuffle_domain: True
[12/24 23:21:56] fastreid INFO: [M_param] use_second_order: False
[12/24 23:21:56] fastreid INFO: [M_param] num_mtrain: 3
[12/24 23:21:56] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/24 23:21:56] fastreid INFO: [M_param] allow_unused: False
[12/24 23:21:56] fastreid INFO: [M_param] zero_grad: True
[12/24 23:21:56] fastreid INFO: [M_param] type_running_stats_init: general
[12/24 23:21:56] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/24 23:21:56] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/24 23:21:56] fastreid INFO: [M_param] auto_grad_outside: True
[12/24 23:21:56] fastreid INFO: [M_param] inner_clamp: True
[12/24 23:21:56] fastreid INFO: [M_param] synth_grad: none
[12/24 23:21:56] fastreid INFO: [M_param] constant_grad: 0.01
[12/24 23:21:56] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/24 23:21:56] fastreid INFO: [M_param] print_grad: True
[12/24 23:21:56] fastreid INFO: [M_param] one_loss_for_iter: False
[12/24 23:21:56] fastreid INFO: [M_param] one_loss_order: forward
[12/24 23:21:56] fastreid INFO: [M_param] num_mtest: 3
[12/24 23:21:56] fastreid INFO: [M_param] sync: True
[12/24 23:21:56] fastreid INFO: [M_param] detail_mode: True
[12/24 23:21:56] fastreid INFO: [M_param] stop_gradient: True
[12/24 23:21:56] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/24 23:21:56] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/24 23:21:56] fastreid INFO: [M_param] main_zero_grad: True
[12/24 23:21:56] fastreid INFO: [M_param] norm_zero_grad: True
[12/24 23:21:56] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/24 23:21:56] fastreid INFO: [M_param] write_period_param: 1000
[12/24 23:21:56] fastreid INFO: [M_param] loss_combined: False
[12/24 23:21:56] fastreid INFO: [M_param] loss_weight: 1.0
[12/24 23:21:56] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/24 23:21:56] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/24 23:21:56] fastreid INFO: ------------------------------
[12/24 23:23:26] fastreid INFO: Rank of current process: 0. World size: 1
[12/24 23:23:26] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/24 23:23:26] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/24 23:23:26] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/24 23:23:26] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/24 23:23:27] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/24 23:23:27] fastreid.data.datasets.bases INFO: => Loaded Market1501
[12/24 23:23:27] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/24 23:23:27] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/24 23:23:27] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/24 23:23:27] fastreid.data.datasets.bases INFO:   train    |   751 |    12936 |         6
[12/24 23:23:27] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/24 23:23:27] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/24 23:23:29] fastreid INFO: ------------------------------
[12/24 23:23:29] fastreid INFO: Meta-learning paramters
[12/24 23:23:29] fastreid INFO: ------------------------------
[12/24 23:23:29] fastreid INFO: [M_param] synth_data: none
[12/24 23:23:29] fastreid INFO: [M_param] synth_method: real
[12/24 23:23:29] fastreid INFO: [M_param] num_domain: 6
[12/24 23:23:29] fastreid INFO: [M_param] whole: True
[12/24 23:23:29] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/24 23:23:29] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/24 23:23:29] fastreid INFO: [M_param] meta_all_params: False
[12/24 23:23:29] fastreid INFO: [M_param] iter_init_inner: 1
[12/24 23:23:29] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/24 23:23:29] fastreid INFO: [M_param] iter_init_outer: 1
[12/24 23:23:29] fastreid INFO: [M_param] update_ratio: 0.0
[12/24 23:23:29] fastreid INFO: [M_param] iters_per_epoch: 877
[12/24 23:23:29] fastreid INFO: [M_param] iter_mtrain: 1
[12/24 23:23:29] fastreid INFO: [M_param] shuffle_domain: True
[12/24 23:23:29] fastreid INFO: [M_param] use_second_order: False
[12/24 23:23:29] fastreid INFO: [M_param] num_mtrain: 3
[12/24 23:23:29] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/24 23:23:29] fastreid INFO: [M_param] allow_unused: False
[12/24 23:23:29] fastreid INFO: [M_param] zero_grad: True
[12/24 23:23:29] fastreid INFO: [M_param] type_running_stats_init: general
[12/24 23:23:29] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/24 23:23:29] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/24 23:23:29] fastreid INFO: [M_param] auto_grad_outside: True
[12/24 23:23:29] fastreid INFO: [M_param] inner_clamp: True
[12/24 23:23:29] fastreid INFO: [M_param] synth_grad: none
[12/24 23:23:29] fastreid INFO: [M_param] constant_grad: 0.01
[12/24 23:23:29] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/24 23:23:29] fastreid INFO: [M_param] print_grad: True
[12/24 23:23:29] fastreid INFO: [M_param] one_loss_for_iter: False
[12/24 23:23:29] fastreid INFO: [M_param] one_loss_order: forward
[12/24 23:23:29] fastreid INFO: [M_param] num_mtest: 3
[12/24 23:23:29] fastreid INFO: [M_param] sync: True
[12/24 23:23:29] fastreid INFO: [M_param] detail_mode: True
[12/24 23:23:29] fastreid INFO: [M_param] stop_gradient: True
[12/24 23:23:29] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/24 23:23:29] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/24 23:23:29] fastreid INFO: [M_param] main_zero_grad: True
[12/24 23:23:29] fastreid INFO: [M_param] norm_zero_grad: True
[12/24 23:23:29] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/24 23:23:29] fastreid INFO: [M_param] write_period_param: 1000
[12/24 23:23:29] fastreid INFO: [M_param] loss_combined: False
[12/24 23:23:29] fastreid INFO: [M_param] loss_weight: 1.0
[12/24 23:23:29] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/24 23:23:29] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/24 23:23:29] fastreid INFO: ------------------------------
[12/24 23:23:40] fastreid INFO: Rank of current process: 0. World size: 1
[12/24 23:23:40] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/24 23:23:40] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/24 23:23:40] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/24 23:23:40] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/24 23:23:40] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/24 23:23:41] fastreid.data.datasets.bases INFO: => Loaded Market1501
[12/24 23:23:41] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/24 23:23:41] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/24 23:23:41] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/24 23:23:41] fastreid.data.datasets.bases INFO:   train    |   751 |    12936 |         6
[12/24 23:23:41] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/24 23:23:41] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/24 23:23:43] fastreid INFO: ------------------------------
[12/24 23:23:43] fastreid INFO: Meta-learning paramters
[12/24 23:23:43] fastreid INFO: ------------------------------
[12/24 23:23:43] fastreid INFO: [M_param] synth_data: none
[12/24 23:23:43] fastreid INFO: [M_param] synth_method: real
[12/24 23:23:43] fastreid INFO: [M_param] num_domain: 6
[12/24 23:23:43] fastreid INFO: [M_param] whole: True
[12/24 23:23:43] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/24 23:23:43] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/24 23:23:43] fastreid INFO: [M_param] meta_all_params: False
[12/24 23:23:43] fastreid INFO: [M_param] iter_init_inner: 1
[12/24 23:23:43] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/24 23:23:43] fastreid INFO: [M_param] iter_init_outer: 1
[12/24 23:23:43] fastreid INFO: [M_param] update_ratio: 0.0
[12/24 23:23:43] fastreid INFO: [M_param] iters_per_epoch: 877
[12/24 23:23:43] fastreid INFO: [M_param] iter_mtrain: 1
[12/24 23:23:43] fastreid INFO: [M_param] shuffle_domain: True
[12/24 23:23:43] fastreid INFO: [M_param] use_second_order: False
[12/24 23:23:43] fastreid INFO: [M_param] num_mtrain: 3
[12/24 23:23:43] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/24 23:23:43] fastreid INFO: [M_param] allow_unused: False
[12/24 23:23:43] fastreid INFO: [M_param] zero_grad: True
[12/24 23:23:43] fastreid INFO: [M_param] type_running_stats_init: general
[12/24 23:23:43] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/24 23:23:43] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/24 23:23:43] fastreid INFO: [M_param] auto_grad_outside: True
[12/24 23:23:43] fastreid INFO: [M_param] inner_clamp: True
[12/24 23:23:43] fastreid INFO: [M_param] synth_grad: none
[12/24 23:23:43] fastreid INFO: [M_param] constant_grad: 0.01
[12/24 23:23:43] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/24 23:23:43] fastreid INFO: [M_param] print_grad: True
[12/24 23:23:43] fastreid INFO: [M_param] one_loss_for_iter: False
[12/24 23:23:43] fastreid INFO: [M_param] one_loss_order: forward
[12/24 23:23:43] fastreid INFO: [M_param] num_mtest: 3
[12/24 23:23:43] fastreid INFO: [M_param] sync: True
[12/24 23:23:43] fastreid INFO: [M_param] detail_mode: True
[12/24 23:23:43] fastreid INFO: [M_param] stop_gradient: True
[12/24 23:23:43] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/24 23:23:43] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/24 23:23:43] fastreid INFO: [M_param] main_zero_grad: True
[12/24 23:23:43] fastreid INFO: [M_param] norm_zero_grad: True
[12/24 23:23:43] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/24 23:23:43] fastreid INFO: [M_param] write_period_param: 1000
[12/24 23:23:43] fastreid INFO: [M_param] loss_combined: False
[12/24 23:23:43] fastreid INFO: [M_param] loss_weight: 1.0
[12/24 23:23:43] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/24 23:23:43] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/24 23:23:43] fastreid INFO: ------------------------------
[12/24 23:23:57] fastreid INFO: Rank of current process: 0. World size: 1
[12/24 23:23:58] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/24 23:23:58] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/24 23:23:58] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/24 23:23:58] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/24 23:23:58] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/24 23:23:58] fastreid.data.datasets.bases INFO: => Loaded Market1501
[12/24 23:23:58] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/24 23:23:58] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/24 23:23:58] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/24 23:23:58] fastreid.data.datasets.bases INFO:   train    |   751 |    12936 |         6
[12/24 23:23:58] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/24 23:23:58] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/24 23:24:00] fastreid INFO: ------------------------------
[12/24 23:24:00] fastreid INFO: Meta-learning paramters
[12/24 23:24:00] fastreid INFO: ------------------------------
[12/24 23:24:00] fastreid INFO: [M_param] synth_data: none
[12/24 23:24:00] fastreid INFO: [M_param] synth_method: real
[12/24 23:24:00] fastreid INFO: [M_param] num_domain: 6
[12/24 23:24:00] fastreid INFO: [M_param] whole: True
[12/24 23:24:00] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/24 23:24:00] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/24 23:24:00] fastreid INFO: [M_param] meta_all_params: False
[12/24 23:24:00] fastreid INFO: [M_param] iter_init_inner: 1
[12/24 23:24:00] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/24 23:24:00] fastreid INFO: [M_param] iter_init_outer: 1
[12/24 23:24:00] fastreid INFO: [M_param] update_ratio: 0.0
[12/24 23:24:00] fastreid INFO: [M_param] iters_per_epoch: 877
[12/24 23:24:00] fastreid INFO: [M_param] iter_mtrain: 1
[12/24 23:24:00] fastreid INFO: [M_param] shuffle_domain: True
[12/24 23:24:00] fastreid INFO: [M_param] use_second_order: False
[12/24 23:24:00] fastreid INFO: [M_param] num_mtrain: 3
[12/24 23:24:00] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/24 23:24:00] fastreid INFO: [M_param] allow_unused: False
[12/24 23:24:00] fastreid INFO: [M_param] zero_grad: True
[12/24 23:24:00] fastreid INFO: [M_param] type_running_stats_init: general
[12/24 23:24:00] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/24 23:24:00] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/24 23:24:00] fastreid INFO: [M_param] auto_grad_outside: True
[12/24 23:24:00] fastreid INFO: [M_param] inner_clamp: True
[12/24 23:24:00] fastreid INFO: [M_param] synth_grad: none
[12/24 23:24:00] fastreid INFO: [M_param] constant_grad: 0.01
[12/24 23:24:00] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/24 23:24:00] fastreid INFO: [M_param] print_grad: True
[12/24 23:24:00] fastreid INFO: [M_param] one_loss_for_iter: False
[12/24 23:24:00] fastreid INFO: [M_param] one_loss_order: forward
[12/24 23:24:00] fastreid INFO: [M_param] num_mtest: 3
[12/24 23:24:00] fastreid INFO: [M_param] sync: True
[12/24 23:24:00] fastreid INFO: [M_param] detail_mode: True
[12/24 23:24:00] fastreid INFO: [M_param] stop_gradient: True
[12/24 23:24:00] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/24 23:24:00] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/24 23:24:00] fastreid INFO: [M_param] main_zero_grad: True
[12/24 23:24:00] fastreid INFO: [M_param] norm_zero_grad: True
[12/24 23:24:00] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/24 23:24:00] fastreid INFO: [M_param] write_period_param: 1000
[12/24 23:24:00] fastreid INFO: [M_param] loss_combined: False
[12/24 23:24:00] fastreid INFO: [M_param] loss_weight: 1.0
[12/24 23:24:00] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/24 23:24:00] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/24 23:24:00] fastreid INFO: ------------------------------
[12/24 23:24:30] fastreid INFO: Rank of current process: 0. World size: 1
[12/24 23:24:32] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/24 23:24:32] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/24 23:24:32] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/24 23:24:32] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/24 23:24:32] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/24 23:24:32] fastreid.data.datasets.bases INFO: => Loaded Market1501
[12/24 23:24:32] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/24 23:24:32] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/24 23:24:32] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/24 23:24:32] fastreid.data.datasets.bases INFO:   train    |   751 |    12936 |         6
[12/24 23:24:32] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/24 23:24:33] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/24 23:24:35] fastreid INFO: ------------------------------
[12/24 23:24:35] fastreid INFO: Meta-learning paramters
[12/24 23:24:35] fastreid INFO: ------------------------------
[12/24 23:24:35] fastreid INFO: [M_param] synth_data: none
[12/24 23:24:35] fastreid INFO: [M_param] synth_method: real
[12/24 23:24:35] fastreid INFO: [M_param] num_domain: 6
[12/24 23:24:35] fastreid INFO: [M_param] whole: True
[12/24 23:24:35] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/24 23:24:35] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/24 23:24:35] fastreid INFO: [M_param] meta_all_params: False
[12/24 23:24:35] fastreid INFO: [M_param] iter_init_inner: 1
[12/24 23:24:35] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/24 23:24:35] fastreid INFO: [M_param] iter_init_outer: 1
[12/24 23:24:35] fastreid INFO: [M_param] update_ratio: 0.0
[12/24 23:24:35] fastreid INFO: [M_param] iters_per_epoch: 877
[12/24 23:24:35] fastreid INFO: [M_param] iter_mtrain: 1
[12/24 23:24:35] fastreid INFO: [M_param] shuffle_domain: True
[12/24 23:24:35] fastreid INFO: [M_param] use_second_order: False
[12/24 23:24:35] fastreid INFO: [M_param] num_mtrain: 3
[12/24 23:24:35] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/24 23:24:35] fastreid INFO: [M_param] allow_unused: False
[12/24 23:24:35] fastreid INFO: [M_param] zero_grad: True
[12/24 23:24:35] fastreid INFO: [M_param] type_running_stats_init: general
[12/24 23:24:35] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/24 23:24:35] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/24 23:24:35] fastreid INFO: [M_param] auto_grad_outside: True
[12/24 23:24:35] fastreid INFO: [M_param] inner_clamp: True
[12/24 23:24:35] fastreid INFO: [M_param] synth_grad: none
[12/24 23:24:35] fastreid INFO: [M_param] constant_grad: 0.01
[12/24 23:24:35] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/24 23:24:35] fastreid INFO: [M_param] print_grad: True
[12/24 23:24:35] fastreid INFO: [M_param] one_loss_for_iter: False
[12/24 23:24:35] fastreid INFO: [M_param] one_loss_order: forward
[12/24 23:24:35] fastreid INFO: [M_param] num_mtest: 3
[12/24 23:24:35] fastreid INFO: [M_param] sync: True
[12/24 23:24:35] fastreid INFO: [M_param] detail_mode: True
[12/24 23:24:35] fastreid INFO: [M_param] stop_gradient: True
[12/24 23:24:35] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/24 23:24:35] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/24 23:24:35] fastreid INFO: [M_param] main_zero_grad: True
[12/24 23:24:35] fastreid INFO: [M_param] norm_zero_grad: True
[12/24 23:24:35] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/24 23:24:35] fastreid INFO: [M_param] write_period_param: 1000
[12/24 23:24:35] fastreid INFO: [M_param] loss_combined: False
[12/24 23:24:35] fastreid INFO: [M_param] loss_weight: 1.0
[12/24 23:24:35] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/24 23:24:35] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/24 23:24:35] fastreid INFO: ------------------------------
[12/24 23:25:49] fastreid INFO: Rank of current process: 0. World size: 1
[12/24 23:25:51] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/24 23:25:51] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/24 23:25:51] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/24 23:25:51] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/24 23:25:51] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/24 23:25:51] fastreid.data.datasets.bases INFO: => Loaded Market1501
[12/24 23:25:51] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/24 23:25:51] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/24 23:25:51] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/24 23:25:51] fastreid.data.datasets.bases INFO:   train    |   751 |    12936 |         6
[12/24 23:25:51] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/24 23:25:51] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/24 23:25:54] fastreid INFO: ------------------------------
[12/24 23:25:54] fastreid INFO: Meta-learning paramters
[12/24 23:25:54] fastreid INFO: ------------------------------
[12/24 23:25:54] fastreid INFO: [M_param] synth_data: none
[12/24 23:25:54] fastreid INFO: [M_param] synth_method: real
[12/24 23:25:54] fastreid INFO: [M_param] num_domain: 6
[12/24 23:25:54] fastreid INFO: [M_param] whole: True
[12/24 23:25:54] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/24 23:25:54] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/24 23:25:54] fastreid INFO: [M_param] meta_all_params: False
[12/24 23:25:54] fastreid INFO: [M_param] iter_init_inner: 1
[12/24 23:25:54] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/24 23:25:54] fastreid INFO: [M_param] iter_init_outer: 1
[12/24 23:25:54] fastreid INFO: [M_param] update_ratio: 0.0
[12/24 23:25:54] fastreid INFO: [M_param] iters_per_epoch: 877
[12/24 23:25:54] fastreid INFO: [M_param] iter_mtrain: 1
[12/24 23:25:54] fastreid INFO: [M_param] shuffle_domain: True
[12/24 23:25:54] fastreid INFO: [M_param] use_second_order: False
[12/24 23:25:54] fastreid INFO: [M_param] num_mtrain: 3
[12/24 23:25:54] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/24 23:25:54] fastreid INFO: [M_param] allow_unused: False
[12/24 23:25:54] fastreid INFO: [M_param] zero_grad: True
[12/24 23:25:54] fastreid INFO: [M_param] type_running_stats_init: general
[12/24 23:25:54] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/24 23:25:54] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/24 23:25:54] fastreid INFO: [M_param] auto_grad_outside: True
[12/24 23:25:54] fastreid INFO: [M_param] inner_clamp: True
[12/24 23:25:54] fastreid INFO: [M_param] synth_grad: none
[12/24 23:25:54] fastreid INFO: [M_param] constant_grad: 0.01
[12/24 23:25:54] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/24 23:25:54] fastreid INFO: [M_param] print_grad: True
[12/24 23:25:54] fastreid INFO: [M_param] one_loss_for_iter: False
[12/24 23:25:54] fastreid INFO: [M_param] one_loss_order: forward
[12/24 23:25:54] fastreid INFO: [M_param] num_mtest: 3
[12/24 23:25:54] fastreid INFO: [M_param] sync: True
[12/24 23:25:54] fastreid INFO: [M_param] detail_mode: True
[12/24 23:25:54] fastreid INFO: [M_param] stop_gradient: True
[12/24 23:25:54] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/24 23:25:54] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/24 23:25:54] fastreid INFO: [M_param] main_zero_grad: True
[12/24 23:25:54] fastreid INFO: [M_param] norm_zero_grad: True
[12/24 23:25:54] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/24 23:25:54] fastreid INFO: [M_param] write_period_param: 1000
[12/24 23:25:54] fastreid INFO: [M_param] loss_combined: False
[12/24 23:25:54] fastreid INFO: [M_param] loss_weight: 1.0
[12/24 23:25:54] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/24 23:25:54] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/24 23:25:54] fastreid INFO: ------------------------------
[12/24 23:26:42] fastreid INFO: Rank of current process: 0. World size: 1
[12/24 23:26:43] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/24 23:26:43] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/24 23:26:43] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/24 23:26:43] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/24 23:26:43] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/24 23:26:44] fastreid.data.datasets.bases INFO: => Loaded Market1501
[12/24 23:26:44] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/24 23:26:44] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/24 23:26:44] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/24 23:26:44] fastreid.data.datasets.bases INFO:   train    |   751 |    12936 |         6
[12/24 23:26:44] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/24 23:26:44] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/24 23:26:46] fastreid INFO: ------------------------------
[12/24 23:26:46] fastreid INFO: Meta-learning paramters
[12/24 23:26:46] fastreid INFO: ------------------------------
[12/24 23:26:46] fastreid INFO: [M_param] synth_data: none
[12/24 23:26:46] fastreid INFO: [M_param] synth_method: real
[12/24 23:26:46] fastreid INFO: [M_param] num_domain: 6
[12/24 23:26:46] fastreid INFO: [M_param] whole: True
[12/24 23:26:46] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/24 23:26:46] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/24 23:26:46] fastreid INFO: [M_param] meta_all_params: False
[12/24 23:26:46] fastreid INFO: [M_param] iter_init_inner: 1
[12/24 23:26:46] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/24 23:26:46] fastreid INFO: [M_param] iter_init_outer: 1
[12/24 23:26:46] fastreid INFO: [M_param] update_ratio: 0.0
[12/24 23:26:46] fastreid INFO: [M_param] iters_per_epoch: 877
[12/24 23:26:46] fastreid INFO: [M_param] iter_mtrain: 1
[12/24 23:26:46] fastreid INFO: [M_param] shuffle_domain: True
[12/24 23:26:46] fastreid INFO: [M_param] use_second_order: False
[12/24 23:26:46] fastreid INFO: [M_param] num_mtrain: 3
[12/24 23:26:46] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/24 23:26:46] fastreid INFO: [M_param] allow_unused: False
[12/24 23:26:46] fastreid INFO: [M_param] zero_grad: True
[12/24 23:26:46] fastreid INFO: [M_param] type_running_stats_init: general
[12/24 23:26:46] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/24 23:26:46] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/24 23:26:46] fastreid INFO: [M_param] auto_grad_outside: True
[12/24 23:26:46] fastreid INFO: [M_param] inner_clamp: True
[12/24 23:26:46] fastreid INFO: [M_param] synth_grad: none
[12/24 23:26:46] fastreid INFO: [M_param] constant_grad: 0.01
[12/24 23:26:46] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/24 23:26:46] fastreid INFO: [M_param] print_grad: True
[12/24 23:26:46] fastreid INFO: [M_param] one_loss_for_iter: False
[12/24 23:26:46] fastreid INFO: [M_param] one_loss_order: forward
[12/24 23:26:46] fastreid INFO: [M_param] num_mtest: 3
[12/24 23:26:46] fastreid INFO: [M_param] sync: True
[12/24 23:26:46] fastreid INFO: [M_param] detail_mode: True
[12/24 23:26:46] fastreid INFO: [M_param] stop_gradient: True
[12/24 23:26:46] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/24 23:26:46] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/24 23:26:46] fastreid INFO: [M_param] main_zero_grad: True
[12/24 23:26:46] fastreid INFO: [M_param] norm_zero_grad: True
[12/24 23:26:46] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/24 23:26:46] fastreid INFO: [M_param] write_period_param: 1000
[12/24 23:26:46] fastreid INFO: [M_param] loss_combined: False
[12/24 23:26:46] fastreid INFO: [M_param] loss_weight: 1.0
[12/24 23:26:46] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/24 23:26:46] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/24 23:26:46] fastreid INFO: ------------------------------
[12/24 23:28:10] fastreid INFO: Rank of current process: 0. World size: 1
[12/24 23:28:12] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/24 23:28:12] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/24 23:28:12] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/24 23:28:12] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/24 23:28:12] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/24 23:28:12] fastreid.data.datasets.bases INFO: => Loaded Market1501
[12/24 23:28:12] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/24 23:28:12] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/24 23:28:12] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/24 23:28:12] fastreid.data.datasets.bases INFO:   train    |   751 |    12936 |         6
[12/24 23:28:12] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/24 23:28:12] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/24 23:28:15] fastreid INFO: ------------------------------
[12/24 23:28:15] fastreid INFO: Meta-learning paramters
[12/24 23:28:15] fastreid INFO: ------------------------------
[12/24 23:28:15] fastreid INFO: [M_param] synth_data: none
[12/24 23:28:15] fastreid INFO: [M_param] synth_method: real
[12/24 23:28:15] fastreid INFO: [M_param] num_domain: 6
[12/24 23:28:15] fastreid INFO: [M_param] whole: True
[12/24 23:28:15] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/24 23:28:15] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/24 23:28:15] fastreid INFO: [M_param] meta_all_params: False
[12/24 23:28:15] fastreid INFO: [M_param] iter_init_inner: 1
[12/24 23:28:15] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/24 23:28:15] fastreid INFO: [M_param] iter_init_outer: 1
[12/24 23:28:15] fastreid INFO: [M_param] update_ratio: 0.0
[12/24 23:28:15] fastreid INFO: [M_param] iters_per_epoch: 877
[12/24 23:28:15] fastreid INFO: [M_param] iter_mtrain: 1
[12/24 23:28:15] fastreid INFO: [M_param] shuffle_domain: True
[12/24 23:28:15] fastreid INFO: [M_param] use_second_order: False
[12/24 23:28:15] fastreid INFO: [M_param] num_mtrain: 3
[12/24 23:28:15] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/24 23:28:15] fastreid INFO: [M_param] allow_unused: False
[12/24 23:28:15] fastreid INFO: [M_param] zero_grad: True
[12/24 23:28:15] fastreid INFO: [M_param] type_running_stats_init: general
[12/24 23:28:15] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/24 23:28:15] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/24 23:28:15] fastreid INFO: [M_param] auto_grad_outside: True
[12/24 23:28:15] fastreid INFO: [M_param] inner_clamp: True
[12/24 23:28:15] fastreid INFO: [M_param] synth_grad: none
[12/24 23:28:15] fastreid INFO: [M_param] constant_grad: 0.01
[12/24 23:28:15] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/24 23:28:15] fastreid INFO: [M_param] print_grad: True
[12/24 23:28:15] fastreid INFO: [M_param] one_loss_for_iter: False
[12/24 23:28:15] fastreid INFO: [M_param] one_loss_order: forward
[12/24 23:28:15] fastreid INFO: [M_param] num_mtest: 3
[12/24 23:28:15] fastreid INFO: [M_param] sync: True
[12/24 23:28:15] fastreid INFO: [M_param] detail_mode: True
[12/24 23:28:15] fastreid INFO: [M_param] stop_gradient: True
[12/24 23:28:15] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/24 23:28:15] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/24 23:28:15] fastreid INFO: [M_param] main_zero_grad: True
[12/24 23:28:15] fastreid INFO: [M_param] norm_zero_grad: True
[12/24 23:28:15] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/24 23:28:15] fastreid INFO: [M_param] write_period_param: 1000
[12/24 23:28:15] fastreid INFO: [M_param] loss_combined: False
[12/24 23:28:15] fastreid INFO: [M_param] loss_weight: 1.0
[12/24 23:28:15] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/24 23:28:15] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/24 23:28:15] fastreid INFO: ------------------------------
[12/24 23:28:51] fastreid INFO: Rank of current process: 0. World size: 1
[12/24 23:28:52] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/24 23:28:52] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/24 23:28:52] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/24 23:28:52] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/24 23:28:53] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/24 23:28:53] fastreid.data.datasets.bases INFO: => Loaded Market1501
[12/24 23:28:53] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/24 23:28:53] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/24 23:28:53] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/24 23:28:53] fastreid.data.datasets.bases INFO:   train    |   751 |    12936 |         6
[12/24 23:28:53] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/24 23:28:53] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/24 23:28:55] fastreid INFO: ------------------------------
[12/24 23:28:55] fastreid INFO: Meta-learning paramters
[12/24 23:28:55] fastreid INFO: ------------------------------
[12/24 23:28:55] fastreid INFO: [M_param] synth_data: none
[12/24 23:28:55] fastreid INFO: [M_param] synth_method: real
[12/24 23:28:55] fastreid INFO: [M_param] num_domain: 6
[12/24 23:28:55] fastreid INFO: [M_param] whole: True
[12/24 23:28:55] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/24 23:28:55] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/24 23:28:55] fastreid INFO: [M_param] meta_all_params: False
[12/24 23:28:55] fastreid INFO: [M_param] iter_init_inner: 1
[12/24 23:28:55] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/24 23:28:55] fastreid INFO: [M_param] iter_init_outer: 1
[12/24 23:28:55] fastreid INFO: [M_param] update_ratio: 0.0
[12/24 23:28:55] fastreid INFO: [M_param] iters_per_epoch: 877
[12/24 23:28:55] fastreid INFO: [M_param] iter_mtrain: 1
[12/24 23:28:55] fastreid INFO: [M_param] shuffle_domain: True
[12/24 23:28:55] fastreid INFO: [M_param] use_second_order: False
[12/24 23:28:55] fastreid INFO: [M_param] num_mtrain: 3
[12/24 23:28:55] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/24 23:28:55] fastreid INFO: [M_param] allow_unused: False
[12/24 23:28:55] fastreid INFO: [M_param] zero_grad: True
[12/24 23:28:55] fastreid INFO: [M_param] type_running_stats_init: general
[12/24 23:28:55] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/24 23:28:55] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/24 23:28:55] fastreid INFO: [M_param] auto_grad_outside: True
[12/24 23:28:55] fastreid INFO: [M_param] inner_clamp: True
[12/24 23:28:55] fastreid INFO: [M_param] synth_grad: none
[12/24 23:28:55] fastreid INFO: [M_param] constant_grad: 0.01
[12/24 23:28:55] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/24 23:28:55] fastreid INFO: [M_param] print_grad: True
[12/24 23:28:55] fastreid INFO: [M_param] one_loss_for_iter: False
[12/24 23:28:55] fastreid INFO: [M_param] one_loss_order: forward
[12/24 23:28:55] fastreid INFO: [M_param] num_mtest: 3
[12/24 23:28:55] fastreid INFO: [M_param] sync: True
[12/24 23:28:55] fastreid INFO: [M_param] detail_mode: True
[12/24 23:28:55] fastreid INFO: [M_param] stop_gradient: True
[12/24 23:28:55] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/24 23:28:55] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/24 23:28:55] fastreid INFO: [M_param] main_zero_grad: True
[12/24 23:28:55] fastreid INFO: [M_param] norm_zero_grad: True
[12/24 23:28:55] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/24 23:28:55] fastreid INFO: [M_param] write_period_param: 1000
[12/24 23:28:55] fastreid INFO: [M_param] loss_combined: False
[12/24 23:28:55] fastreid INFO: [M_param] loss_weight: 1.0
[12/24 23:28:55] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/24 23:28:55] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/24 23:28:55] fastreid INFO: ------------------------------
[12/24 23:29:26] fastreid INFO: Rank of current process: 0. World size: 1
[12/24 23:29:27] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/24 23:29:27] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/24 23:29:27] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/24 23:29:27] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/24 23:29:28] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/24 23:29:28] fastreid.data.datasets.bases INFO: => Loaded Market1501
[12/24 23:29:28] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/24 23:29:28] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/24 23:29:28] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/24 23:29:28] fastreid.data.datasets.bases INFO:   train    |   751 |    12936 |         6
[12/24 23:29:28] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/24 23:29:28] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/24 23:29:31] fastreid INFO: ------------------------------
[12/24 23:29:31] fastreid INFO: Meta-learning paramters
[12/24 23:29:31] fastreid INFO: ------------------------------
[12/24 23:29:31] fastreid INFO: [M_param] synth_data: none
[12/24 23:29:31] fastreid INFO: [M_param] synth_method: real
[12/24 23:29:31] fastreid INFO: [M_param] num_domain: 6
[12/24 23:29:31] fastreid INFO: [M_param] whole: True
[12/24 23:29:31] fastreid INFO: [M_param] meta_compute_layer: ('backbone_bn_gate',)
[12/24 23:29:31] fastreid INFO: [M_param] meta_update_layer: ('backbone_bn_gate',)
[12/24 23:29:31] fastreid INFO: [M_param] meta_all_params: False
[12/24 23:29:31] fastreid INFO: [M_param] iter_init_inner: 1
[12/24 23:29:31] fastreid INFO: [M_param] iter_init_inner_first: 10
[12/24 23:29:31] fastreid INFO: [M_param] iter_init_outer: 1
[12/24 23:29:31] fastreid INFO: [M_param] update_ratio: 0.0
[12/24 23:29:31] fastreid INFO: [M_param] iters_per_epoch: 877
[12/24 23:29:31] fastreid INFO: [M_param] iter_mtrain: 1
[12/24 23:29:31] fastreid INFO: [M_param] shuffle_domain: True
[12/24 23:29:31] fastreid INFO: [M_param] use_second_order: False
[12/24 23:29:31] fastreid INFO: [M_param] num_mtrain: 3
[12/24 23:29:31] fastreid INFO: [M_param] freeze_gradient_meta: False
[12/24 23:29:31] fastreid INFO: [M_param] allow_unused: False
[12/24 23:29:31] fastreid INFO: [M_param] zero_grad: True
[12/24 23:29:31] fastreid INFO: [M_param] type_running_stats_init: general
[12/24 23:29:31] fastreid INFO: [M_param] type_running_stats_mtrain: hold
[12/24 23:29:31] fastreid INFO: [M_param] type_running_stats_mtest: hold
[12/24 23:29:31] fastreid INFO: [M_param] auto_grad_outside: True
[12/24 23:29:31] fastreid INFO: [M_param] inner_clamp: True
[12/24 23:29:31] fastreid INFO: [M_param] synth_grad: none
[12/24 23:29:31] fastreid INFO: [M_param] constant_grad: 0.01
[12/24 23:29:31] fastreid INFO: [M_param] random_scale_grad: 1.0
[12/24 23:29:31] fastreid INFO: [M_param] print_grad: True
[12/24 23:29:31] fastreid INFO: [M_param] one_loss_for_iter: False
[12/24 23:29:31] fastreid INFO: [M_param] one_loss_order: forward
[12/24 23:29:31] fastreid INFO: [M_param] num_mtest: 3
[12/24 23:29:31] fastreid INFO: [M_param] sync: True
[12/24 23:29:31] fastreid INFO: [M_param] detail_mode: True
[12/24 23:29:31] fastreid INFO: [M_param] stop_gradient: True
[12/24 23:29:31] fastreid INFO: [M_param] flag_manual_zero_grad: zero
[12/24 23:29:31] fastreid INFO: [M_param] flag_manual_memory_empty: True
[12/24 23:29:31] fastreid INFO: [M_param] main_zero_grad: True
[12/24 23:29:31] fastreid INFO: [M_param] norm_zero_grad: True
[12/24 23:29:31] fastreid INFO: [M_param] momentum_init_grad: 0.0
[12/24 23:29:31] fastreid INFO: [M_param] write_period_param: 1000
[12/24 23:29:31] fastreid INFO: [M_param] loss_combined: False
[12/24 23:29:31] fastreid INFO: [M_param] loss_weight: 1.0
[12/24 23:29:31] fastreid INFO: [M_param] loss_name_mtrain: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
[12/24 23:29:31] fastreid INFO: [M_param] loss_name_mtest: ('CrossEntropyLoss', 'TripletLoss_mtest')
[12/24 23:29:31] fastreid INFO: ------------------------------
[12/24 23:29:31] fastreid.utils.checkpoint INFO: Loading checkpoint from ./refs/logs/Sample/M-resnet\model_0015199.pth
[12/24 23:29:31] fastreid.utils.checkpoint INFO: Loading optimizer_main from ./refs/logs/Sample/M-resnet\model_0015199.pth
[12/24 23:29:31] fastreid.utils.checkpoint INFO: Loading scheduler_main from ./refs/logs/Sample/M-resnet\model_0015199.pth
[12/24 23:29:31] fastreid.utils.checkpoint INFO: Loading optimizer_norm from ./refs/logs/Sample/M-resnet\model_0015199.pth
[12/24 23:29:31] fastreid.utils.checkpoint INFO: Loading scheduler_norm from ./refs/logs/Sample/M-resnet\model_0015199.pth
[12/25 15:21:06] fastreid INFO: Rank of current process: 0. World size: 1
[12/25 15:21:08] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/25 15:21:08] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/25 15:21:08] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/25 15:21:08] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/25 15:21:08] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/25 15:21:09] fastreid.data.datasets.bases INFO: => Loaded Market1501
[12/25 15:21:09] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/25 15:21:09] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/25 15:21:09] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/25 15:21:09] fastreid.data.datasets.bases INFO:   train    |   751 |    12936 |         6
[12/25 15:21:09] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/25 15:21:09] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
[12/25 22:21:13] fastreid INFO: Rank of current process: 0. World size: 1
[12/25 22:21:14] fastreid INFO: Environment info:
----------------------  --------------------------------------------------------------------------------------------------------------
sys.platform            win32
Python                  3.8.15 (default, Nov 24 2022, 14:38:14) [MSC v.1916 64 bit (AMD64)]
numpy                   1.23.4
fastreid                0.1.0 @E:\Work\Python\metabin\MetaBIN-paddle\./refs\fastreid
FASTREID_ENV_MODULE     <not set>
PyTorch                 1.7.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torch
PyTorch debug build     True
GPU available           True
GPU 0                   NVIDIA GeForce GTX 1070
CUDA_HOME               C:\Program Files\NVIDIA GPU Computing Toolkit\CUDA\v10.2
Pillow                  9.2.0
torchvision             0.8.0 @D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision
torchvision arch flags  D:\Application\Anaconda\Anaconda\envs\MetaBIN-py38\lib\site-packages\torchvision\_C.pyd; cannot find cuobjdump
cv2                     4.6.0
----------------------  --------------------------------------------------------------------------------------------------------------
PyTorch built with:
  - C++ Version: 199711
  - MSVC 192729112
  - Intel(R) Math Kernel Library Version 2020.0.0 Product Build 20191125 for Intel(R) 64 architecture applications
  - Intel(R) MKL-DNN v1.6.0 (Git Hash 5ef631a030a6f73131c77892041042805a06064f)
  - OpenMP 2019
  - CPU capability usage: AVX2
  - CUDA Runtime 10.1
  - NVCC architecture flags: -gencode;arch=compute_37,code=sm_37;-gencode;arch=compute_50,code=sm_50;-gencode;arch=compute_60,code=sm_60;-gencode;arch=compute_61,code=sm_61;-gencode;arch=compute_70,code=sm_70;-gencode;arch=compute_75,code=sm_75;-gencode;arch=compute_37,code=compute_37
  - CuDNN 7.6.4
  - Magma 2.5.3
  - Build settings: BLAS=MKL, BUILD_TYPE=Release, CXX_FLAGS=/DWIN32 /D_WINDOWS /GR /EHsc /w /bigobj -openmp:experimental -DNDEBUG -DUSE_FBGEMM -DUSE_VULKAN_WRAPPER, PERF_WITH_AVX=1, PERF_WITH_AVX2=1, PERF_WITH_AVX512=1, USE_CUDA=ON, USE_EXCEPTION_PTR=1, USE_GFLAGS=OFF, USE_GLOG=OFF, USE_MKL=ON, USE_MKLDNN=ON, USE_MPI=OFF, USE_NCCL=OFF, USE_NNPACK=OFF, USE_OPENMP=ON, 

[12/25 22:21:14] fastreid INFO: Command line arguments: Namespace(config_file='./refs/configs/Sample/M-resnet.yml', dist_only=False, dist_url='tcp://127.0.0.1:49153', domain_only=False, eval_only=True, machine_rank=0, num_gpus=1, num_machines=1, num_pth=0, opts=[], resume=True, tsne_only=False)
[12/25 22:21:14] fastreid INFO: Contents of args.config_file=./refs/configs/Sample/M-resnet.yml:
_BASE_: "../Base-DG.yml"

INPUT:
  CJ:
    ENABLED: True

META:
  DATA:
    MTRAIN_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTRAIN_NUM_INSTANCE: 4
    MTEST_MINI_BATCH: 96 # should be a multiply of num_domain x num_instance
    MTEST_NUM_INSTANCE: 4
  SOLVER:
    LR_FACTOR:
      GATE: 20.0 
    MTRAIN:
      NUM_DOMAIN: 3 # number of mtrain domains
  LOSS:
    MTRAIN_NAME: ("CrossEntropyLoss","TripletLoss_add","TripletLoss_mtrain","SCT",) 
    MTEST_NAME: ("CrossEntropyLoss","TripletLoss_mtest",)

MODEL:
  BACKBONE:
    NAME: "build_resnet_backbone" # "build_resnet_backbone", "build_mobilenet_v2_backbone"
    DEPTH: 50 # ResNet->18,34,50,101,152, Mobilenet->10,14
    PRETRAIN: True
    PRETRAIN_PATH: '' # 'pretrained/mobilenetv2_1.0.pth' or 'pretrained/mobilenetv2_1.4.pth' or ''
  HEADS:
    IN_FEAT: 2048 # ResNet(18,34) 512 , Resnet(50) 2048, Mobilenet w1.0 1280, w1.4 1792
  LOSSES:
    NAME: ("CrossEntropyLoss","TripletLoss",) 
  NORM:
    TYPE_BACKBONE: "BIN_gate2" # "BN", "IN", "BIN_half", "BIN_gate1" (original), "BIN_gate2" (MetaBIN)

DATASETS:
  NAMES: ("Market1501",) 
  TESTS: ("Market1501", "DukeMTMC",)

DATALOADER:
  CAMERA_TO_DOMAIN: True # True when market (6), Duke (8), MSMT (15), False when DG
  NUM_INSTANCE: 4

SOLVER:
  BASE_LR: 0.01
  MAX_ITER: 120 
  STEPS: [50, 90] 
  IMS_PER_BATCH: 96 
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True

TEST:
  EVAL_PERIOD: 2

[12/25 22:21:14] fastreid INFO: Running with full config:
CUDNN_BENCHMARK: True
DATALOADER:
  CAMERA_TO_DOMAIN: True
  DELETE_REM: False
  DROP_LAST: True
  INDIVIDUAL: False
  NAIVE_WAY: True
  NUM_INSTANCE: 4
  NUM_WORKERS: 2
DATASETS:
  COMBINEALL: False
  NAMES: ('Market1501',)
  TESTS: ('Market1501', 'DukeMTMC')
INPUT:
  CJ:
    BRIGHTNESS: 0.15
    CONTRAST: 0.15
    ENABLED: True
    HUE: 0.1
    PROB: 1.0
    SATURATION: 0.1
  DO_AUGMIX: False
  DO_AUTOAUG: False
  DO_FLIP: True
  DO_PAD: True
  FLIP_PROB: 0.5
  PADDING: 10
  PADDING_MODE: constant
  REA:
    ENABLED: False
    MEAN: [123.675, 116.28, 103.53]
    PROB: 0.5
  RPT:
    ENABLED: False
    PROB: 0.5
  SIZE_TEST: [256, 128]
  SIZE_TRAIN: [256, 128]
META:
  BOTTLENECK:
    DO_IT: False
    NORM: True
    REDUCTION_DIM: 1024
  DATA:
    DELETE_REM: False
    DROP_LAST: True
    INDIVIDUAL: False
    LOADER_FLAG: diff
    MTEST_MINI_BATCH: 96
    MTEST_NUM_INSTANCE: 4
    MTRAIN_MINI_BATCH: 96
    MTRAIN_NUM_INSTANCE: 4
    NAIVE_WAY: False
    NAMES: DG
    NUM_DOMAINS: 5
    RELABEL: False
    SYNTH_FLAG: none
    SYNTH_METHOD: real
    SYNTH_SAME_SEED: False
    WHOLE: True
  LOSS:
    COMBINED: False
    MTEST_NAME: ('CrossEntropyLoss', 'TripletLoss_mtest')
    MTRAIN_NAME: ('CrossEntropyLoss', 'TripletLoss_add', 'TripletLoss_mtrain', 'SCT')
    WEIGHT: 1.0
  MODEL:
    ALL_PARAMS: False
    META_COMPUTE_LAYER: ('backbone_bn_gate',)
    META_UPDATE_LAYER: ('backbone_bn_gate',)
  NEW_SOLVER:
    MAIN_ZERO_GRAD: True
    MOMENTUM_INIT_GRAD: 0.0
    NORM_ZERO_GRAD: True
  SOLVER:
    AUTO_GRAD_OUTSIDE: True
    CONSTANT_GRAD: 0.01
    DETAIL_MODE: True
    EARLY_SCALE: True
    INIT:
      FIRST_INNER_LOOP: 10
      INNER_LOOP: 1
      OUTER_LOOP: 1
      TYPE_RUNNING_STATS: general
    INNER_CLAMP: True
    LR_FACTOR:
      GATE: 20.0
      GATE_CYCLIC_PERIOD_PER_EPOCH: 0.2
      GATE_CYCLIC_RATIO: 10.0
      META: 0.0
      META_CYCLIC_MIDDLE_LR: 0.01
      META_CYCLIC_NEW: True
      META_CYCLIC_PERIOD_PER_EPOCH: 0.2
      META_CYCLIC_RATIO: 10.0
      META_CYCLIC_UP_RATIO: 0.5
    MANUAL_MEMORY_EMPTY: True
    MANUAL_SEED_DETERMINISTIC: True
    MANUAL_SEED_FLAG: True
    MANUAL_SEED_NUMBER: 2020
    MANUAL_ZERO_GRAD: zero
    MTEST:
      ONLY_ONE_DOMAIN: False
      TYPE_RUNNING_STATS: hold
    MTRAIN:
      ALLOW_UNUSED: False
      BEFORE_ZERO_GRAD: True
      FREEZE_GRAD_META: False
      INNER_LOOP: 1
      NUM_DOMAIN: 3
      SECOND_ORDER: False
      SHUFFLE_DOMAIN: True
      TYPE_RUNNING_STATS: hold
    ONE_LOSS_FOR_ITER: False
    ONE_LOSS_ORDER: forward
    PRINT_GRAD: True
    RANDOM_SCALE_GRAD: 1.0
    STOP_GRADIENT: True
    SYNC: True
    SYNTH_GRAD: none
MODEL:
  BACKBONE:
    DEPTH: 50
    LAST_STRIDE: 1
    NAME: build_resnet_backbone
    NORM_SPLIT: 1
    NUM_BATCH_TRACKED: False
    PRETRAIN: True
    PRETRAIN_PATH: 
    VOLUME: 800y
    WITH_IBN: False
    WITH_NL: False
    WITH_SE: False
  DEVICE: cuda
  FREEZE_LAYERS: ['']
  HEADS:
    CLS_LAYER: linear
    IN_FEAT: 2048
    MARGIN: 0.15
    NAME: MetalearningHead
    NORM_SPLIT: 1
    NUM_CLASSES: 0
    POOL_LAYER: avgpool
    REDUCTION_DIM: 512
    SCALE: 128
  LOSSES:
    CE:
      ALPHA: 0.2
      EPSILON: 0.1
      SCALE: 1.0
    CIRCLE:
      ALPHA: 128
      FEAT_ORDER: before
      MARGIN: 0.25
      SCALE: 1.0
    FL:
      ALPHA: 0.25
      GAMMA: 2
      SCALE: 1.0
    JSD:
      FEAT_ORDER: before
      NORM: False
      SCALE: 1.0
    MMD:
      FEAT_ORDER: before
      FIX_SIGMA: 0.0
      KERNEL_MUL: 2.0
      KERNEL_NUM: 5
      NORM: True
      NORM_FLAG: l2norm
      SCALE: 1.0
    NAME: ('CrossEntropyLoss', 'TripletLoss')
    SCT:
      FEAT_ORDER: before
      NORM: True
      SCALE: 1.0
      TYPE: cosine_sim
    STD:
      FEAT_ORDER: before
      LOG_SCALE: True
      NORM: True
      SCALE: 1.0
      TYPE: domain
    TRI:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_ADD:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.0
      NEW_NEG: [0, 1, 0]
      NEW_POS: [0, 0, 1]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTEST:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
    TRI_MTRAIN:
      DIST_TYPE: euclidean
      FEAT_ORDER: before
      HARD_MINING: True
      LOSS_TYPE: logistic
      MARGIN: 0.3
      NEW_NEG: [0, 1, 1]
      NEW_POS: [1, 0, 0]
      NORM_FEAT: False
      SCALE: 1.0
  META_ARCHITECTURE: Metalearning
  NORM:
    BIN_INIT: one
    BN_AFFINE: True
    BN_B_FREEZE: False
    BN_RUNNING: True
    BN_W_FREEZE: False
    EACH_DOMAIN_BASIC: False
    EACH_DOMAIN_MTEST: False
    EACH_DOMAIN_MTRAIN: False
    IN_AFFINE: True
    IN_B_FREEZE: False
    IN_FC_MULTIPLY: 0.0
    IN_RUNNING: False
    IN_W_FREEZE: False
    LOAD_BN_AFFINE: True
    LOAD_BN_RUNNING: True
    LOAD_IN_AFFINE: False
    LOAD_IN_RUNNING: False
    TYPE_BACKBONE: BIN_gate2
    TYPE_BOTTLENECK: BN
    TYPE_CLASSIFIER: BN
  PIXEL_MEAN: [123.675, 116.28, 103.53]
  PIXEL_STD: [58.395, 57.120000000000005, 57.375]
  WEIGHTS: 
OUTPUT_DIR: ./refs/logs/Sample/M-resnet
SOLVER:
  AMP: True
  BACKBONE_LR_FACTOR: 1.0
  BASE_LR: 0.01
  BIAS_LR_FACTOR: 2.0
  CHECKPOINT_PERIOD: 2
  CHECKPOINT_SAME_AS_EVAL: True
  CYCLIC_MAX_LR: 0.01
  CYCLIC_MIN_LR: 0.0001
  CYCLIC_PERIOD_PER_EPOCH: 1.0
  DELAY_ITERS: 0
  ETA_MIN_LR: 7.7e-05
  FREEZE_ITERS: 0
  GAMMA: 0.1
  HEADS_LR_FACTOR: 1.0
  IMS_PER_BATCH: 96
  MAX_ITER: 120
  MOMENTUM: 0.9
  MOMENTUM_NORM: 0.0
  NORM_SCHEDULER: equal
  OPT: SGD
  OPT_NORM: SGD
  SCHED: WarmupMultiStepLR
  STEPS: [50, 90]
  SWA:
    ENABLED: False
    ETA_MIN_LR: 3.5e-06
    ITER: 10
    LR_FACTOR: 10.0
    LR_SCHED: False
    PERIOD: 2
  WARMUP_FACTOR: 0.01
  WARMUP_ITERS: 10
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0005
  WEIGHT_DECAY_BIAS: 0.0005
  WEIGHT_DECAY_NORM: 0.0
  WRITE_PERIOD: 200
  WRITE_PERIOD_BIN: 200
  WRITE_PERIOD_PARAM: 1000
TEST:
  AQE:
    ALPHA: 3.0
    ENABLED: False
    QE_K: 5
    QE_TIME: 1
  EVAL_PERIOD: 2
  IMS_PER_BATCH: 128
  METRIC: cosine
  PRECISE_BN:
    DATASET: Market1501
    ENABLED: False
    NUM_ITER: 300
  REPORT_ALL: False
  RERANK:
    ENABLED: False
    K1: 20
    K2: 6
    LAMBDA: 0.3
[12/25 22:21:14] fastreid INFO: Full config saved to E:\Work\Python\metabin\MetaBIN-paddle\refs\logs\Sample\M-resnet\config.yaml
[12/25 22:21:15] fastreid.data.datasets.bases INFO: => Loaded Market1501
[12/25 22:21:15] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/25 22:21:15] fastreid.data.datasets.bases INFO:   subset   | # ids | # images | # cameras
[12/25 22:21:15] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/25 22:21:15] fastreid.data.datasets.bases INFO:   train    |   751 |    12936 |         6
[12/25 22:21:15] fastreid.data.datasets.bases INFO:   ----------------------------------------
[12/25 22:21:15] fastreid.data.build INFO: **[dataloader info: random domain shuffle]**
